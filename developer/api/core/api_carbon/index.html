
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="CPLUS">
      
      
        <meta name="author" content="Kartoza">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-8.2.11">
    
    
      
        <title>Conservation International - CPLUS QGIS plugin</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#carbon-calculation-utilities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="CPLUS QGIS plugin" class="md-header__button md-logo" aria-label="CPLUS QGIS plugin" data-md-component="logo">
      
  <img src="../../../../about/img/cplus_logo_white_background.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CPLUS QGIS plugin
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Conservation International
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ConservationInternational/cplus-plugin" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ConservationInternational/cplus-plugin
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../user/" class="md-tabs__link">
        Users
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../administrator/" class="md-tabs__link">
        Administrators
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../" class="md-tabs__link md-tabs__link--active">
        Developers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../about/ci/" class="md-tabs__link">
        About
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="CPLUS QGIS plugin" class="md-nav__button md-logo" aria-label="CPLUS QGIS plugin" data-md-component="logo">
      
  <img src="../../../../about/img/cplus_logo_white_background.svg" alt="logo">

    </a>
    CPLUS QGIS plugin
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ConservationInternational/cplus-plugin" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ConservationInternational/cplus-plugin
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
            
          
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../user/">Users</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Users" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" data-md-state="indeterminate" type="checkbox" id="__nav_2_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../user/guide/">Guide</a>
          
            <label for="__nav_2_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Guide" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/complete-steps-and-report/" class="md-nav__link">
        Complete Steps and Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/preparing-data/" class="md-nav__link">
        Preparing Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/step-1/" class="md-nav__link">
        Step 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/step-2/" class="md-nav__link">
        Step 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/step-3/" class="md-nav__link">
        Step 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/step-4/" class="md-nav__link">
        Step 4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/logs/" class="md-nav__link">
        Logs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" data-md-state="indeterminate" type="checkbox" id="__nav_2_4" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../user/manual/">Manual</a>
          
            <label for="__nav_2_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Manual" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/calculation-and-formula/" class="md-nav__link">
        Calculation and Formula
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/step-1/" class="md-nav__link">
        Step 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/step-2/" class="md-nav__link">
        Step 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/step-3/" class="md-nav__link">
        Step 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/step-4/" class="md-nav__link">
        Step 4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/logs/" class="md-nav__link">
        Logs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/scenario-file/" class="md-nav__link">
        Scenario File
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
            
          
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../administrator/">Administrators</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Administrators" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Administrators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/guide/" class="md-nav__link">
        Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/repository/" class="md-nav__link">
        Repository
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../">Developers</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_1" type="checkbox" id="__nav_4_5_1" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_1">
          Core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_5_1">
          <span class="md-nav__icon md-icon"></span>
          Core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_main/" class="md-nav__link">
        Main
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_conf/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_tasks/" class="md-nav__link">
        Processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_utils/" class="md-nav__link">
        Utilities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_financials/" class="md-nav__link">
        Financials
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Carbon
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_1_8" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_1_8" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_1_8">
          Reports
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reports" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_1_8">
          <span class="md-nav__icon md-icon"></span>
          Reports
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_report_scenario_comparison_table/" class="md-nav__link">
        Comparison Table
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_generator/" class="md-nav__link">
        Generator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_layout_items/" class="md-nav__link">
        Layout items
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_manager/" class="md-nav__link">
        Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_variables/" class="md-nav__link">
        Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_1_9" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_1_9" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_1_9">
          Validation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Validation" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_1_9">
          <span class="md-nav__icon md-icon"></span>
          Validation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation_configs/" class="md-nav__link">
        Configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation_feedback/" class="md-nav__link">
        Feedback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation_manager/" class="md-nav__link">
        Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation_validators/" class="md-nav__link">
        Validators
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_2" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_2">
          Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_5_2">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_base/" class="md-nav__link">
        Model base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_helpers/" class="md-nav__link">
        Helpers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_report/" class="md-nav__link">
        Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_financials/" class="md-nav__link">
        Financials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_3" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_3">
          GUI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GUI" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_5_3">
          <span class="md-nav__icon md-icon"></span>
          GUI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_gui_main/" class="md-nav__link">
        GUI main
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_carbon_layer_model/" class="md-nav__link">
        Carbon item model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_component_items/" class="md-nav__link">
        Component item model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_activity_editor_dialog/" class="md-nav__link">
        Implementation model editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_activity_widget/" class="md-nav__link">
        Implementation model widget
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_items_selection_dialog/" class="md-nav__link">
        Items selection dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_map_repeat_item_widget/" class="md-nav__link">
        Map repeat item widget
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_model_component_widget/" class="md-nav__link">
        Model component widget
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_ncs_pathway_editor/" class="md-nav__link">
        NCS Pathway editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_pixel_value_editor/" class="md-nav__link">
        Pixel Values editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_priority_layer/" class="md-nav__link">
        Priority layer dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_priority_group/" class="md-nav__link">
        Priority group
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_progress_dialog/" class="md-nav__link">
        Progress dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_3_14" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_3_14" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_3_14">
          Financials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Financials" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_3_14">
          <span class="md-nav__icon md-icon"></span>
          Financials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_npv_manager_dialog/" class="md-nav__link">
        NPV PWL manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_npv_progress_dialog/" class="md-nav__link">
        NPV progress dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_npv_financial_model/" class="md-nav__link">
        NPV view model
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_3_15" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_3_15" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_3_15">
          Validation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Validation" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_3_15">
          <span class="md-nav__icon md-icon"></span>
          Validation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_validation_inspector_dialog/" class="md-nav__link">
        Inspector dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_validation_progress_dialog/" class="md-nav__link">
        Progress dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_validation_result_items/" class="md-nav__link">
        Tree items
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_3_16" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_3_16" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_3_16">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metrics" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_3_16">
          <span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_metrics_builder_dialog/" class="md-nav__link">
        Builder Dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_metrics_builder_model/" class="md-nav__link">
        Builder Model
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/ci/" class="md-nav__link">
        Conservation International
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/kartoza/" class="md-nav__link">
        Kartoza
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/license/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/ConservationInternational/cplus-plugin/edit/master/docs/developer/api/core/api_carbon.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<div><h1 id="carbon-calculation-utilities">Carbon Calculation Utilities<a class="headerlink" href="#carbon-calculation-utilities" title="Permanent link">¶</a></h1>


<div class="doc doc-object doc-module">



<a id="src.cplus_plugin.lib.carbon"></a>
    <div class="doc doc-contents first">

      <p>Contains functions for carbon calculations.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h1 id="src.cplus_plugin.lib.carbon.IrrecoverableCarbonCalculator" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">IrrecoverableCarbonCalculator</span>


<a href="#src.cplus_plugin.lib.carbon.IrrecoverableCarbonCalculator" class="headerlink" title="Permanent link">¶</a></h1>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">IrrecoverableCarbonCalculator</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">


      <p>Calculates the total irrecoverable carbon of an activity using
the mean-based reference carbon layer.</p>
<p>It specifically searches for protect pathways in the activity.
If none is found, it will return 0. This is designed to be called
within a QgsExpressionFunction.</p>

                  <details class="quote">
                    <summary>Source code in <code>src/cplus_plugin/lib/carbon.py</code></summary>
                    <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Activity</span><span class="p">]):</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">activity</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">activity</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_activity</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span> <span class="o">=</span> <span class="n">activity</span>
</code></pre></div>
</td></tr></table>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="src.cplus_plugin.lib.carbon.IrrecoverableCarbonCalculator.activity" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">activity</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#src.cplus_plugin.lib.carbon.IrrecoverableCarbonCalculator.activity" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">activity</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Gets the activity used to calculate the total
irrecoverable carbon.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Activity</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The activity for calculating the total irrecoverable carbon.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.lib.carbon.IrrecoverableCarbonCalculator.run" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run</span>


<a href="#src.cplus_plugin.lib.carbon.IrrecoverableCarbonCalculator.run" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Calculates the total irrecoverable carbon of the referenced activity.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total irrecoverable carbon of the activity. If there are no protect NCS pathways in the activity, the function will return 0.0. If there are any errors encountered during the process, the function will return -1.0.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/lib/carbon.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="sd">"""Calculates the total irrecoverable carbon of the referenced activity.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    :returns: The total irrecoverable carbon of the activity. If there are</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    no protect NCS pathways in the activity, the function will return 0.0.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    If there are any errors encountered during the process, the function</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    will return -1.0.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">    :rtype: float</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">    """</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - There are no pathways in "</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> activity."</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">protect_pathways</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">pathway</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activity</span><span class="o">.</span><span class="n">pathways</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">pathway_type</span> <span class="o">==</span> <span class="n">NcsPathwayType</span><span class="o">.</span><span class="n">PROTECT</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="p">]</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">protect_pathways</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - There are no protect pathways in "</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> activity."</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="n">protect_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathway</span><span class="o">.</span><span class="n">to_map_layer</span><span class="p">()</span> <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">protect_pathways</span><span class="p">]</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="n">valid_protect_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">protect_layers</span> <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">()]</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_protect_layers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - There are no valid protect pathway layers in "</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> activity."</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="p">)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_protect_layers</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">protect_layers</span><span class="p">):</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="c1"># Just warn if some layers were excluded</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Some protect pathway layers are invalid and will be "</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="sa">f</span><span class="s2">"exclude from the irrecoverable carbon calculation."</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="p">)</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">processing_context</span> <span class="o">=</span> <span class="n">QgsProcessingContext</span><span class="p">()</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="n">protect_data_sources</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">valid_protect_layers</span><span class="p">]</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="c1"># First merge the protect NCS pathways into one raster</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="n">merge_args</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">protect_data_sources</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="s2">"PCT"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="s2">"SEPARATE"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="p">}</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="n">merge_result</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Merging protect NCS pathways: </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">protect_data_sources</span><span class="p">)</span><span class="si">}</span><span class="s2">..."</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="n">merge_result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="s2">"gdal:merge"</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">merge_args</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="n">context</span><span class="o">=</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="p">)</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>    <span class="k">except</span> <span class="n">QgsProcessingException</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Error creating a union of protect NCS pathways."</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="n">merged_layer_path</span> <span class="o">=</span> <span class="n">merge_result</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="n">merged_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">merged_layer_path</span><span class="p">,</span> <span class="s2">"merged_pathways"</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">merged_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Merged protect pathways layer is invalid."</span><span class="p">,</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="p">)</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="c1"># Perform a binary transformation to get only the valid pixels for analysis</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="n">boolean_args</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">merged_layer_path</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="s2">"REF_LAYER"</span><span class="p">:</span> <span class="n">merged_layer_path</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="s2">"NODATA_AS_FALSE"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="s2">"DATA_TYPE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># quint8 - since we are only dealing wih 0s and 1s,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="c1"># this will help reduce the size of the output file.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span><span class="p">,</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="p">}</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="n">boolean_result</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Performing binary conversion of merged protect NCS pathways..."</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="n">boolean_result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="s2">"native:rasterlogicalor"</span><span class="p">,</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="n">boolean_args</span><span class="p">,</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="n">context</span><span class="o">=</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="k">except</span> <span class="n">QgsProcessingException</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Error creating a binary of merged protect NCS pathways."</span><span class="p">,</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="n">binary_layer_path</span> <span class="o">=</span> <span class="n">boolean_result</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="n">binary_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">binary_layer_path</span><span class="p">,</span> <span class="s2">"binary_pathways"</span><span class="p">)</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">binary_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Binary protect pathways layer is invalid."</span><span class="p">,</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="c1"># Reproject the aggregated protect raster if required</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="k">if</span> <span class="n">binary_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="s2">"EPSG:4326"</span><span class="p">):</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Binary protect pathways layer has a different CRS from "</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="sa">f</span><span class="s2">"the reference mean irrecoverable carbon dataset."</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="n">reproject_args</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">binary_layer_path</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="s2">"SOURCE_CRS"</span><span class="p">:</span> <span class="n">binary_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>            <span class="s2">"TARGET_CRS"</span><span class="p">:</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                <span class="s2">"EPSG:4326"</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="p">),</span>  <span class="c1"># Global IC reference raster</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="s2">"RESAMPLING"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>            <span class="s2">"DATA_TYPE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="s2">"OPTIONS"</span><span class="p">:</span> <span class="s2">"COMPRESS=DEFLATE|PREDICTOR=2|ZLEVEL=9"</span><span class="p">,</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span><span class="p">,</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="s2">"EXTRA"</span><span class="p">:</span> <span class="s2">"--config CHECK_DISK_FREE_SPACE NO"</span><span class="p">,</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="p">}</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="n">reproject_result</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>            <span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Re-projecting binary protected NCS pathways..."</span><span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="n">reproject_result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="s2">"gdal:warpreproject"</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="n">reproject_args</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="n">context</span><span class="o">=</span><span class="n">QgsProcessingContext</span><span class="p">(),</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="k">except</span> <span class="n">QgsProcessingException</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>            <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Error re-projecting the "</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="s2">"binary protect NCS pathways."</span><span class="p">,</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>            <span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="n">binary_layer_path</span> <span class="o">=</span> <span class="n">reproject_result</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="n">reprojected_protect_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">binary_layer_path</span><span class="p">,</span> <span class="s2">"reprojected_protect_pathway"</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">reprojected_protect_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Reprojected protect pathways layer is invalid."</span><span class="p">,</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="p">)</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="n">total_irrecoverable_carbon</span> <span class="o">=</span> <span class="n">calculate_irrecoverable_carbon_from_mean</span><span class="p">(</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="n">reprojected_protect_layer</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="p">)</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="k">if</span> <span class="n">total_irrecoverable_carbon</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Error occurred in "</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="s2">"calculating the total irrecoverable carbon. See preceding logs "</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="s2">"for details."</span><span class="p">,</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="p">)</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="sa">f</span><span class="s2">"Finished calculating the total irrecoverable carbon of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as </span><span class="si">{</span><span class="n">total_irrecoverable_carbon</span><span class="si">!s}</span><span class="s2">"</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="k">return</span> <span class="n">total_irrecoverable_carbon</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h1 id="src.cplus_plugin.lib.carbon.calculate_activity_naturebase_carbon_impact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_activity_naturebase_carbon_impact</span>


<a href="#src.cplus_plugin.lib.carbon.calculate_activity_naturebase_carbon_impact" class="headerlink" title="Permanent link">¶</a></h1>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_activity_naturebase_carbon_impact</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Calculates the carbon mitigation impact of an activity from Naturbase pathway.</p>
<p>It sums the carbon mitigation values across each NCS Naturebase pathway that constitutes the
activity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activity</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The specific activity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns the total carbon impact of the activity, or -1.0 if the activity does not exist or lacks Naturebase pathways.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/lib/carbon.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="k">def</span> <span class="nf">calculate_activity_naturebase_carbon_impact</span><span class="p">(</span><span class="n">activity</span><span class="p">:</span> <span class="n">Activity</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="sd">"""Calculates the carbon mitigation impact of an activity from Naturbase pathway.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    It sums the carbon mitigation values across each NCS Naturebase pathway that constitutes the</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    activity.</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    :param activity: The specific activity.</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    :type activity: Activity</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    :returns: Returns the total carbon impact of the activity, or -1.0</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    if the activity does not exist or lacks Naturebase pathways.</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a><span class="sd">    :rtype: float</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">    """</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="k">if</span> <span class="n">activity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">pathways</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="n">pathway</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"Naturebase:"</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">carbon_impact_value</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="p">]</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">carbon_impact_value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h1 id="src.cplus_plugin.lib.carbon.calculate_irrecoverable_carbon_from_mean" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_irrecoverable_carbon_from_mean</span>


<a href="#src.cplus_plugin.lib.carbon.calculate_irrecoverable_carbon_from_mean" class="headerlink" title="Permanent link">¶</a></h1>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">calculate_irrecoverable_carbon_from_mean</span><span class="p">(</span><span class="n">ncs_pathways_layer</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Calculates the total irrecoverable carbon in tonnes for protect NCS pathways
using the reference layer defined in settings that is based on the
mean value per hectare.</p>
<p>This is a manual, pixel-by-pixel analysis that overcomes the limitations
of the raster calculator and zonal statistics tools, which use the intersection
of the center point of the reference pixel to determine whether the reference
pixel will be considered in the computation. The use of these tools results in some
valid intersecting pixels being excluded from the analysis. This is a known
issue that has been raised in the QGIS GitHub repo, hence the reason for
using this function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>ncs_pathways_layer</code></td>
            <td>
                  <code><span title="qgis.core.QgsRasterLayer">QgsRasterLayer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Layer containing an aggregate of protect NCS pathways. The CRS needs to be WGS84 otherwise the result will be incorrect. In addition, the layer needs to be in binary form i.e. a pixel value of 1 represents a valid value and 0 represents a non-valid or nodata value. The raster boolean (AND or OR) tool can be used to normalize the layer before passing it into this function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total irrecoverable carbon for protect NCS pathways specified in the input. If there are any errors during the operation, such as an invalid input raster layer, then -1.0 will be returned.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/lib/carbon.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span> <span class="nf">calculate_irrecoverable_carbon_from_mean</span><span class="p">(</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">ncs_pathways_layer</span><span class="p">:</span> <span class="n">QgsRasterLayer</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="sd">"""Calculates the total irrecoverable carbon in tonnes for protect NCS pathways</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    using the reference layer defined in settings that is based on the</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    mean value per hectare.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    This is a manual, pixel-by-pixel analysis that overcomes the limitations</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    of the raster calculator and zonal statistics tools, which use the intersection</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    of the center point of the reference pixel to determine whether the reference</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    pixel will be considered in the computation. The use of these tools results in some</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    valid intersecting pixels being excluded from the analysis. This is a known</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    issue that has been raised in the QGIS GitHub repo, hence the reason for</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    using this function.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    :param ncs_pathways_layer: Layer containing an aggregate of protect NCS pathways.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    The CRS needs to be WGS84 otherwise the result will be incorrect. In addition,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    the layer needs to be in binary form i.e. a pixel value of 1 represents a</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    valid value and 0 represents a non-valid or nodata value. The raster boolean</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    (AND or OR) tool can be used to normalize the layer before passing it into</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    this function.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    :type ncs_pathways_layer: QgsRasterLayer</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    :returns: The total irrecoverable carbon for protect NCS pathways</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    specified in the input. If there are any errors during the operation,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    such as an invalid input raster layer, then -1.0 will be returned.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    :rtype: float</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    """</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ncs_pathways_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Input union of protect NCS pathways is invalid."</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="c1"># TBC - should we cancel the process if using IC is disabled in settings? If</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="c1"># so, we will need to explicitly need to check the corresponding settings.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">source_type_int</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">Settings</span><span class="o">.</span><span class="n">IRRECOVERABLE_CARBON_SOURCE_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">default</span><span class="o">=</span><span class="n">DataSourceType</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">setting_type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">reference_source_path</span> <span class="o">=</span> <span class="s2">""</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">if</span> <span class="n">source_type_int</span> <span class="o">==</span> <span class="n">DataSourceType</span><span class="o">.</span><span class="n">LOCAL</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">reference_source_path</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">IRRECOVERABLE_CARBON_LOCAL_SOURCE</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">""</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">elif</span> <span class="n">source_type_int</span> <span class="o">==</span> <span class="n">DataSourceType</span><span class="o">.</span><span class="n">ONLINE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">reference_source_path</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">IRRECOVERABLE_CARBON_ONLINE_LOCAL_PATH</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">""</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">reference_source_path</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Data source for reference irrecoverable carbon layer not found."</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">norm_source_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">reference_source_path</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">norm_source_path</span><span class="p">):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Irrecoverable Carbon Calculation - Data source for reference "</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="sa">f</span><span class="s2">"irrecoverable carbon layer </span><span class="si">{</span><span class="n">norm_source_path</span><span class="si">}</span><span class="s2"> does not exist."</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">reference_irrecoverable_carbon_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">norm_source_path</span><span class="p">,</span> <span class="s2">"mean_irrecoverable_carbon"</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="c1"># Check CRS and warn if different</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">if</span> <span class="n">reference_irrecoverable_carbon_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span> <span class="o">!=</span> <span class="n">ncs_pathways_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">():</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Final computation might be incorrect as protect NCS "</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="s2">"pathways and reference irrecoverable carbon layer have different "</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="s2">"CRSs."</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">scenario_extent</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">SCENARIO_EXTENT</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="k">if</span> <span class="n">scenario_extent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Scenario extent not defined."</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">reference_extent</span> <span class="o">=</span> <span class="n">QgsRectangle</span><span class="p">(</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="nb">float</span><span class="p">(</span><span class="n">scenario_extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="nb">float</span><span class="p">(</span><span class="n">scenario_extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="nb">float</span><span class="p">(</span><span class="n">scenario_extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="nb">float</span><span class="p">(</span><span class="n">scenario_extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">ncs_pathways_extent</span> <span class="o">=</span> <span class="n">ncs_pathways_layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="c1"># if they do not intersect then exit. This might also be related to the CRS.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">ncs_pathways_extent</span><span class="p">):</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - The protect NCS pathways layer does not intersect with "</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="s2">"the reference irrecoverable carbon layer."</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="c1">#</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">reference_provider</span> <span class="o">=</span> <span class="n">reference_irrecoverable_carbon_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">reference_layer_iterator</span> <span class="o">=</span> <span class="n">QgsRasterIterator</span><span class="p">(</span><span class="n">reference_provider</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="n">reference_layer_iterator</span><span class="o">.</span><span class="n">startRasterRead</span><span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="mi">1</span><span class="p">,</span> <span class="n">reference_provider</span><span class="o">.</span><span class="n">xSize</span><span class="p">(),</span> <span class="n">reference_provider</span><span class="o">.</span><span class="n">ySize</span><span class="p">(),</span> <span class="n">reference_extent</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="n">irrecoverable_carbon_intersecting_pixel_values</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="p">(</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">success</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">columns</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">rows</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">block</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">left</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">top</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">reference_layer_iterator</span><span class="o">.</span><span class="n">readNextRasterPart</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="k">break</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Invalid irrecoverable carbon layer raster block."</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="k">break</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">block_part_y_min</span> <span class="o">=</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="p">)</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">block_part_y_max</span> <span class="o">=</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                <span class="n">r</span> <span class="o">/</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="p">)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">isNoData</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                <span class="n">block_part_x_min</span> <span class="o">=</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                    <span class="n">c</span> <span class="o">/</span> <span class="n">columns</span> <span class="o">*</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="n">block_part_x_max</span> <span class="o">=</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                    <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">columns</span> <span class="o">*</span> <span class="n">reference_extent</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="c1"># Use this to check if there are intersecting NCS pathway pixels in</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                <span class="c1"># the reference layer block</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">analysis_extent</span> <span class="o">=</span> <span class="n">QgsRectangle</span><span class="p">(</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                    <span class="n">block_part_x_min</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                    <span class="n">block_part_y_min</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                    <span class="n">block_part_x_max</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                    <span class="n">block_part_y_max</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="n">ncs_cols</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                    <span class="mf">1.0</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                    <span class="o">*</span> <span class="n">analysis_extent</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                    <span class="o">/</span> <span class="n">ncs_pathways_layer</span><span class="o">.</span><span class="n">rasterUnitsPerPixelX</span><span class="p">()</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="p">)</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="n">ncs_rows</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                    <span class="mf">1.0</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                    <span class="o">*</span> <span class="n">analysis_extent</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                    <span class="o">/</span> <span class="n">ncs_pathways_layer</span><span class="o">.</span><span class="n">rasterUnitsPerPixelY</span><span class="p">()</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="p">)</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">ncs_block</span> <span class="o">=</span> <span class="n">ncs_pathways_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">block</span><span class="p">(</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                    <span class="mi">1</span><span class="p">,</span> <span class="n">analysis_extent</span><span class="p">,</span> <span class="n">ncs_cols</span><span class="p">,</span> <span class="n">ncs_rows</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">ncs_block</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                    <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - Invalid aggregated NCS pathway raster block."</span><span class="p">,</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>                        <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>                    <span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                <span class="n">ncs_block_data</span> <span class="o">=</span> <span class="n">ncs_block</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">invalid_data</span> <span class="o">=</span> <span class="n">QgsRasterBlock</span><span class="o">.</span><span class="n">valueBytes</span><span class="p">(</span><span class="n">ncs_block</span><span class="o">.</span><span class="n">dataType</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="c1"># Check if the NCS block within the reference block contains</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="c1"># any other value apart from the invalid value i.e. 0 pixel value.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="c1"># In future iterations, consider using QGIS 3.40+ which includes</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                <span class="c1"># QgsRasterBlock.as_numpy() that provides the ability to work with</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="c1"># the raw binary data in numpy for more faster calculations.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                <span class="n">ncs_ba_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                    <span class="n">ncs_block_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs_block_data</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                <span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                <span class="n">invalid_ba_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                    <span class="n">invalid_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">invalid_data</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="k">if</span> <span class="n">ncs_ba_set</span> <span class="o">-</span> <span class="n">invalid_ba_set</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                    <span class="c1"># we have valid overlapping pixels hence we can pick the value of</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                    <span class="c1"># the corresponding reference IC layer.</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                    <span class="n">irrecoverable_carbon_intersecting_pixel_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>                        <span class="n">block</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                    <span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">reference_layer_iterator</span><span class="o">.</span><span class="n">stopRasterRead</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="n">ic_pixel_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">irrecoverable_carbon_intersecting_pixel_values</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="k">if</span> <span class="n">ic_pixel_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="n">log</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">LOG_PREFIX</span><span class="si">}</span><span class="s2"> - No protect NCS pathways were found in the reference layer."</span><span class="p">,</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="n">info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">return</span> <span class="mf">0.0</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="n">ic_mean</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">irrecoverable_carbon_intersecting_pixel_values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">ic_pixel_count</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="n">log</span><span class="p">(</span><span class="s2">"Calculating the total irrecoverable carbon..."</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">return</span> <span class="n">MEAN_REFERENCE_LAYER_AREA</span> <span class="o">*</span> <span class="n">ic_pixel_count</span> <span class="o">*</span> <span class="n">ic_mean</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">October 9, 2025</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../api_financials/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Financials" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Financials
            </div>
          </div>
        </a>
      
      
        
        <a href="../api_report_scenario_comparison_table/" class="md-footer__link md-footer__link--next" aria-label="Next: Comparison Table" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Comparison Table
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.instant", "navigation.tabs.sticky", "navigation.tracking", "toc.integrate", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.annotation", "content.code.copy", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.748e2769.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>