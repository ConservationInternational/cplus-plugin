
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="CPLUS">
      
      
        <meta name="author" content="Kartoza">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-8.2.11">
    
    
      
        <title>Conservation International - CPLUS QGIS plugin</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#processing-tasks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="CPLUS QGIS plugin" class="md-header__button md-logo" aria-label="CPLUS QGIS plugin" data-md-component="logo">
      
  <img src="../../../../about/img/cplus_logo_white_background.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CPLUS QGIS plugin
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Conservation International
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ConservationInternational/cplus-plugin" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ConservationInternational/cplus-plugin
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../user/" class="md-tabs__link">
        Users
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../administrator/" class="md-tabs__link">
        Administrators
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../" class="md-tabs__link md-tabs__link--active">
        Developers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../about/ci/" class="md-tabs__link">
        About
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="CPLUS QGIS plugin" class="md-nav__button md-logo" aria-label="CPLUS QGIS plugin" data-md-component="logo">
      
  <img src="../../../../about/img/cplus_logo_white_background.svg" alt="logo">

    </a>
    CPLUS QGIS plugin
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ConservationInternational/cplus-plugin" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ConservationInternational/cplus-plugin
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
            
          
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../user/">Users</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Users" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" data-md-state="indeterminate" type="checkbox" id="__nav_2_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../user/guide/">Guide</a>
          
            <label for="__nav_2_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Guide" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/complete-steps-and-report/" class="md-nav__link">
        Complete Steps and Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/preparing-data/" class="md-nav__link">
        Preparing Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/step-1/" class="md-nav__link">
        Step 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/step-2/" class="md-nav__link">
        Step 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/step-3/" class="md-nav__link">
        Step 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/step-4/" class="md-nav__link">
        Step 4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/guide/logs/" class="md-nav__link">
        Logs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" data-md-state="indeterminate" type="checkbox" id="__nav_2_4" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../user/manual/">Manual</a>
          
            <label for="__nav_2_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Manual" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/calculation-and-formula/" class="md-nav__link">
        Calculation and Formula
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/step-1/" class="md-nav__link">
        Step 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/step-2/" class="md-nav__link">
        Step 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/step-3/" class="md-nav__link">
        Step 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/step-4/" class="md-nav__link">
        Step 4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/logs/" class="md-nav__link">
        Logs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user/manual/scenario-file/" class="md-nav__link">
        Scenario File
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
            
          
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../../administrator/">Administrators</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Administrators" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Administrators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/guide/" class="md-nav__link">
        Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/repository/" class="md-nav__link">
        Repository
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../">Developers</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../documentation/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_1" type="checkbox" id="__nav_4_5_1" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_1">
          Core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_5_1">
          <span class="md-nav__icon md-icon"></span>
          Core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_main/" class="md-nav__link">
        Main
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_conf/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Processing
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_utils/" class="md-nav__link">
        Utilities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_financials/" class="md-nav__link">
        Financials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_carbon/" class="md-nav__link">
        Carbon
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_1_8" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_1_8" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_1_8">
          Reports
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reports" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_1_8">
          <span class="md-nav__icon md-icon"></span>
          Reports
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_report_scenario_comparison_table/" class="md-nav__link">
        Comparison Table
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_generator/" class="md-nav__link">
        Generator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_layout_items/" class="md-nav__link">
        Layout items
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_manager/" class="md-nav__link">
        Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_variables/" class="md-nav__link">
        Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_reports_metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_1_9" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_1_9" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_1_9">
          Validation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Validation" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_1_9">
          <span class="md-nav__icon md-icon"></span>
          Validation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation_configs/" class="md-nav__link">
        Configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation_feedback/" class="md-nav__link">
        Feedback
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation_manager/" class="md-nav__link">
        Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api_validation_validators/" class="md-nav__link">
        Validators
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_2" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_2">
          Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Models" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_5_2">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_base/" class="md-nav__link">
        Model base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_helpers/" class="md-nav__link">
        Helpers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_report/" class="md-nav__link">
        Report
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_financials/" class="md-nav__link">
        Financials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/api_validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_3" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_3">
          GUI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GUI" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_5_3">
          <span class="md-nav__icon md-icon"></span>
          GUI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_gui_main/" class="md-nav__link">
        GUI main
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_carbon_layer_model/" class="md-nav__link">
        Carbon item model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_component_items/" class="md-nav__link">
        Component item model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_activity_editor_dialog/" class="md-nav__link">
        Implementation model editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_activity_widget/" class="md-nav__link">
        Implementation model widget
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_items_selection_dialog/" class="md-nav__link">
        Items selection dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_map_repeat_item_widget/" class="md-nav__link">
        Map repeat item widget
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_model_component_widget/" class="md-nav__link">
        Model component widget
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_ncs_pathway_editor/" class="md-nav__link">
        NCS Pathway editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_pixel_value_editor/" class="md-nav__link">
        Pixel Values editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_priority_layer/" class="md-nav__link">
        Priority layer dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_priority_group/" class="md-nav__link">
        Priority group
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_progress_dialog/" class="md-nav__link">
        Progress dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_3_14" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_3_14" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_3_14">
          Financials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Financials" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_3_14">
          <span class="md-nav__icon md-icon"></span>
          Financials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_npv_manager_dialog/" class="md-nav__link">
        NPV PWL manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_npv_progress_dialog/" class="md-nav__link">
        NPV progress dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_npv_financial_model/" class="md-nav__link">
        NPV view model
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_3_15" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_3_15" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_3_15">
          Validation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Validation" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_3_15">
          <span class="md-nav__icon md-icon"></span>
          Validation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_validation_inspector_dialog/" class="md-nav__link">
        Inspector dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_validation_progress_dialog/" class="md-nav__link">
        Progress dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_validation_result_items/" class="md-nav__link">
        Tree items
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5_3_16" data-md-state="indeterminate" type="checkbox" id="__nav_4_5_3_16" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5_3_16">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metrics" data-md-level="4">
        <label class="md-nav__title" for="__nav_4_5_3_16">
          <span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_metrics_builder_dialog/" class="md-nav__link">
        Builder Dialog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/api_metrics_builder_model/" class="md-nav__link">
        Builder Model
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" data-md-state="indeterminate" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/ci/" class="md-nav__link">
        Conservation International
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/kartoza/" class="md-nav__link">
        Kartoza
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/license/" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/ConservationInternational/cplus-plugin/edit/master/docs/developer/api/core/api_tasks.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<div><h1 id="processing-tasks">Processing Tasks<a class="headerlink" href="#processing-tasks" title="Permanent link">¶</a></h1>


<div class="doc doc-object doc-module">



<a id="src.cplus_plugin.tasks"></a>
    <div class="doc doc-contents first">

      <p>Plugin tasks related to the scenario analysis</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h1 id="src.cplus_plugin.tasks.ScenarioAnalysisTask" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ScenarioAnalysisTask</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask" class="headerlink" title="Permanent link">¶</a></h1>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">ScenarioAnalysisTask</span><span class="p">(</span><span class="n">analysis_scenario_name</span><span class="p">,</span> <span class="n">analysis_scenario_description</span><span class="p">,</span> <span class="n">analysis_activities</span><span class="p">,</span> <span class="n">analysis_priority_layers_groups</span><span class="p">,</span> <span class="n">analysis_extent</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">clip_to_studyarea</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">studyarea_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="qgis.core.QgsTask">QgsTask</span></code></p>


      <p>Prepares and runs the scenario analysis</p>

                  <details class="quote">
                    <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
                    <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">analysis_scenario_name</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">analysis_scenario_description</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">analysis_priority_layers_groups</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">analysis_extent</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">scenario</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">clip_to_studyarea</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">studyarea_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="p">):</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_scenario_name</span> <span class="o">=</span> <span class="n">analysis_scenario_name</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_scenario_description</span> <span class="o">=</span> <span class="n">analysis_scenario_description</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span> <span class="o">=</span> <span class="n">analysis_activities</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_priority_layers_groups</span> <span class="o">=</span> <span class="n">analysis_priority_layers_groups</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_extent</span> <span class="o">=</span> <span class="n">analysis_extent</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_extent_string</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">clip_to_studyarea</span> <span class="o">=</span> <span class="n">clip_to_studyarea</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">studyarea_path</span> <span class="o">=</span> <span class="n">studyarea_path</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scenario_result</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">info_message</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span> <span class="o">=</span> <span class="n">QgsProcessingContext</span><span class="p">()</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span> <span class="o">=</span> <span class="n">scenario</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">no_data_value</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">Settings</span><span class="o">.</span><span class="n">NCS_NO_DATA_VALUE</span><span class="p">,</span> <span class="n">NO_DATA_VALUE</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="p">)</span>
</code></pre></div>
</td></tr></table>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.align_extent" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">align_extent</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.align_extent" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">align_extent</span><span class="p">(</span><span class="n">raster_layer</span><span class="p">,</span> <span class="n">target_extent</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Snaps the passed extent to the activities pathway layer pixel bounds</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>raster_layer</code></td>
            <td>
                  <code><span title="qgis.core.QgsRasterLayer">QgsRasterLayer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target layer that the passed extent will be aligned with</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_extent</code></td>
            <td>
                  <code><span title="qgis.core.QgsRectangle">QgsRectangle</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spatial extent that will be used a target extent when doing alignment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="k">def</span> <span class="nf">align_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_layer</span><span class="p">,</span> <span class="n">target_extent</span><span class="p">):</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="sd">"""Snaps the passed extent to the activities pathway layer pixel bounds</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    :param raster_layer: The target layer that the passed extent will be</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">    aligned with</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">    :type raster_layer: QgsRasterLayer</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="sd">    :param target_extent: Spatial extent that will be used a target extent when</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="sd">    doing alignment.</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="sd">    :type target_extent: QgsRectangle</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="sd">    """</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="n">raster_extent</span> <span class="o">=</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="n">x_res</span> <span class="o">=</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">rasterUnitsPerPixelX</span><span class="p">()</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="n">y_res</span> <span class="o">=</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">rasterUnitsPerPixelY</span><span class="p">()</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="n">left</span> <span class="o">=</span> <span class="n">raster_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">()</span> <span class="o">+</span> <span class="n">x_res</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="p">(</span><span class="n">target_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">()</span> <span class="o">-</span> <span class="n">raster_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">())</span> <span class="o">/</span> <span class="n">x_res</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="p">)</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="n">right</span> <span class="o">=</span> <span class="n">raster_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">()</span> <span class="o">+</span> <span class="n">x_res</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="p">(</span><span class="n">target_extent</span><span class="o">.</span><span class="n">xMaximum</span><span class="p">()</span> <span class="o">-</span> <span class="n">raster_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">())</span> <span class="o">/</span> <span class="n">x_res</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="n">bottom</span> <span class="o">=</span> <span class="n">raster_extent</span><span class="o">.</span><span class="n">yMinimum</span><span class="p">()</span> <span class="o">+</span> <span class="n">y_res</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="p">(</span><span class="n">target_extent</span><span class="o">.</span><span class="n">yMinimum</span><span class="p">()</span> <span class="o">-</span> <span class="n">raster_extent</span><span class="o">.</span><span class="n">yMinimum</span><span class="p">())</span> <span class="o">/</span> <span class="n">y_res</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="p">)</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="n">top</span> <span class="o">=</span> <span class="n">raster_extent</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_res</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="p">(</span><span class="n">raster_extent</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">()</span> <span class="o">-</span> <span class="n">target_extent</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">())</span> <span class="o">/</span> <span class="n">y_res</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="k">return</span> <span class="n">QgsRectangle</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>            <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>                <span class="sa">f</span><span class="s2">"Problem snapping area of "</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>                <span class="sa">f</span><span class="s2">"interest extent, using the original extent,"</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="p">)</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="k">return</span> <span class="n">target_extent</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.cancel_task" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">cancel_task</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.cancel_task" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">cancel_task</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Cancel current task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>exception</code></td>
            <td>
                  <code>(<span title="Any">Any</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exception if stopped with error, defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="k">def</span> <span class="nf">cancel_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="sd">"""Cancel current task.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    :param exception: Exception if stopped with error, defaults to None</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    :type exception: Any, optional</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    """</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">exception</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.clip_analysis_data" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">clip_analysis_data</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.clip_analysis_data" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">clip_analysis_data</span><span class="p">(</span><span class="n">studyarea_path</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Clips the activity pathways and priority layers by the given study area.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>studyarea_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the study area layer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="k">def</span> <span class="nf">clip_analysis_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">studyarea_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>    <span class="sd">"""Clips the activity pathways and priority layers by the given study area.</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a><span class="sd">    :param studyarea_path: The path to the study area layer</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">    :type studyarea_path: str</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">    """</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>    <span class="n">mask_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">studyarea_path</span><span class="p">,</span> <span class="s2">"mask_layer"</span><span class="p">)</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>            <span class="sa">f</span><span class="s2">"Invalid mask layer: </span><span class="si">{</span><span class="n">studyarea_path</span><span class="si">}</span><span class="s2"> "</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="sa">f</span><span class="s2">"Skipping clipping of activity pathways and priority layers</span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>        <span class="p">)</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="s2">"Clipping the activity pathways and priority layers by the study area layer"</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>        <span class="p">)</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="p">)</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>    <span class="n">clipped_pathways_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"pathways"</span><span class="p">,</span> <span class="s2">"clipped"</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>    <span class="p">)</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>    <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">clipped_pathways_directory</span><span class="p">)</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>    <span class="n">clipped_priority_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"priority_layer"</span><span class="p">,</span> <span class="s2">"clipped"</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>    <span class="p">)</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>    <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">clipped_priority_directory</span><span class="p">)</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>    <span class="n">pathways</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">NcsPathway</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">:</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>            <span class="p">):</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>                    <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>                        <span class="sa">f</span><span class="s2">"No defined activity pathways or "</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>                        <span class="sa">f</span><span class="s2">" activity layers for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>                    <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>                <span class="p">)</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>                    <span class="sa">f</span><span class="s2">"No defined activity pathways or "</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>                    <span class="sa">f</span><span class="s2">"activity layers for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>                <span class="p">)</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">):</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>                    <span class="n">pathways</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>        <span class="c1"># Clipping the PWLs</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>        <span class="c1"># Dict with PWL uuid as key and path as value</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="n">priority_layers_paths</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>        <span class="k">for</span> <span class="n">priority_layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_priority_layers</span><span class="p">():</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>            <span class="k">if</span> <span class="n">priority_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>            <span class="n">priority_layer_path</span> <span class="o">=</span> <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">priority_layer_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>            <span class="n">priority_layers_paths</span><span class="p">[</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">priority_layer_path</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">priority_layer_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>                    <span class="sa">f</span><span class="s2">"Priority layer </span><span class="si">{</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not valid, "</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>                    <span class="sa">f</span><span class="s2">"skipping clipping layer."</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>                <span class="p">)</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_clip_raster_by_mask</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">mask_layer</span><span class="p">):</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                <span class="sa">f</span><span class="s2">"Clipping the </span><span class="si">{</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="si">}</span><span class="s2"> priority layer "</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                <span class="sa">f</span><span class="s2">"by study area layer</span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>            <span class="p">)</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>                <span class="n">clipped_priority_directory</span><span class="p">,</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">uuid</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>            <span class="p">)</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_raster_by_mask</span><span class="p">(</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>                <span class="n">priority_layer_path</span><span class="p">,</span> <span class="n">studyarea_path</span><span class="p">,</span> <span class="n">output_file</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>            <span class="p">)</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>                <span class="n">priority_layers_paths</span><span class="p">[</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">output_file</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>        <span class="k">if</span> <span class="n">pathways</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>                <span class="n">pathway_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>                    <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pathway_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>                        <span class="sa">f</span><span class="s2">"Pathway layer </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not valid, "</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>                        <span class="sa">f</span><span class="s2">"skipping clipping the layer."</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                    <span class="sa">f</span><span class="s2">"Clipping the </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> pathway layer by "</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>                    <span class="sa">f</span><span class="s2">"the study area layer</span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>                <span class="p">)</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_clip_raster_by_mask</span><span class="p">(</span><span class="n">pathway_layer</span><span class="p">,</span> <span class="n">mask_layer</span><span class="p">):</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>                <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>                    <span class="n">clipped_pathways_directory</span><span class="p">,</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">uuid</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>                <span class="p">)</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_raster_by_mask</span><span class="p">(</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">studyarea_path</span><span class="p">,</span> <span class="n">output_file</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>                <span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">output_file</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>                <span class="p">):</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>                    <span class="n">pathway_priority_layers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>                    <span class="k">for</span> <span class="n">priority_layer</span> <span class="ow">in</span> <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">:</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>                        <span class="n">pwl_uuid</span> <span class="o">=</span> <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>                        <span class="k">if</span> <span class="n">pwl_uuid</span> <span class="ow">in</span> <span class="n">priority_layers_paths</span><span class="p">:</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>                            <span class="n">priority_layer</span><span class="p">[</span><span class="s2">"path"</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority_layers_paths</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>                                <span class="n">pwl_uuid</span><span class="p">,</span> <span class="s2">""</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>                        <span class="n">pathway_priority_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priority_layer</span><span class="p">)</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span> <span class="o">=</span> <span class="n">pathway_priority_layers</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem clipping the layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.clip_raster_by_mask" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">clip_raster_by_mask</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.clip_raster_by_mask" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">clip_raster_by_mask</span><span class="p">(</span><span class="n">input_raster_path</span><span class="p">,</span> <span class="n">mask_layer_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Clip a given raster by the specified mask layer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input_raster_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input raster path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mask_layer_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the masking layer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output layer path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="k">def</span> <span class="nf">clip_raster_by_mask</span><span class="p">(</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">input_raster_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mask_layer_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="sd">"""Clip a given raster by the specified mask layer.</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="sd">    :param input_raster_path: Input raster path</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">    :type input_raster_path: str</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">    :param mask_layer_path: Path to the masking layer</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">    :type mask_layer_path: str</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">    :param output_path: Output layer path</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">    :type output_path: str</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    """</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>    <span class="n">raster_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">input_raster_path</span><span class="p">,</span> <span class="s2">"raster_layer"</span><span class="p">)</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>    <span class="n">mask_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">mask_layer_path</span><span class="p">,</span> <span class="s2">"mask_layer"</span><span class="p">)</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid raster layer: </span><span class="si">{</span><span class="n">input_raster_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid mask layer: </span><span class="si">{</span><span class="n">mask_layer_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">input_raster_path</span><span class="p">,</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="s2">"MASK"</span><span class="p">:</span> <span class="n">mask_layer</span><span class="p">,</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>            <span class="s2">"SOURCE_CRS"</span><span class="p">:</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>            <span class="s2">"DESTINATION_CRS"</span><span class="p">:</span> <span class="n">raster_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>            <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output_path</span><span class="p">,</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>            <span class="s2">"NO_DATA"</span><span class="p">:</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>                <span class="n">Settings</span><span class="o">.</span><span class="n">NCS_NO_DATA_VALUE</span><span class="p">,</span> <span class="n">NO_DATA_VALUE</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>            <span class="p">),</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>            <span class="s2">"CROP_TO_CUTLINE"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="p">}</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="sa">f</span><span class="s2">"Used parameters for clipping the raster: </span><span class="si">{</span><span class="n">input_raster_path</span><span class="si">}</span><span class="s2"> "</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>            <span class="sa">f</span><span class="s2">" using mask layer: </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>        <span class="p">)</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>            <span class="s2">"gdal:cliprasterbymasklayer"</span><span class="p">,</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>            <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>        <span class="p">)</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"OUTPUT"</span><span class="p">):</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem clipping the layer </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.create_activity_connectivity_layer" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_activity_connectivity_layer</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.create_activity_connectivity_layer" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">create_activity_connectivity_layer</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Create an activity connectivity layer for investability analysis</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activity</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Activity</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the connectivity layer or None if the process failed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2984">2984</a></span>
<span class="normal"><a href="#__codelineno-0-2985">2985</a></span>
<span class="normal"><a href="#__codelineno-0-2986">2986</a></span>
<span class="normal"><a href="#__codelineno-0-2987">2987</a></span>
<span class="normal"><a href="#__codelineno-0-2988">2988</a></span>
<span class="normal"><a href="#__codelineno-0-2989">2989</a></span>
<span class="normal"><a href="#__codelineno-0-2990">2990</a></span>
<span class="normal"><a href="#__codelineno-0-2991">2991</a></span>
<span class="normal"><a href="#__codelineno-0-2992">2992</a></span>
<span class="normal"><a href="#__codelineno-0-2993">2993</a></span>
<span class="normal"><a href="#__codelineno-0-2994">2994</a></span>
<span class="normal"><a href="#__codelineno-0-2995">2995</a></span>
<span class="normal"><a href="#__codelineno-0-2996">2996</a></span>
<span class="normal"><a href="#__codelineno-0-2997">2997</a></span>
<span class="normal"><a href="#__codelineno-0-2998">2998</a></span>
<span class="normal"><a href="#__codelineno-0-2999">2999</a></span>
<span class="normal"><a href="#__codelineno-0-3000">3000</a></span>
<span class="normal"><a href="#__codelineno-0-3001">3001</a></span>
<span class="normal"><a href="#__codelineno-0-3002">3002</a></span>
<span class="normal"><a href="#__codelineno-0-3003">3003</a></span>
<span class="normal"><a href="#__codelineno-0-3004">3004</a></span>
<span class="normal"><a href="#__codelineno-0-3005">3005</a></span>
<span class="normal"><a href="#__codelineno-0-3006">3006</a></span>
<span class="normal"><a href="#__codelineno-0-3007">3007</a></span>
<span class="normal"><a href="#__codelineno-0-3008">3008</a></span>
<span class="normal"><a href="#__codelineno-0-3009">3009</a></span>
<span class="normal"><a href="#__codelineno-0-3010">3010</a></span>
<span class="normal"><a href="#__codelineno-0-3011">3011</a></span>
<span class="normal"><a href="#__codelineno-0-3012">3012</a></span>
<span class="normal"><a href="#__codelineno-0-3013">3013</a></span>
<span class="normal"><a href="#__codelineno-0-3014">3014</a></span>
<span class="normal"><a href="#__codelineno-0-3015">3015</a></span>
<span class="normal"><a href="#__codelineno-0-3016">3016</a></span>
<span class="normal"><a href="#__codelineno-0-3017">3017</a></span>
<span class="normal"><a href="#__codelineno-0-3018">3018</a></span>
<span class="normal"><a href="#__codelineno-0-3019">3019</a></span>
<span class="normal"><a href="#__codelineno-0-3020">3020</a></span>
<span class="normal"><a href="#__codelineno-0-3021">3021</a></span>
<span class="normal"><a href="#__codelineno-0-3022">3022</a></span>
<span class="normal"><a href="#__codelineno-0-3023">3023</a></span>
<span class="normal"><a href="#__codelineno-0-3024">3024</a></span>
<span class="normal"><a href="#__codelineno-0-3025">3025</a></span>
<span class="normal"><a href="#__codelineno-0-3026">3026</a></span>
<span class="normal"><a href="#__codelineno-0-3027">3027</a></span>
<span class="normal"><a href="#__codelineno-0-3028">3028</a></span>
<span class="normal"><a href="#__codelineno-0-3029">3029</a></span>
<span class="normal"><a href="#__codelineno-0-3030">3030</a></span>
<span class="normal"><a href="#__codelineno-0-3031">3031</a></span>
<span class="normal"><a href="#__codelineno-0-3032">3032</a></span>
<span class="normal"><a href="#__codelineno-0-3033">3033</a></span>
<span class="normal"><a href="#__codelineno-0-3034">3034</a></span>
<span class="normal"><a href="#__codelineno-0-3035">3035</a></span>
<span class="normal"><a href="#__codelineno-0-3036">3036</a></span>
<span class="normal"><a href="#__codelineno-0-3037">3037</a></span>
<span class="normal"><a href="#__codelineno-0-3038">3038</a></span>
<span class="normal"><a href="#__codelineno-0-3039">3039</a></span>
<span class="normal"><a href="#__codelineno-0-3040">3040</a></span>
<span class="normal"><a href="#__codelineno-0-3041">3041</a></span>
<span class="normal"><a href="#__codelineno-0-3042">3042</a></span>
<span class="normal"><a href="#__codelineno-0-3043">3043</a></span>
<span class="normal"><a href="#__codelineno-0-3044">3044</a></span>
<span class="normal"><a href="#__codelineno-0-3045">3045</a></span>
<span class="normal"><a href="#__codelineno-0-3046">3046</a></span>
<span class="normal"><a href="#__codelineno-0-3047">3047</a></span>
<span class="normal"><a href="#__codelineno-0-3048">3048</a></span>
<span class="normal"><a href="#__codelineno-0-3049">3049</a></span>
<span class="normal"><a href="#__codelineno-0-3050">3050</a></span>
<span class="normal"><a href="#__codelineno-0-3051">3051</a></span>
<span class="normal"><a href="#__codelineno-0-3052">3052</a></span>
<span class="normal"><a href="#__codelineno-0-3053">3053</a></span>
<span class="normal"><a href="#__codelineno-0-3054">3054</a></span>
<span class="normal"><a href="#__codelineno-0-3055">3055</a></span>
<span class="normal"><a href="#__codelineno-0-3056">3056</a></span>
<span class="normal"><a href="#__codelineno-0-3057">3057</a></span>
<span class="normal"><a href="#__codelineno-0-3058">3058</a></span>
<span class="normal"><a href="#__codelineno-0-3059">3059</a></span>
<span class="normal"><a href="#__codelineno-0-3060">3060</a></span>
<span class="normal"><a href="#__codelineno-0-3061">3061</a></span>
<span class="normal"><a href="#__codelineno-0-3062">3062</a></span>
<span class="normal"><a href="#__codelineno-0-3063">3063</a></span>
<span class="normal"><a href="#__codelineno-0-3064">3064</a></span>
<span class="normal"><a href="#__codelineno-0-3065">3065</a></span>
<span class="normal"><a href="#__codelineno-0-3066">3066</a></span>
<span class="normal"><a href="#__codelineno-0-3067">3067</a></span>
<span class="normal"><a href="#__codelineno-0-3068">3068</a></span>
<span class="normal"><a href="#__codelineno-0-3069">3069</a></span>
<span class="normal"><a href="#__codelineno-0-3070">3070</a></span>
<span class="normal"><a href="#__codelineno-0-3071">3071</a></span>
<span class="normal"><a href="#__codelineno-0-3072">3072</a></span>
<span class="normal"><a href="#__codelineno-0-3073">3073</a></span>
<span class="normal"><a href="#__codelineno-0-3074">3074</a></span>
<span class="normal"><a href="#__codelineno-0-3075">3075</a></span>
<span class="normal"><a href="#__codelineno-0-3076">3076</a></span>
<span class="normal"><a href="#__codelineno-0-3077">3077</a></span>
<span class="normal"><a href="#__codelineno-0-3078">3078</a></span>
<span class="normal"><a href="#__codelineno-0-3079">3079</a></span>
<span class="normal"><a href="#__codelineno-0-3080">3080</a></span>
<span class="normal"><a href="#__codelineno-0-3081">3081</a></span>
<span class="normal"><a href="#__codelineno-0-3082">3082</a></span>
<span class="normal"><a href="#__codelineno-0-3083">3083</a></span>
<span class="normal"><a href="#__codelineno-0-3084">3084</a></span>
<span class="normal"><a href="#__codelineno-0-3085">3085</a></span>
<span class="normal"><a href="#__codelineno-0-3086">3086</a></span>
<span class="normal"><a href="#__codelineno-0-3087">3087</a></span>
<span class="normal"><a href="#__codelineno-0-3088">3088</a></span>
<span class="normal"><a href="#__codelineno-0-3089">3089</a></span>
<span class="normal"><a href="#__codelineno-0-3090">3090</a></span>
<span class="normal"><a href="#__codelineno-0-3091">3091</a></span>
<span class="normal"><a href="#__codelineno-0-3092">3092</a></span>
<span class="normal"><a href="#__codelineno-0-3093">3093</a></span>
<span class="normal"><a href="#__codelineno-0-3094">3094</a></span>
<span class="normal"><a href="#__codelineno-0-3095">3095</a></span>
<span class="normal"><a href="#__codelineno-0-3096">3096</a></span>
<span class="normal"><a href="#__codelineno-0-3097">3097</a></span>
<span class="normal"><a href="#__codelineno-0-3098">3098</a></span>
<span class="normal"><a href="#__codelineno-0-3099">3099</a></span>
<span class="normal"><a href="#__codelineno-0-3100">3100</a></span>
<span class="normal"><a href="#__codelineno-0-3101">3101</a></span>
<span class="normal"><a href="#__codelineno-0-3102">3102</a></span>
<span class="normal"><a href="#__codelineno-0-3103">3103</a></span>
<span class="normal"><a href="#__codelineno-0-3104">3104</a></span>
<span class="normal"><a href="#__codelineno-0-3105">3105</a></span>
<span class="normal"><a href="#__codelineno-0-3106">3106</a></span>
<span class="normal"><a href="#__codelineno-0-3107">3107</a></span>
<span class="normal"><a href="#__codelineno-0-3108">3108</a></span>
<span class="normal"><a href="#__codelineno-0-3109">3109</a></span>
<span class="normal"><a href="#__codelineno-0-3110">3110</a></span>
<span class="normal"><a href="#__codelineno-0-3111">3111</a></span>
<span class="normal"><a href="#__codelineno-0-3112">3112</a></span>
<span class="normal"><a href="#__codelineno-0-3113">3113</a></span>
<span class="normal"><a href="#__codelineno-0-3114">3114</a></span>
<span class="normal"><a href="#__codelineno-0-3115">3115</a></span>
<span class="normal"><a href="#__codelineno-0-3116">3116</a></span>
<span class="normal"><a href="#__codelineno-0-3117">3117</a></span>
<span class="normal"><a href="#__codelineno-0-3118">3118</a></span>
<span class="normal"><a href="#__codelineno-0-3119">3119</a></span>
<span class="normal"><a href="#__codelineno-0-3120">3120</a></span>
<span class="normal"><a href="#__codelineno-0-3121">3121</a></span>
<span class="normal"><a href="#__codelineno-0-3122">3122</a></span>
<span class="normal"><a href="#__codelineno-0-3123">3123</a></span>
<span class="normal"><a href="#__codelineno-0-3124">3124</a></span>
<span class="normal"><a href="#__codelineno-0-3125">3125</a></span>
<span class="normal"><a href="#__codelineno-0-3126">3126</a></span>
<span class="normal"><a href="#__codelineno-0-3127">3127</a></span>
<span class="normal"><a href="#__codelineno-0-3128">3128</a></span>
<span class="normal"><a href="#__codelineno-0-3129">3129</a></span>
<span class="normal"><a href="#__codelineno-0-3130">3130</a></span>
<span class="normal"><a href="#__codelineno-0-3131">3131</a></span>
<span class="normal"><a href="#__codelineno-0-3132">3132</a></span>
<span class="normal"><a href="#__codelineno-0-3133">3133</a></span>
<span class="normal"><a href="#__codelineno-0-3134">3134</a></span>
<span class="normal"><a href="#__codelineno-0-3135">3135</a></span>
<span class="normal"><a href="#__codelineno-0-3136">3136</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2984" name="__codelineno-0-2984"></a><span class="k">def</span> <span class="nf">create_activity_connectivity_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="n">Activity</span><span class="p">):</span>
<a id="__codelineno-0-2985" name="__codelineno-0-2985"></a>    <span class="sd">"""Create an activity connectivity layer for investability analysis</span>
<a id="__codelineno-0-2986" name="__codelineno-0-2986"></a>
<a id="__codelineno-0-2987" name="__codelineno-0-2987"></a><span class="sd">    :param activity: Activity</span>
<a id="__codelineno-0-2988" name="__codelineno-0-2988"></a><span class="sd">    :type activity: Activity</span>
<a id="__codelineno-0-2989" name="__codelineno-0-2989"></a>
<a id="__codelineno-0-2990" name="__codelineno-0-2990"></a><span class="sd">    :returns: The path to the connectivity layer or None if the process failed</span>
<a id="__codelineno-0-2991" name="__codelineno-0-2991"></a><span class="sd">    :rtype: str | None</span>
<a id="__codelineno-0-2992" name="__codelineno-0-2992"></a><span class="sd">    """</span>
<a id="__codelineno-0-2993" name="__codelineno-0-2993"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
<a id="__codelineno-0-2994" name="__codelineno-0-2994"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2995" name="__codelineno-0-2995"></a>            <span class="sa">f</span><span class="s2">"Problem when creating the connectivity layer, "</span>
<a id="__codelineno-0-2996" name="__codelineno-0-2996"></a>            <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2997" name="__codelineno-0-2997"></a>        <span class="p">)</span>
<a id="__codelineno-0-2998" name="__codelineno-0-2998"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-2999" name="__codelineno-0-2999"></a>
<a id="__codelineno-0-3000" name="__codelineno-0-3000"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
<a id="__codelineno-0-3001" name="__codelineno-0-3001"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3002" name="__codelineno-0-3002"></a>            <span class="sa">f</span><span class="s2">"Problem when creating the connectivity layer, "</span>
<a id="__codelineno-0-3003" name="__codelineno-0-3003"></a>            <span class="sa">f</span><span class="s2">"the map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist"</span>
<a id="__codelineno-0-3004" name="__codelineno-0-3004"></a>        <span class="p">)</span>
<a id="__codelineno-0-3005" name="__codelineno-0-3005"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-3006" name="__codelineno-0-3006"></a>
<a id="__codelineno-0-3007" name="__codelineno-0-3007"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span>
<a id="__codelineno-0-3008" name="__codelineno-0-3008"></a>        <span class="n">tr</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Creating connectivity layer for the activity: </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-3009" name="__codelineno-0-3009"></a>    <span class="p">)</span>
<a id="__codelineno-0-3010" name="__codelineno-0-3010"></a>
<a id="__codelineno-0-3011" name="__codelineno-0-3011"></a>    <span class="n">output_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-3012" name="__codelineno-0-3012"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"investable_activities"</span>
<a id="__codelineno-0-3013" name="__codelineno-0-3013"></a>    <span class="p">)</span>
<a id="__codelineno-0-3014" name="__codelineno-0-3014"></a>    <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
<a id="__codelineno-0-3015" name="__codelineno-0-3015"></a>
<a id="__codelineno-0-3016" name="__codelineno-0-3016"></a>    <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-3017" name="__codelineno-0-3017"></a>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">output_directory</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a id="__codelineno-0-3018" name="__codelineno-0-3018"></a>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_connectivity_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-3019" name="__codelineno-0-3019"></a>    <span class="p">)</span>
<a id="__codelineno-0-3020" name="__codelineno-0-3020"></a>
<a id="__codelineno-0-3021" name="__codelineno-0-3021"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-3022" name="__codelineno-0-3022"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3023" name="__codelineno-0-3023"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-3024" name="__codelineno-0-3024"></a>
<a id="__codelineno-0-3025" name="__codelineno-0-3025"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-3026" name="__codelineno-0-3026"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-3027" name="__codelineno-0-3027"></a>
<a id="__codelineno-0-3028" name="__codelineno-0-3028"></a>        <span class="c1"># 1. Creating a binary raster</span>
<a id="__codelineno-0-3029" name="__codelineno-0-3029"></a>        <span class="n">binary</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-3030" name="__codelineno-0-3030"></a>            <span class="s2">"qgis:rastercalculator"</span><span class="p">,</span>
<a id="__codelineno-0-3031" name="__codelineno-0-3031"></a>            <span class="p">{</span>
<a id="__codelineno-0-3032" name="__codelineno-0-3032"></a>                <span class="s2">"CELLSIZE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-3033" name="__codelineno-0-3033"></a>                <span class="s2">"LAYERS"</span><span class="p">:</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">],</span>
<a id="__codelineno-0-3034" name="__codelineno-0-3034"></a>                <span class="s2">"CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3035" name="__codelineno-0-3035"></a>                <span class="s2">"EXPRESSION"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">@1 &gt; 0"</span><span class="p">,</span>
<a id="__codelineno-0-3036" name="__codelineno-0-3036"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-3037" name="__codelineno-0-3037"></a>            <span class="p">},</span>
<a id="__codelineno-0-3038" name="__codelineno-0-3038"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-3039" name="__codelineno-0-3039"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-3040" name="__codelineno-0-3040"></a>        <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-3041" name="__codelineno-0-3041"></a>
<a id="__codelineno-0-3042" name="__codelineno-0-3042"></a>        <span class="c1"># 2. Polygonize the binary to get polygon clusters</span>
<a id="__codelineno-0-3043" name="__codelineno-0-3043"></a>        <span class="n">binary_polygonize</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-3044" name="__codelineno-0-3044"></a>            <span class="s2">"gdal:polygonize"</span><span class="p">,</span>
<a id="__codelineno-0-3045" name="__codelineno-0-3045"></a>            <span class="p">{</span>
<a id="__codelineno-0-3046" name="__codelineno-0-3046"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-3047" name="__codelineno-0-3047"></a>                <span class="s2">"BAND"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-3048" name="__codelineno-0-3048"></a>                <span class="s2">"FIELD"</span><span class="p">:</span> <span class="s2">"DN"</span><span class="p">,</span>
<a id="__codelineno-0-3049" name="__codelineno-0-3049"></a>                <span class="s2">"EIGHT_CONNECTEDNESS"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-3050" name="__codelineno-0-3050"></a>                <span class="s2">"EXTRA"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a id="__codelineno-0-3051" name="__codelineno-0-3051"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-3052" name="__codelineno-0-3052"></a>            <span class="p">},</span>
<a id="__codelineno-0-3053" name="__codelineno-0-3053"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-3054" name="__codelineno-0-3054"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-3055" name="__codelineno-0-3055"></a>        <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-3056" name="__codelineno-0-3056"></a>
<a id="__codelineno-0-3057" name="__codelineno-0-3057"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3058" name="__codelineno-0-3058"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-3059" name="__codelineno-0-3059"></a>
<a id="__codelineno-0-3060" name="__codelineno-0-3060"></a>        <span class="c1"># 3. Create a zonal statistics to find the number of pixels in each cluster</span>
<a id="__codelineno-0-3061" name="__codelineno-0-3061"></a>        <span class="n">zonal_statistics</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-3062" name="__codelineno-0-3062"></a>            <span class="s2">"native:zonalstatisticsfb"</span><span class="p">,</span>
<a id="__codelineno-0-3063" name="__codelineno-0-3063"></a>            <span class="p">{</span>
<a id="__codelineno-0-3064" name="__codelineno-0-3064"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">QgsProcessingFeatureSourceDefinition</span><span class="p">(</span>
<a id="__codelineno-0-3065" name="__codelineno-0-3065"></a>                    <span class="n">binary_polygonize</span><span class="p">,</span>
<a id="__codelineno-0-3066" name="__codelineno-0-3066"></a>                    <span class="n">selectedFeaturesOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-3067" name="__codelineno-0-3067"></a>                    <span class="n">featureLimit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-3068" name="__codelineno-0-3068"></a>                    <span class="n">flags</span><span class="o">=</span><span class="n">QgsProcessingFeatureSourceDefinition</span><span class="o">.</span><span class="n">Flag</span><span class="o">.</span><span class="n">FlagOverrideDefaultGeometryCheck</span>
<a id="__codelineno-0-3069" name="__codelineno-0-3069"></a>                    <span class="o">|</span> <span class="n">QgsProcessingFeatureSourceDefinition</span><span class="o">.</span><span class="n">Flag</span><span class="o">.</span><span class="n">FlagCreateIndividualOutputPerInputFeature</span><span class="p">,</span>
<a id="__codelineno-0-3070" name="__codelineno-0-3070"></a>                    <span class="n">geometryCheck</span><span class="o">=</span><span class="n">QgsFeatureRequest</span><span class="o">.</span><span class="n">InvalidGeometryCheck</span><span class="o">.</span><span class="n">GeometryNoCheck</span><span class="p">,</span>
<a id="__codelineno-0-3071" name="__codelineno-0-3071"></a>                <span class="p">),</span>
<a id="__codelineno-0-3072" name="__codelineno-0-3072"></a>                <span class="s2">"INPUT_RASTER"</span><span class="p">:</span> <span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-3073" name="__codelineno-0-3073"></a>                <span class="s2">"RASTER_BAND"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-3074" name="__codelineno-0-3074"></a>                <span class="s2">"COLUMN_PREFIX"</span><span class="p">:</span> <span class="s2">"_"</span><span class="p">,</span>
<a id="__codelineno-0-3075" name="__codelineno-0-3075"></a>                <span class="s2">"STATISTICS"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># sum</span>
<a id="__codelineno-0-3076" name="__codelineno-0-3076"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-3077" name="__codelineno-0-3077"></a>            <span class="p">},</span>
<a id="__codelineno-0-3078" name="__codelineno-0-3078"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-3079" name="__codelineno-0-3079"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-3080" name="__codelineno-0-3080"></a>        <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-3081" name="__codelineno-0-3081"></a>
<a id="__codelineno-0-3082" name="__codelineno-0-3082"></a>        <span class="c1"># 4. Caculate connectivity score = count of pixels in cluster * compactness</span>
<a id="__codelineno-0-3083" name="__codelineno-0-3083"></a>        <span class="n">score</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-3084" name="__codelineno-0-3084"></a>            <span class="s2">"native:fieldcalculator"</span><span class="p">,</span>
<a id="__codelineno-0-3085" name="__codelineno-0-3085"></a>            <span class="p">{</span>
<a id="__codelineno-0-3086" name="__codelineno-0-3086"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">zonal_statistics</span><span class="p">,</span>
<a id="__codelineno-0-3087" name="__codelineno-0-3087"></a>                <span class="s2">"FIELD_NAME"</span><span class="p">:</span> <span class="s2">"score"</span><span class="p">,</span>
<a id="__codelineno-0-3088" name="__codelineno-0-3088"></a>                <span class="s2">"FIELD_TYPE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-3089" name="__codelineno-0-3089"></a>                <span class="s2">"FIELD_LENGTH"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-3090" name="__codelineno-0-3090"></a>                <span class="s2">"FIELD_PRECISION"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-3091" name="__codelineno-0-3091"></a>                <span class="s2">"FORMULA"</span><span class="p">:</span> <span class="s1">'"_sum"  * 4* pi() *  $area  /($perimeter * $perimeter)'</span><span class="p">,</span>
<a id="__codelineno-0-3092" name="__codelineno-0-3092"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-3093" name="__codelineno-0-3093"></a>            <span class="p">},</span>
<a id="__codelineno-0-3094" name="__codelineno-0-3094"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-3095" name="__codelineno-0-3095"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-3096" name="__codelineno-0-3096"></a>        <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-3097" name="__codelineno-0-3097"></a>
<a id="__codelineno-0-3098" name="__codelineno-0-3098"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3099" name="__codelineno-0-3099"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-3100" name="__codelineno-0-3100"></a>
<a id="__codelineno-0-3101" name="__codelineno-0-3101"></a>        <span class="c1"># 5. Rasterize the score vector</span>
<a id="__codelineno-0-3102" name="__codelineno-0-3102"></a>        <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-3103" name="__codelineno-0-3103"></a>            <span class="s2">"gdal:rasterize_over"</span><span class="p">,</span>
<a id="__codelineno-0-3104" name="__codelineno-0-3104"></a>            <span class="p">{</span>
<a id="__codelineno-0-3105" name="__codelineno-0-3105"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
<a id="__codelineno-0-3106" name="__codelineno-0-3106"></a>                <span class="s2">"INPUT_RASTER"</span><span class="p">:</span> <span class="n">binary</span><span class="p">,</span>
<a id="__codelineno-0-3107" name="__codelineno-0-3107"></a>                <span class="s2">"FIELD"</span><span class="p">:</span> <span class="s2">"score"</span><span class="p">,</span>
<a id="__codelineno-0-3108" name="__codelineno-0-3108"></a>                <span class="s2">"ADD"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-3109" name="__codelineno-0-3109"></a>                <span class="s2">"EXTRA"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a id="__codelineno-0-3110" name="__codelineno-0-3110"></a>            <span class="p">},</span>
<a id="__codelineno-0-3111" name="__codelineno-0-3111"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-3112" name="__codelineno-0-3112"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-3113" name="__codelineno-0-3113"></a>        <span class="p">)</span>
<a id="__codelineno-0-3114" name="__codelineno-0-3114"></a>
<a id="__codelineno-0-3115" name="__codelineno-0-3115"></a>        <span class="c1"># 6. Normalize the raster</span>
<a id="__codelineno-0-3116" name="__codelineno-0-3116"></a>        <span class="n">ok</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">normalize_raster</span><span class="p">(</span>
<a id="__codelineno-0-3117" name="__codelineno-0-3117"></a>            <span class="n">binary</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span>
<a id="__codelineno-0-3118" name="__codelineno-0-3118"></a>        <span class="p">)</span>
<a id="__codelineno-0-3119" name="__codelineno-0-3119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<a id="__codelineno-0-3120" name="__codelineno-0-3120"></a>
<a id="__codelineno-0-3121" name="__codelineno-0-3121"></a>        <span class="k">if</span> <span class="n">ok</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_path</span><span class="p">):</span>
<a id="__codelineno-0-3122" name="__codelineno-0-3122"></a>            <span class="k">return</span> <span class="n">output_path</span>
<a id="__codelineno-0-3123" name="__codelineno-0-3123"></a>
<a id="__codelineno-0-3124" name="__codelineno-0-3124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3125" name="__codelineno-0-3125"></a>            <span class="sa">f</span><span class="s2">" Error creating the connectivity layer for activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, "</span>
<a id="__codelineno-0-3126" name="__codelineno-0-3126"></a>        <span class="p">)</span>
<a id="__codelineno-0-3127" name="__codelineno-0-3127"></a>
<a id="__codelineno-0-3128" name="__codelineno-0-3128"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-3129" name="__codelineno-0-3129"></a>
<a id="__codelineno-0-3130" name="__codelineno-0-3130"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-3131" name="__codelineno-0-3131"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3132" name="__codelineno-0-3132"></a>            <span class="sa">f</span><span class="s2">"Problem creating connectivity layer for activity, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-3133" name="__codelineno-0-3133"></a>        <span class="p">)</span>
<a id="__codelineno-0-3134" name="__codelineno-0-3134"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
<a id="__codelineno-0-3135" name="__codelineno-0-3135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-3136" name="__codelineno-0-3136"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.finished" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">finished</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.finished" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">finished</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Calls the handler responsible for doing post analysis workflow.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>result</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the run() operation finished successfully</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="k">def</span> <span class="nf">finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="sd">"""Calls the handler responsible for doing post analysis workflow.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    :param result: Whether the run() operation finished successfully</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    :type result: bool</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    """</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="s2">"Finished from the main task </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error from task scenario task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.get_activity" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_activity</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.get_activity" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_activity</span><span class="p">(</span><span class="n">activity_uuid</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Gets an activity object matching the given unique
identifier.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activity_uuid</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier of the activity object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Activity</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns the activity object matching the given identifier else None if not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="k">def</span> <span class="nf">get_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_uuid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Activity</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="sd">"""Gets an activity object matching the given unique</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    identifier.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    :param activity_uuid: Unique identifier of the</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    activity object.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    :type activity_uuid: str</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    :returns: Returns the activity object matching the given</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">    identifier else None if not found.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    :rtype: Activity</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    """</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="k">return</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_activity</span><span class="p">(</span><span class="n">activity_uuid</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.get_masking_layers" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_masking_layers</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.get_masking_layers" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_masking_layers</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Gets all the masking layers.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of masking layer paths</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span> <span class="nf">get_masking_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="sd">"""Gets all the masking layers.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    :return: List of masking layer paths</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    :rtype: list</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    """</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="n">masking_layers_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">Settings</span><span class="o">.</span><span class="n">MASK_LAYERS_PATHS</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="n">masking_layers</span> <span class="o">=</span> <span class="n">masking_layers_paths</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span> <span class="k">if</span> <span class="n">masking_layers_paths</span> <span class="k">else</span> <span class="p">[]</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">masking_layers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span> <span class="k">if</span> <span class="s2">""</span> <span class="ow">in</span> <span class="n">masking_layers</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">return</span> <span class="n">masking_layers</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.get_priority_layer" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_priority_layer</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.get_priority_layer" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_priority_layer</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Retrieves the priority layer that matches the passed identifier.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>identifier</code></td>
            <td>
                  <code><span title="uuid.UUID">UUID</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority layers identifier</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority layer dict</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="k">def</span> <span class="nf">get_priority_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="sd">"""Retrieves the priority layer that matches the passed identifier.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    :param identifier: Priority layers identifier</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    :type identifier: uuid.UUID</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    :returns: Priority layer dict</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    :rtype: dict</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    """</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">return</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_priority_layer</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.get_priority_layers" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_priority_layers</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.get_priority_layers" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_priority_layers</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Gets all the available priority layers in the plugin.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority layers list</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="k">def</span> <span class="nf">get_priority_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="sd">"""Gets all the available priority layers in the plugin.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    :returns: Priority layers list</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    :rtype: list</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    """</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">return</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_priority_layers</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.get_reference_layer" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_reference_layer</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.get_reference_layer" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_reference_layer</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Get the path of the reference layer</p>
<p>Returns:
    str|None: Return the path of the reference layer or None is it doesn't exist</p>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="k">def</span> <span class="nf">get_reference_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="sd">"""Get the path of the reference layer</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        str|None: Return the path of the reference layer or None is it doesn't exist</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    """</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="n">snapping_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">Settings</span><span class="o">.</span><span class="n">SNAPPING_ENABLED</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">reference_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">SNAP_LAYER</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">reference_layer_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">reference_layer</span><span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="n">snapping_enabled</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">reference_layer</span><span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="ow">and</span> <span class="n">reference_layer_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="p">):</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">return</span> <span class="n">reference_layer</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.get_scenario_directory" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_scenario_directory</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.get_scenario_directory" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_scenario_directory</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Generate scenario directory for current task.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to scenario directory</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="k">def</span> <span class="nf">get_scenario_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="sd">"""Generate scenario directory for current task.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    :return: Path to scenario directory</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    :rtype: str</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    """</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">base_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">BASE_DIR</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">base_dir</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="s2">"scenario_"</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y_%m_</span><span class="si">%d</span><span class="s2">_%H_%M_%S"</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.get_settings_value" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_settings_value</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.get_settings_value" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">get_settings_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Gets value of the setting with the passed name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of setting key</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>default</code></td>
            <td>
                  <code><span title="Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default value returned when the setting key does not exist</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>setting_type</code></td>
            <td>
                  <code><span title="Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the store setting</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Any</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value of the setting</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="k">def</span> <span class="nf">get_settings_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="sd">"""Gets value of the setting with the passed name.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    :param name: Name of setting key</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    :type name: str</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    :param default: Default value returned when the setting key does not exist</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    :type default: Any</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    :param setting_type: Type of the store setting</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    :type setting_type: Any</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    :returns: Value of the setting</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    :rtype: Any</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    """</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">return</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">setting_type</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.layer_extent" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">layer_extent</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.layer_extent" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">layer_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Creates a new vector layer contains has a
feature with geometry matching an extent parameter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extent parameter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>QgsVectorLayer</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vector layer</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span>
<span class="normal"><a href="#__codelineno-0-2304">2304</a></span>
<span class="normal"><a href="#__codelineno-0-2305">2305</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2281" name="__codelineno-0-2281"></a><span class="k">def</span> <span class="nf">layer_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extent</span><span class="p">):</span>
<a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>    <span class="sd">"""Creates a new vector layer contains has a</span>
<a id="__codelineno-0-2283" name="__codelineno-0-2283"></a><span class="sd">    feature with geometry matching an extent parameter.</span>
<a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>
<a id="__codelineno-0-2285" name="__codelineno-0-2285"></a><span class="sd">    :param extent: Extent parameter</span>
<a id="__codelineno-0-2286" name="__codelineno-0-2286"></a><span class="sd">    :type extent: str</span>
<a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>
<a id="__codelineno-0-2288" name="__codelineno-0-2288"></a><span class="sd">    :returns: Vector layer</span>
<a id="__codelineno-0-2289" name="__codelineno-0-2289"></a><span class="sd">    :rtype: QgsVectorLayer</span>
<a id="__codelineno-0-2290" name="__codelineno-0-2290"></a><span class="sd">    """</span>
<a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>
<a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>    <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>        <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>        <span class="s2">"CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>        <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span><span class="p">,</span>
<a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>    <span class="p">}</span>
<a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>
<a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>        <span class="s2">"native:extenttolayer"</span><span class="p">,</span>
<a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>        <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2302" name="__codelineno-0-2302"></a>        <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2303" name="__codelineno-0-2303"></a>    <span class="p">)</span>
<a id="__codelineno-0-2304" name="__codelineno-0-2304"></a>
<a id="__codelineno-0-2305" name="__codelineno-0-2305"></a>    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.log_message" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">log_message</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.log_message" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">log_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'qgis_cplus'</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Logs the message into QGIS logs using qgis_cplus as the default
log instance.
If notify_user is True, user will be notified about the log.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>message</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The log message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of te log instance, qgis_cplus is the default</p>
              </div>
            </td>
            <td>
                  <code>'qgis_cplus'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>info</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the message is about info or a warning</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>notify</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to notify user about the log</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"qgis_cplus"</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="n">notify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="p">):</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="sd">"""Logs the message into QGIS logs using qgis_cplus as the default</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    log instance.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">    If notify_user is True, user will be notified about the log.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    :param message: The log message</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    :type message: str</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    :param name: Name of te log instance, qgis_cplus is the default</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    :type message: str</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    :param info: Whether the message is about info or a</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        warning</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    :type info: bool</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    :param notify: Whether to notify user about the log</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    :type notify: bool</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">    """</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CustomJsonEncoder</span><span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">todict</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="bp">cls</span><span class="o">=</span><span class="n">CustomJsonEncoder</span><span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span> <span class="n">notify</span><span class="o">=</span><span class="n">notify</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.mask_layer_difference" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">mask_layer_difference</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.mask_layer_difference" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">mask_layer_difference</span><span class="p">(</span><span class="n">input_layer</span><span class="p">,</span> <span class="n">overlay_layer</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Creates a new vector layer that contains
 difference of features between the two passed layers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input_layer</code></td>
            <td>
                  <code><span title="qgis.core.QgsVectorLayer">QgsVectorLayer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input layer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>overlay_layer</code></td>
            <td>
                  <code><span title="qgis.core.QgsVectorLayer">QgsVectorLayer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target overlay layer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>QgsVectorLayer</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vector layer</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2307" name="__codelineno-0-2307"></a><span class="k">def</span> <span class="nf">mask_layer_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_layer</span><span class="p">,</span> <span class="n">overlay_layer</span><span class="p">):</span>
<a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>    <span class="sd">"""Creates a new vector layer that contains</span>
<a id="__codelineno-0-2309" name="__codelineno-0-2309"></a><span class="sd">     difference of features between the two passed layers.</span>
<a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>
<a id="__codelineno-0-2311" name="__codelineno-0-2311"></a><span class="sd">    :param input_layer: Input layer</span>
<a id="__codelineno-0-2312" name="__codelineno-0-2312"></a><span class="sd">    :type input_layer: QgsVectorLayer</span>
<a id="__codelineno-0-2313" name="__codelineno-0-2313"></a>
<a id="__codelineno-0-2314" name="__codelineno-0-2314"></a><span class="sd">    :param overlay_layer: Target overlay layer</span>
<a id="__codelineno-0-2315" name="__codelineno-0-2315"></a><span class="sd">    :type overlay_layer: QgsVectorLayer</span>
<a id="__codelineno-0-2316" name="__codelineno-0-2316"></a>
<a id="__codelineno-0-2317" name="__codelineno-0-2317"></a><span class="sd">    :returns: Vector layer</span>
<a id="__codelineno-0-2318" name="__codelineno-0-2318"></a><span class="sd">    :rtype: QgsVectorLayer</span>
<a id="__codelineno-0-2319" name="__codelineno-0-2319"></a><span class="sd">    """</span>
<a id="__codelineno-0-2320" name="__codelineno-0-2320"></a>
<a id="__codelineno-0-2321" name="__codelineno-0-2321"></a>    <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2322" name="__codelineno-0-2322"></a>        <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">input_layer</span><span class="p">,</span>
<a id="__codelineno-0-2323" name="__codelineno-0-2323"></a>        <span class="s2">"OVERLAY"</span><span class="p">:</span> <span class="n">overlay_layer</span><span class="p">,</span>
<a id="__codelineno-0-2324" name="__codelineno-0-2324"></a>        <span class="s2">"OVERLAY_FIELDS_PREFIX"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a id="__codelineno-0-2325" name="__codelineno-0-2325"></a>        <span class="s2">"GRID_SIZE"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2326" name="__codelineno-0-2326"></a>        <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span><span class="p">,</span>
<a id="__codelineno-0-2327" name="__codelineno-0-2327"></a>    <span class="p">}</span>
<a id="__codelineno-0-2328" name="__codelineno-0-2328"></a>
<a id="__codelineno-0-2329" name="__codelineno-0-2329"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>        <span class="s2">"native:symmetricaldifference"</span><span class="p">,</span>
<a id="__codelineno-0-2331" name="__codelineno-0-2331"></a>        <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-2332" name="__codelineno-0-2332"></a>        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2333" name="__codelineno-0-2333"></a>        <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>    <span class="p">)</span>
<a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>
<a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.merge_vector_layers" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">merge_vector_layers</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.merge_vector_layers" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">merge_vector_layers</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Merges the passed vector layers into a single layer</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>layers</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the vector layers paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>QgsMapLayer</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Merged vector layer</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2236" name="__codelineno-0-2236"></a><span class="k">def</span> <span class="nf">merge_vector_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">):</span>
<a id="__codelineno-0-2237" name="__codelineno-0-2237"></a>    <span class="sd">"""Merges the passed vector layers into a single layer</span>
<a id="__codelineno-0-2238" name="__codelineno-0-2238"></a>
<a id="__codelineno-0-2239" name="__codelineno-0-2239"></a><span class="sd">    :param layers: List of the vector layers paths</span>
<a id="__codelineno-0-2240" name="__codelineno-0-2240"></a><span class="sd">    :type layers: typing.List[str]</span>
<a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>
<a id="__codelineno-0-2242" name="__codelineno-0-2242"></a><span class="sd">    :return: Merged vector layer</span>
<a id="__codelineno-0-2243" name="__codelineno-0-2243"></a><span class="sd">    :rtype: QgsMapLayer</span>
<a id="__codelineno-0-2244" name="__codelineno-0-2244"></a><span class="sd">    """</span>
<a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>
<a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>    <span class="n">input_map_layers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>
<a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>    <span class="k">for</span> <span class="n">layer_path</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>        <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">layer_path</span><span class="p">,</span> <span class="s2">"mask"</span><span class="p">,</span> <span class="s2">"ogr"</span><span class="p">)</span>
<a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>            <span class="n">input_map_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
<a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>                <span class="sa">f</span><span class="s2">"Skipping invalid mask layer </span><span class="si">{</span><span class="n">layer_path</span><span class="si">}</span><span class="s2"> from masking."</span>
<a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>            <span class="p">)</span>
<a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_map_layers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_map_layers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>        <span class="k">return</span> <span class="n">input_map_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">source</span><span class="p">()</span>
<a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>
<a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">"Merging mask layers"</span><span class="p">))</span>
<a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>
<a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>    <span class="c1"># Actual processing calculation</span>
<a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>    <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>        <span class="s2">"LAYERS"</span><span class="p">:</span> <span class="n">input_map_layers</span><span class="p">,</span>
<a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>        <span class="s2">"CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>        <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span><span class="p">,</span>
<a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>    <span class="p">}</span>
<a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>
<a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Used parameters for merging mask layers: </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>
<a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>        <span class="s2">"native:mergevectorlayers"</span><span class="p">,</span>
<a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>        <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>        <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>    <span class="p">)</span>
<a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>
<a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.on_terminated" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">on_terminated</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.on_terminated" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">on_terminated</span><span class="p">(</span><span class="n">hide</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Called when the task is terminated.</p>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="k">def</span> <span class="nf">on_terminated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hide</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="sd">"""Called when the task is terminated."""</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="k">if</span> <span class="n">hide</span><span class="p">:</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="n">message</span> <span class="o">=</span> <span class="s2">"Processing has been minimized by the user."</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">message</span> <span class="o">=</span> <span class="s2">"Processing has been cancelled by the user."</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Problem in running scenario analysis: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.replace_nodata" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">replace_nodata</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.replace_nodata" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">replace_nodata</span><span class="p">(</span><span class="n">layer_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Adds nodata value info into the layer available
in the passed layer_path and saves the layer in the passed output_path.</p>
<p>The addition will replace any current nodata value available in
the input layer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>layer_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input layer path. Must be a valid file path to a raster layer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output layer path. Must be a valid file path where the modified raster will be saved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nodata_value</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>No data value to be set in the output layer. Defaults to -9999.0</p>
              </div>
            </td>
            <td>
                  <code>-9999.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the task operations were successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="k">def</span> <span class="nf">replace_nodata</span><span class="p">(</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">layer_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nodata_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999.0</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="p">):</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="sd">"""Adds nodata value info into the layer available</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    in the passed layer_path and saves the layer in the passed output_path.</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">    The addition will replace any current nodata value available in</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    the input layer.</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">    :param layer_path: Input layer path. Must be a valid file path to a raster layer.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    :type layer_path: str</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="sd">    :param output_path: Output layer path. Must be a valid file path where the modified raster will be saved.</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    :type output_path: str</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">    :param nodata_value: No data value to be set in the output layer. Defaults to -9999.0</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    :type nodata_value: float</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">    :returns: Whether the task operations were successful</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    """</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="s2">"COPY_SUBDATASETS"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="s2">"DATA_TYPE"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>  <span class="c1"># Float32</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="s2">"EXTRA"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">layer_path</span><span class="p">,</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="s2">"NODATA"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="s2">"OPTIONS"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="s2">"TARGET_CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span><span class="p">,</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="p">}</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="n">translate_output</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>            <span class="s2">"gdal:translate"</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>            <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>            <span class="n">is_child_algorithm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="p">)</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>            <span class="s2">"DATA_TYPE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Use Input Layer Data Type</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="s2">"EXTRA"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">translate_output</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">],</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="s2">"MULTITHREADING"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="s2">"NODATA"</span><span class="p">:</span> <span class="n">nodata_value</span><span class="p">,</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>            <span class="s2">"OPTIONS"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="s2">"RESAMPLING"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Nearest Neighbour</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="s2">"SOURCE_CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="s2">"TARGET_CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="s2">"TARGET_EXTENT"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="s2">"TARGET_EXTENT_CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="s2">"TARGET_RESOLUTION"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output_path</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>        <span class="p">}</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="s2">"gdal:warpreproject"</span><span class="p">,</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="n">is_child_algorithm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="p">)</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">return</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem replacing no data value from a snapping output, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.reproject_layer" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">reproject_layer</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.reproject_layer" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">reproject_layer</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">target_crs</span><span class="p">,</span> <span class="n">output_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_raster</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Reprojects the input layer to the target CRS and saves it in the
specified output directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input layer path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_crs</code></td>
            <td>
                  <code><span title="qgis.core.QgsCoordinateReferenceSystem">QgsCoordinateReferenceSystem</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target CRS to reproject the layer to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_directory</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the reprojected layer, defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_extent</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target extent, defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>is_raster</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Check if layer is raster, defaults to True</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the reprojected layer</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1418" name="__codelineno-0-1418"></a><span class="k">def</span> <span class="nf">reproject_layer</span><span class="p">(</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>    <span class="n">input_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>    <span class="n">target_crs</span><span class="p">:</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">,</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>    <span class="n">output_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>    <span class="n">target_extent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>    <span class="n">is_raster</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>    <span class="sd">"""Reprojects the input layer to the target CRS and saves it in the</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><span class="sd">    specified output directory.</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a><span class="sd">    :param input_path: Input layer path</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a><span class="sd">    :type input_path: str</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="sd">    :param target_crs: Target CRS to reproject the layer to</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="sd">    :type target_crs: QgsCoordinateReferenceSystem</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">    :param output_directory: Directory to save the reprojected layer, defaults to None</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">    :type output_directory: str, optional</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">    :param target_extent: Target extent, defaults to None</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><span class="sd">    :type target_extent: str, optional</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="sd">    :param is_raster: Check if layer is raster, defaults to True</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a><span class="sd">    :type is_raster: bool, optional</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a><span class="sd">    :returns: Path to the reprojected layer</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a><span class="sd">    :rtype: str</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a><span class="sd">    """</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_path</span><span class="p">):</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>            <span class="sa">f</span><span class="s2">"Input layer </span><span class="si">{</span><span class="n">input_path</span><span class="si">}</span><span class="s2"> does not exist, "</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>            <span class="sa">f</span><span class="s2">"skipping the layer reprojection."</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>        <span class="p">)</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>        <span class="k">if</span> <span class="n">output_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>            <span class="n">output_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>        <span class="n">ext</span> <span class="o">=</span> <span class="s2">"tif"</span> <span class="k">if</span> <span class="n">is_raster</span> <span class="k">else</span> <span class="s2">"shp"</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>        <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>            <span class="n">output_directory</span><span class="p">,</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">input_path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">uuid</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>        <span class="p">)</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>        <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>            <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">input_path</span><span class="p">,</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>            <span class="s2">"TARGET_CRS"</span><span class="p">:</span> <span class="n">target_crs</span><span class="p">,</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>            <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output_file</span><span class="p">,</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>        <span class="p">}</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="k">if</span> <span class="n">target_extent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">target_extent</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>            <span class="n">alg_params</span><span class="p">[</span><span class="s2">"TARGET_EXTENT"</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_extent</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>            <span class="sa">f</span><span class="s2">"Used parameters for layer reprojection: "</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>        <span class="p">)</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>            <span class="s2">"gdal:warpreproject"</span> <span class="k">if</span> <span class="n">is_raster</span> <span class="k">else</span> <span class="s2">"native:reprojectlayer"</span><span class="p">,</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>            <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>        <span class="p">)</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem reprojecting layer, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.reproject_pathways" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">reproject_pathways</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.reproject_pathways" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">reproject_pathways</span><span class="p">(</span><span class="n">target_crs</span><span class="p">,</span> <span class="n">target_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Reprojects the activity pathways and priority layers to the target CRS.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>target_crs</code></td>
            <td>
                  <code><span title="qgis.core.QgsCoordinateReferenceSystem">QgsCoordinateReferenceSystem</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target CRS to reproject the layers to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>target_extent</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target extent, defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1490" name="__codelineno-0-1490"></a><span class="k">def</span> <span class="nf">reproject_pathways</span><span class="p">(</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>    <span class="n">target_crs</span><span class="p">:</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">,</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>    <span class="n">target_extent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a><span class="p">):</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>    <span class="sd">"""</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a><span class="sd">    Reprojects the activity pathways and priority layers to the target CRS.</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a><span class="sd">    :param target_crs: Target CRS to reproject the layers to</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a><span class="sd">    :type target_crs: QgsCoordinateReferenceSystem</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a><span class="sd">    :param target_extent: Target extent, defaults to None</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a><span class="sd">    :type target_extent: str, optional</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a><span class="sd">    """</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>    <span class="k">if</span> <span class="n">target_crs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">target_crs</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>            <span class="n">tr</span><span class="p">(</span><span class="s2">"Invalid target CRS for reprojecting pathways."</span><span class="p">),</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>            <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>        <span class="p">)</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="s2">"Invalid target CRS for reprojecting pathways."</span><span class="p">)</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>        <span class="n">tr</span><span class="p">(</span><span class="s2">"Reprojecting the activity pathways and priority layers"</span><span class="p">)</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>    <span class="p">)</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>    <span class="n">pathways</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">NcsPathway</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>        <span class="c1"># Create directories for storing reprojected pathways and priority layers</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>        <span class="n">reprojected_pathways_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"pathways"</span><span class="p">,</span> <span class="s2">"reprojected"</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>        <span class="p">)</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>        <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">reprojected_pathways_directory</span><span class="p">)</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>        <span class="n">reprojected_priority_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"priority_layer"</span><span class="p">,</span> <span class="s2">"reprojected"</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>        <span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>        <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">reprojected_priority_directory</span><span class="p">)</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">:</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>                <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>            <span class="p">):</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>                    <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>                        <span class="sa">f</span><span class="s2">"No defined activity pathways or a"</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                        <span class="sa">f</span><span class="s2">" activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                    <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                <span class="p">)</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                    <span class="sa">f</span><span class="s2">"No defined activity pathways or a "</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>                    <span class="sa">f</span><span class="s2">"activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>                <span class="p">)</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">):</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>                    <span class="n">pathways</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>        <span class="c1"># Reproject priority layers</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>        <span class="c1"># Dict with PWL uuid as key and path as value</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>        <span class="n">priority_layers_paths</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>        <span class="k">for</span> <span class="n">priority_layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_priority_layers</span><span class="p">():</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>            <span class="k">if</span> <span class="n">priority_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>            <span class="n">priority_layer_path</span> <span class="o">=</span> <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">priority_layer_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>            <span class="n">priority_layers_paths</span><span class="p">[</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">priority_layer_path</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">priority_layer_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>                    <span class="sa">f</span><span class="s2">"Priority layer </span><span class="si">{</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not valid, "</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>                    <span class="sa">f</span><span class="s2">"skipping layer reprojection."</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>                <span class="p">)</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span> <span class="o">==</span> <span class="n">target_crs</span><span class="p">:</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>                    <span class="sa">f</span><span class="s2">"Priority layer </span><span class="si">{</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="si">}</span><span class="s2"> "</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>                    <span class="sa">f</span><span class="s2">"is already in the target CRS "</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">target_crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="si">}</span><span class="s2">, skipping layer reprojection."</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                <span class="p">)</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>            <span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reproject_layer</span><span class="p">(</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                <span class="n">priority_layer_path</span><span class="p">,</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>                <span class="n">target_crs</span><span class="p">,</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                <span class="n">reprojected_priority_directory</span><span class="p">,</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                <span class="n">target_extent</span><span class="p">,</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>            <span class="p">)</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>            <span class="k">if</span> <span class="n">output_path</span><span class="p">:</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>                <span class="n">priority_layers_paths</span><span class="p">[</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">output_path</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>        <span class="k">if</span> <span class="n">pathways</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>                <span class="n">pathway_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>                    <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pathway_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                        <span class="sa">f</span><span class="s2">"Pathway layer </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not valid, "</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>                        <span class="sa">f</span><span class="s2">"skipping layer reprojection."</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                <span class="k">if</span> <span class="n">pathway_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span> <span class="o">==</span> <span class="n">target_crs</span><span class="p">:</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                        <span class="sa">f</span><span class="s2">"Pathway layer </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is already in the target CRS "</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">target_crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="si">}</span><span class="s2">, skipping layer reprojection."</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                        <span class="sa">f</span><span class="s2">"Reprojecting </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> pathway layer to </span><span class="si">{</span><span class="n">target_crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                    <span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reproject_layer</span><span class="p">(</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                        <span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                        <span class="n">target_crs</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                        <span class="n">reprojected_pathways_directory</span><span class="p">,</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>                        <span class="n">target_extent</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                    <span class="k">if</span> <span class="n">output_path</span><span class="p">:</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                        <span class="n">pathway</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">output_path</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                    <span class="sa">f</span><span class="s2">"Reprojecting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">)</span><span class="si">}</span><span class="s2"> "</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                    <span class="sa">f</span><span class="s2">"priority weighting layers from pathway </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>                <span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                <span class="p">):</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>                    <span class="n">pathway_priority_layers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                    <span class="k">for</span> <span class="n">priority_layer</span> <span class="ow">in</span> <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">:</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                        <span class="n">pwl_uuid</span> <span class="o">=</span> <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>                        <span class="k">if</span> <span class="n">pwl_uuid</span> <span class="ow">in</span> <span class="n">priority_layers_paths</span><span class="p">:</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>                            <span class="n">priority_layer</span><span class="p">[</span><span class="s2">"path"</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority_layers_paths</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                                <span class="n">pwl_uuid</span><span class="p">,</span> <span class="s2">""</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                            <span class="p">)</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                        <span class="n">pathway_priority_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priority_layer</span><span class="p">)</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span> <span class="o">=</span> <span class="n">pathway_priority_layers</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem reprojecting layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Runs the main scenario analysis task operations</p>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="sd">"""Runs the main scenario analysis task operations"""</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_scenario_directory</span><span class="p">()</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">selected_pathway</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">pathway_found</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="k">if</span> <span class="n">pathway_found</span><span class="p">:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="k">break</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                <span class="k">if</span> <span class="n">pathway</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>                    <span class="n">pathway_found</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                    <span class="n">selected_pathway</span> <span class="o">=</span> <span class="n">pathway</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>                    <span class="k">break</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">target_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">selected_pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">selected_pathway</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_extent</span><span class="o">.</span><span class="n">crs</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="c1"># Use the CRS of the analysis if it is provided</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">dest_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_crs</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="c1"># Use the CRS of the target layer if it exists</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="c1"># or use EPSG:4326 as a default CRS</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">dest_crs</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="n">target_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                <span class="k">if</span> <span class="n">selected_pathway</span> <span class="ow">and</span> <span class="n">selected_pathway</span><span class="o">.</span><span class="n">path</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>                <span class="k">else</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="o">.</span><span class="n">fromEpsgId</span><span class="p">(</span><span class="n">DEFAULT_CRS_ID</span><span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="n">processing_extent</span> <span class="o">=</span> <span class="n">QgsRectangle</span><span class="p">(</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_extent</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_extent</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_extent</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_extent</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">snapped_extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align_extent</span><span class="p">(</span><span class="n">target_layer</span><span class="p">,</span> <span class="n">processing_extent</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="n">extent_string</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">snapped_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">()</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">snapped_extent</span><span class="o">.</span><span class="n">xMaximum</span><span class="p">()</span><span class="si">}</span><span class="s2">,"</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">snapped_extent</span><span class="o">.</span><span class="n">yMinimum</span><span class="p">()</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">snapped_extent</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="sa">f</span><span class="s2">" [</span><span class="si">{</span><span class="n">dest_crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="si">}</span><span class="s2">]"</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="s2">"Original area of interest extent: "</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">processing_extent</span><span class="o">.</span><span class="n">asWktPolygon</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="s2">"Snapped area of interest extent "</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">snapped_extent</span><span class="o">.</span><span class="n">asWktPolygon</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="c1"># Run pathways layers snapping using a specified reference layer</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">snapping_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">SNAPPING_ENABLED</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">reference_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_layer</span><span class="p">()</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="k">if</span> <span class="n">snapping_enabled</span> <span class="ow">and</span> <span class="n">reference_layer</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">snap_analysis_data</span><span class="p">(</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="n">extent_string</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>            <span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="c1"># Clip to StudyArea</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_to_studyarea</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">studyarea_path</span><span class="p">):</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="c1"># Reproject the study area to the EPSG:4326</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="c1"># The validate_vector_layer is successful when the layer is in EPSG:4326</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="n">studyarea_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reproject_layer</span><span class="p">(</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="n">input_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">studyarea_path</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                <span class="n">target_crs</span><span class="o">=</span><span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="s2">"EPSG:4326"</span><span class="p">),</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>                <span class="n">is_raster</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="c1"># Validate layer geometries</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="n">validated_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_vector_layer</span><span class="p">(</span><span class="n">studyarea_path</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">validated_path</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Invalid studyarea layer: </span><span class="si">{</span><span class="n">studyarea_path</span><span class="si">}</span><span class="s2"> "</span><span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">studyarea_path</span> <span class="o">=</span> <span class="n">validated_path</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">clip_analysis_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">studyarea_path</span><span class="p">)</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="c1"># Reproject the pathways and priority layers to the</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="c1"># scenario CRS if it is not the same as the pathways CRS</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reproject_pathways</span><span class="p">(</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                <span class="n">target_extent</span><span class="o">=</span><span class="n">extent_string</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                <span class="n">target_crs</span><span class="o">=</span><span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_crs</span><span class="p">),</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="p">)</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="c1"># Replace no data value for the pathways and priority layers</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">nodata_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                <span class="n">Settings</span><span class="o">.</span><span class="n">NCS_NO_DATA_VALUE</span><span class="p">,</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>                <span class="n">default</span><span class="o">=</span><span class="n">NO_DATA_VALUE</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>                <span class="n">setting_type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="p">)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="sa">f</span><span class="s2">"Replacing nodata value for the pathways and priority layers to </span><span class="si">{</span><span class="n">nodata_value</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_pathways_replace_nodata</span><span class="p">(</span><span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata_value</span><span class="p">)</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="c1"># Calculate total carbon mitigation values for the Naturebase pathways</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_pathways_carbon_summation</span><span class="p">()</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="c1"># Weight the pathways using the pathway suitability index</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="c1"># and priority group coefficients for the PWLs</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="n">save_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">NCS_WEIGHTED</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_pathways_weighting</span><span class="p">(</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_priority_layers_groups</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="n">extent_string</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">temporary_output</span><span class="o">=</span><span class="ow">not</span> <span class="n">save_output</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="p">)</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="c1"># Creating activities from the weighted pathways</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">save_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">LANDUSE_PROJECT</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="p">)</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_activities_analysis</span><span class="p">(</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">extent_string</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="n">temporary_output</span><span class="o">=</span><span class="ow">not</span> <span class="n">save_output</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="c1"># Normalize the activities.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="c1"># This is useful when weighting pathways with relative impact matrix</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="c1"># Activities created in previous step may have values greater than 1</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_activity_normalization</span><span class="p">()</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="c1"># Run masking of the activities layers</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="n">masking_layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_masking_layers</span><span class="p">()</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">if</span> <span class="n">masking_layers</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_activities_masking</span><span class="p">(</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                <span class="n">masking_layers</span><span class="p">,</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>                <span class="n">extent_string</span><span class="p">,</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="c1"># Run internal masking of the activities layers</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_internal_activities_masking</span><span class="p">(</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="n">extent_string</span><span class="p">,</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="c1"># Run sieve if enabled</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="n">sieve_enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">SIEVE_ENABLED</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="p">)</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="k">if</span> <span class="n">sieve_enabled</span><span class="p">:</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_activities_sieve</span><span class="p">(</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="c1"># After creating activities, we normalize them using the</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="c1"># suitability index</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">save_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">LANDUSE_NORMALIZED</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="c1"># Clean up activities</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_activities_cleaning</span><span class="p">(</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">extent_string</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="n">temporary_output</span><span class="o">=</span><span class="ow">not</span> <span class="n">save_output</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="c1"># Investability analysis</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_investability_analysis</span><span class="p">()</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="c1"># The highest position tool analysis</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="n">save_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">HIGHEST_POSITION</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="p">)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_highest_position_analysis</span><span class="p">(</span><span class="n">temporary_output</span><span class="o">=</span><span class="ow">not</span> <span class="n">save_output</span><span class="p">)</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Analysis failed with error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activities_analysis" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_activities_analysis</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activities_analysis" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_activities_analysis</span><span class="p">(</span><span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Runs the required activity analysis on the passed
activities pathways. The analysis is responsible for creating activities
layers from their respective pathways layers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activities</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the selected activities</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="SpatialExtent">SpatialExtent</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>selected extent from user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>temporary_output</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the processing outputs as temporary files</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the task operations was successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1657" name="__codelineno-0-1657"></a><span class="k">def</span> <span class="nf">run_activities_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>    <span class="sd">"""Runs the required activity analysis on the passed</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a><span class="sd">    activities pathways. The analysis is responsible for creating activities</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a><span class="sd">    layers from their respective pathways layers.</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a><span class="sd">    :param activities: List of the selected activities</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><span class="sd">    :type activities: typing.List[Activity]</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a><span class="sd">    :param extent: selected extent from user</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><span class="sd">    :type extent: SpatialExtent</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><span class="sd">    :param temporary_output: Whether to save the processing outputs as temporary</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a><span class="sd">    files</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a><span class="sd">    :type temporary_output: bool</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><span class="sd">    :returns: Whether the task operations was successful</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><span class="sd">    """</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>        <span class="c1"># Will not proceed if processing has been cancelled by the user</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">"Creating activity layers from pathways"</span><span class="p">))</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>            <span class="n">activities_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"activities"</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>            <span class="p">)</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>            <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">activities_directory</span><span class="p">)</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">clean_filename</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>            <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>                <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>            <span class="p">):</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>                    <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>                        <span class="sa">f</span><span class="s2">"No defined activity pathways or a"</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>                        <span class="sa">f</span><span class="s2">" activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>                    <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>                <span class="p">)</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>                    <span class="sa">f</span><span class="s2">"No defined activity pathways or an "</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>                    <span class="sa">f</span><span class="s2">"activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>                <span class="p">)</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>                <span class="n">activities_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>            <span class="p">)</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>            <span class="c1"># Due to the activities base class</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>            <span class="c1"># activity only one of the following blocks will be executed,</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>            <span class="c1"># the activity either contain a path or</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>            <span class="c1"># pathways</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>                <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">]</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>                <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>            <span class="n">output</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>                <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span> <span class="k">if</span> <span class="n">temporary_output</span> <span class="k">else</span> <span class="n">output_file</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>            <span class="p">)</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>            <span class="n">reference_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reference_layer</span><span class="p">()</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">reference_layer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">reference_layer</span> <span class="o">==</span> <span class="s2">""</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>                <span class="n">layers</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>            <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>                <span class="n">reference_layer</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>            <span class="c1"># Actual processing calculation</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>            <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>                <span class="s2">"IGNORE_NODATA"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">layers</span><span class="p">,</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>                <span class="s2">"EXTENT"</span><span class="p">:</span> <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>                <span class="s2">"OUTPUT_NODATA_VALUE"</span><span class="p">:</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>                    <span class="n">Settings</span><span class="o">.</span><span class="n">NCS_NO_DATA_VALUE</span><span class="p">,</span> <span class="n">NO_DATA_VALUE</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>                <span class="p">),</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>                <span class="s2">"REFERENCE_LAYER"</span><span class="p">:</span> <span class="n">reference_layer</span><span class="p">,</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>                <span class="s2">"STATISTIC"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Sum</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>            <span class="p">}</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>                <span class="sa">f</span><span class="s2">"Used parameters for "</span> <span class="sa">f</span><span class="s2">"activities generation: </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>            <span class="p">)</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>                <span class="s2">"native:cellstatistics"</span><span class="p">,</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>                <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>            <span class="p">)</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>            <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem creating activity layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activities_cleaning" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_activities_cleaning</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activities_cleaning" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_activities_cleaning</span><span class="p">(</span><span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Cleans the weighted activities replacing
zero values with no-data as they are not statistical meaningful for the
scenario analysis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activities</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Activities to be cleaned up.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Selected extent from user</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>temporary_output</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the processing outputs as temporary files</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the task operations was successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2886">2886</a></span>
<span class="normal"><a href="#__codelineno-0-2887">2887</a></span>
<span class="normal"><a href="#__codelineno-0-2888">2888</a></span>
<span class="normal"><a href="#__codelineno-0-2889">2889</a></span>
<span class="normal"><a href="#__codelineno-0-2890">2890</a></span>
<span class="normal"><a href="#__codelineno-0-2891">2891</a></span>
<span class="normal"><a href="#__codelineno-0-2892">2892</a></span>
<span class="normal"><a href="#__codelineno-0-2893">2893</a></span>
<span class="normal"><a href="#__codelineno-0-2894">2894</a></span>
<span class="normal"><a href="#__codelineno-0-2895">2895</a></span>
<span class="normal"><a href="#__codelineno-0-2896">2896</a></span>
<span class="normal"><a href="#__codelineno-0-2897">2897</a></span>
<span class="normal"><a href="#__codelineno-0-2898">2898</a></span>
<span class="normal"><a href="#__codelineno-0-2899">2899</a></span>
<span class="normal"><a href="#__codelineno-0-2900">2900</a></span>
<span class="normal"><a href="#__codelineno-0-2901">2901</a></span>
<span class="normal"><a href="#__codelineno-0-2902">2902</a></span>
<span class="normal"><a href="#__codelineno-0-2903">2903</a></span>
<span class="normal"><a href="#__codelineno-0-2904">2904</a></span>
<span class="normal"><a href="#__codelineno-0-2905">2905</a></span>
<span class="normal"><a href="#__codelineno-0-2906">2906</a></span>
<span class="normal"><a href="#__codelineno-0-2907">2907</a></span>
<span class="normal"><a href="#__codelineno-0-2908">2908</a></span>
<span class="normal"><a href="#__codelineno-0-2909">2909</a></span>
<span class="normal"><a href="#__codelineno-0-2910">2910</a></span>
<span class="normal"><a href="#__codelineno-0-2911">2911</a></span>
<span class="normal"><a href="#__codelineno-0-2912">2912</a></span>
<span class="normal"><a href="#__codelineno-0-2913">2913</a></span>
<span class="normal"><a href="#__codelineno-0-2914">2914</a></span>
<span class="normal"><a href="#__codelineno-0-2915">2915</a></span>
<span class="normal"><a href="#__codelineno-0-2916">2916</a></span>
<span class="normal"><a href="#__codelineno-0-2917">2917</a></span>
<span class="normal"><a href="#__codelineno-0-2918">2918</a></span>
<span class="normal"><a href="#__codelineno-0-2919">2919</a></span>
<span class="normal"><a href="#__codelineno-0-2920">2920</a></span>
<span class="normal"><a href="#__codelineno-0-2921">2921</a></span>
<span class="normal"><a href="#__codelineno-0-2922">2922</a></span>
<span class="normal"><a href="#__codelineno-0-2923">2923</a></span>
<span class="normal"><a href="#__codelineno-0-2924">2924</a></span>
<span class="normal"><a href="#__codelineno-0-2925">2925</a></span>
<span class="normal"><a href="#__codelineno-0-2926">2926</a></span>
<span class="normal"><a href="#__codelineno-0-2927">2927</a></span>
<span class="normal"><a href="#__codelineno-0-2928">2928</a></span>
<span class="normal"><a href="#__codelineno-0-2929">2929</a></span>
<span class="normal"><a href="#__codelineno-0-2930">2930</a></span>
<span class="normal"><a href="#__codelineno-0-2931">2931</a></span>
<span class="normal"><a href="#__codelineno-0-2932">2932</a></span>
<span class="normal"><a href="#__codelineno-0-2933">2933</a></span>
<span class="normal"><a href="#__codelineno-0-2934">2934</a></span>
<span class="normal"><a href="#__codelineno-0-2935">2935</a></span>
<span class="normal"><a href="#__codelineno-0-2936">2936</a></span>
<span class="normal"><a href="#__codelineno-0-2937">2937</a></span>
<span class="normal"><a href="#__codelineno-0-2938">2938</a></span>
<span class="normal"><a href="#__codelineno-0-2939">2939</a></span>
<span class="normal"><a href="#__codelineno-0-2940">2940</a></span>
<span class="normal"><a href="#__codelineno-0-2941">2941</a></span>
<span class="normal"><a href="#__codelineno-0-2942">2942</a></span>
<span class="normal"><a href="#__codelineno-0-2943">2943</a></span>
<span class="normal"><a href="#__codelineno-0-2944">2944</a></span>
<span class="normal"><a href="#__codelineno-0-2945">2945</a></span>
<span class="normal"><a href="#__codelineno-0-2946">2946</a></span>
<span class="normal"><a href="#__codelineno-0-2947">2947</a></span>
<span class="normal"><a href="#__codelineno-0-2948">2948</a></span>
<span class="normal"><a href="#__codelineno-0-2949">2949</a></span>
<span class="normal"><a href="#__codelineno-0-2950">2950</a></span>
<span class="normal"><a href="#__codelineno-0-2951">2951</a></span>
<span class="normal"><a href="#__codelineno-0-2952">2952</a></span>
<span class="normal"><a href="#__codelineno-0-2953">2953</a></span>
<span class="normal"><a href="#__codelineno-0-2954">2954</a></span>
<span class="normal"><a href="#__codelineno-0-2955">2955</a></span>
<span class="normal"><a href="#__codelineno-0-2956">2956</a></span>
<span class="normal"><a href="#__codelineno-0-2957">2957</a></span>
<span class="normal"><a href="#__codelineno-0-2958">2958</a></span>
<span class="normal"><a href="#__codelineno-0-2959">2959</a></span>
<span class="normal"><a href="#__codelineno-0-2960">2960</a></span>
<span class="normal"><a href="#__codelineno-0-2961">2961</a></span>
<span class="normal"><a href="#__codelineno-0-2962">2962</a></span>
<span class="normal"><a href="#__codelineno-0-2963">2963</a></span>
<span class="normal"><a href="#__codelineno-0-2964">2964</a></span>
<span class="normal"><a href="#__codelineno-0-2965">2965</a></span>
<span class="normal"><a href="#__codelineno-0-2966">2966</a></span>
<span class="normal"><a href="#__codelineno-0-2967">2967</a></span>
<span class="normal"><a href="#__codelineno-0-2968">2968</a></span>
<span class="normal"><a href="#__codelineno-0-2969">2969</a></span>
<span class="normal"><a href="#__codelineno-0-2970">2970</a></span>
<span class="normal"><a href="#__codelineno-0-2971">2971</a></span>
<span class="normal"><a href="#__codelineno-0-2972">2972</a></span>
<span class="normal"><a href="#__codelineno-0-2973">2973</a></span>
<span class="normal"><a href="#__codelineno-0-2974">2974</a></span>
<span class="normal"><a href="#__codelineno-0-2975">2975</a></span>
<span class="normal"><a href="#__codelineno-0-2976">2976</a></span>
<span class="normal"><a href="#__codelineno-0-2977">2977</a></span>
<span class="normal"><a href="#__codelineno-0-2978">2978</a></span>
<span class="normal"><a href="#__codelineno-0-2979">2979</a></span>
<span class="normal"><a href="#__codelineno-0-2980">2980</a></span>
<span class="normal"><a href="#__codelineno-0-2981">2981</a></span>
<span class="normal"><a href="#__codelineno-0-2982">2982</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2886" name="__codelineno-0-2886"></a><span class="k">def</span> <span class="nf">run_activities_cleaning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-2887" name="__codelineno-0-2887"></a>    <span class="sd">"""Cleans the weighted activities replacing</span>
<a id="__codelineno-0-2888" name="__codelineno-0-2888"></a><span class="sd">    zero values with no-data as they are not statistical meaningful for the</span>
<a id="__codelineno-0-2889" name="__codelineno-0-2889"></a><span class="sd">    scenario analysis.</span>
<a id="__codelineno-0-2890" name="__codelineno-0-2890"></a>
<a id="__codelineno-0-2891" name="__codelineno-0-2891"></a><span class="sd">    :param activities: Activities to be cleaned up.</span>
<a id="__codelineno-0-2892" name="__codelineno-0-2892"></a><span class="sd">    :type activities: typing.List[Activity]</span>
<a id="__codelineno-0-2893" name="__codelineno-0-2893"></a>
<a id="__codelineno-0-2894" name="__codelineno-0-2894"></a><span class="sd">    :param extent: Selected extent from user</span>
<a id="__codelineno-0-2895" name="__codelineno-0-2895"></a><span class="sd">    :type extent: str</span>
<a id="__codelineno-0-2896" name="__codelineno-0-2896"></a>
<a id="__codelineno-0-2897" name="__codelineno-0-2897"></a><span class="sd">    :param temporary_output: Whether to save the processing outputs as temporary</span>
<a id="__codelineno-0-2898" name="__codelineno-0-2898"></a><span class="sd">    files</span>
<a id="__codelineno-0-2899" name="__codelineno-0-2899"></a><span class="sd">    :type temporary_output: bool</span>
<a id="__codelineno-0-2900" name="__codelineno-0-2900"></a>
<a id="__codelineno-0-2901" name="__codelineno-0-2901"></a><span class="sd">    :returns: Whether the task operations was successful</span>
<a id="__codelineno-0-2902" name="__codelineno-0-2902"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-2903" name="__codelineno-0-2903"></a><span class="sd">    """</span>
<a id="__codelineno-0-2904" name="__codelineno-0-2904"></a>
<a id="__codelineno-0-2905" name="__codelineno-0-2905"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2906" name="__codelineno-0-2906"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2907" name="__codelineno-0-2907"></a>
<a id="__codelineno-0-2908" name="__codelineno-0-2908"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">"Updating activity values"</span><span class="p">))</span>
<a id="__codelineno-0-2909" name="__codelineno-0-2909"></a>
<a id="__codelineno-0-2910" name="__codelineno-0-2910"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-2911" name="__codelineno-0-2911"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
<a id="__codelineno-0-2912" name="__codelineno-0-2912"></a>            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-2913" name="__codelineno-0-2913"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-2914" name="__codelineno-0-2914"></a>                    <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-2915" name="__codelineno-0-2915"></a>                        <span class="sa">f</span><span class="s2">"Problem when running activity updates, "</span>
<a id="__codelineno-0-2916" name="__codelineno-0-2916"></a>                        <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2917" name="__codelineno-0-2917"></a>                    <span class="p">),</span>
<a id="__codelineno-0-2918" name="__codelineno-0-2918"></a>                    <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-2919" name="__codelineno-0-2919"></a>                <span class="p">)</span>
<a id="__codelineno-0-2920" name="__codelineno-0-2920"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2921" name="__codelineno-0-2921"></a>                    <span class="sa">f</span><span class="s2">"Problem when running activity updates, "</span>
<a id="__codelineno-0-2922" name="__codelineno-0-2922"></a>                    <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2923" name="__codelineno-0-2923"></a>                <span class="p">)</span>
<a id="__codelineno-0-2924" name="__codelineno-0-2924"></a>
<a id="__codelineno-0-2925" name="__codelineno-0-2925"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2926" name="__codelineno-0-2926"></a>
<a id="__codelineno-0-2927" name="__codelineno-0-2927"></a>            <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">]</span>
<a id="__codelineno-0-2928" name="__codelineno-0-2928"></a>
<a id="__codelineno-0-2929" name="__codelineno-0-2929"></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">clean_filename</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
<a id="__codelineno-0-2930" name="__codelineno-0-2930"></a>
<a id="__codelineno-0-2931" name="__codelineno-0-2931"></a>            <span class="n">weighted_pathways_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2932" name="__codelineno-0-2932"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"weighted_pathways"</span>
<a id="__codelineno-0-2933" name="__codelineno-0-2933"></a>            <span class="p">)</span>
<a id="__codelineno-0-2934" name="__codelineno-0-2934"></a>            <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">weighted_pathways_dir</span><span class="p">)</span>
<a id="__codelineno-0-2935" name="__codelineno-0-2935"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2936" name="__codelineno-0-2936"></a>                <span class="n">weighted_pathways_dir</span><span class="p">,</span>
<a id="__codelineno-0-2937" name="__codelineno-0-2937"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">_cleaned.tif"</span><span class="p">,</span>
<a id="__codelineno-0-2938" name="__codelineno-0-2938"></a>            <span class="p">)</span>
<a id="__codelineno-0-2939" name="__codelineno-0-2939"></a>
<a id="__codelineno-0-2940" name="__codelineno-0-2940"></a>            <span class="c1"># Actual processing calculation</span>
<a id="__codelineno-0-2941" name="__codelineno-0-2941"></a>            <span class="c1"># The aim is to convert pixels values to no data, that is why we are</span>
<a id="__codelineno-0-2942" name="__codelineno-0-2942"></a>            <span class="c1"># using the sum operation with only one layer.</span>
<a id="__codelineno-0-2943" name="__codelineno-0-2943"></a>
<a id="__codelineno-0-2944" name="__codelineno-0-2944"></a>            <span class="n">output</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2945" name="__codelineno-0-2945"></a>                <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span> <span class="k">if</span> <span class="n">temporary_output</span> <span class="k">else</span> <span class="n">output_file</span>
<a id="__codelineno-0-2946" name="__codelineno-0-2946"></a>            <span class="p">)</span>
<a id="__codelineno-0-2947" name="__codelineno-0-2947"></a>
<a id="__codelineno-0-2948" name="__codelineno-0-2948"></a>            <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2949" name="__codelineno-0-2949"></a>                <span class="s2">"IGNORE_NODATA"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2950" name="__codelineno-0-2950"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">layers</span><span class="p">,</span>
<a id="__codelineno-0-2951" name="__codelineno-0-2951"></a>                <span class="s2">"EXTENT"</span><span class="p">:</span> <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-2952" name="__codelineno-0-2952"></a>                <span class="s2">"OUTPUT_NODATA_VALUE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2953" name="__codelineno-0-2953"></a>                <span class="s2">"REFERENCE_LAYER"</span><span class="p">:</span> <span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2954" name="__codelineno-0-2954"></a>                <span class="s2">"STATISTIC"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Sum</span>
<a id="__codelineno-0-2955" name="__codelineno-0-2955"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span>
<a id="__codelineno-0-2956" name="__codelineno-0-2956"></a>            <span class="p">}</span>
<a id="__codelineno-0-2957" name="__codelineno-0-2957"></a>
<a id="__codelineno-0-2958" name="__codelineno-0-2958"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2959" name="__codelineno-0-2959"></a>                <span class="sa">f</span><span class="s2">"Used parameters for "</span>
<a id="__codelineno-0-2960" name="__codelineno-0-2960"></a>                <span class="sa">f</span><span class="s2">"updates on the cleaned activities: </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-2961" name="__codelineno-0-2961"></a>            <span class="p">)</span>
<a id="__codelineno-0-2962" name="__codelineno-0-2962"></a>
<a id="__codelineno-0-2963" name="__codelineno-0-2963"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-2964" name="__codelineno-0-2964"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-2965" name="__codelineno-0-2965"></a>
<a id="__codelineno-0-2966" name="__codelineno-0-2966"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2967" name="__codelineno-0-2967"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2968" name="__codelineno-0-2968"></a>
<a id="__codelineno-0-2969" name="__codelineno-0-2969"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2970" name="__codelineno-0-2970"></a>                <span class="s2">"native:cellstatistics"</span><span class="p">,</span>
<a id="__codelineno-0-2971" name="__codelineno-0-2971"></a>                <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-2972" name="__codelineno-0-2972"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2973" name="__codelineno-0-2973"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2974" name="__codelineno-0-2974"></a>            <span class="p">)</span>
<a id="__codelineno-0-2975" name="__codelineno-0-2975"></a>            <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2976" name="__codelineno-0-2976"></a>
<a id="__codelineno-0-2977" name="__codelineno-0-2977"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-2978" name="__codelineno-0-2978"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem cleaning activities, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-2979" name="__codelineno-0-2979"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2980" name="__codelineno-0-2980"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2981" name="__codelineno-0-2981"></a>
<a id="__codelineno-0-2982" name="__codelineno-0-2982"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activities_masking" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_activities_masking</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activities_masking" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_activities_masking</span><span class="p">(</span><span class="n">activities</span><span class="p">,</span> <span class="n">masking_layers</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Applies the mask layers into the passed activities</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activities</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the selected activities</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>masking_layers</code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Paths to the mask layers to be used</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>selected extent from user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>temporary_output</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the processing outputs as temporary files</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the task operations was successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1876" name="__codelineno-0-1876"></a><span class="k">def</span> <span class="nf">run_activities_masking</span><span class="p">(</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">activities</span><span class="p">,</span> <span class="n">masking_layers</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a><span class="p">):</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>    <span class="sd">"""Applies the mask layers into the passed activities</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a><span class="sd">    :param activities: List of the selected activities</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a><span class="sd">    :type activities: typing.List[Activity]</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a><span class="sd">    :param masking_layers: Paths to the mask layers to be used</span>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a><span class="sd">    :type masking_layers: dict</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a><span class="sd">    :param extent: selected extent from user</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a><span class="sd">    :type extent: str</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a><span class="sd">    :param temporary_output: Whether to save the processing outputs as temporary</span>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a><span class="sd">    files</span>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a><span class="sd">    :type temporary_output: bool</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><span class="sd">    :returns: Whether the task operations was successful</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><span class="sd">    """</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a>        <span class="c1"># Will not proceed if processing has been cancelled by the user</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">"Masking activities using the saved masked layers"</span><span class="p">))</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">masking_layers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">masking_layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a>            <span class="n">initial_mask_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_vector_layers</span><span class="p">(</span><span class="n">masking_layers</span><span class="p">)</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a>            <span class="n">mask_layer_path</span> <span class="o">=</span> <span class="n">masking_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a>            <span class="n">initial_mask_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">mask_layer_path</span><span class="p">,</span> <span class="s2">"mask"</span><span class="p">,</span> <span class="s2">"ogr"</span><span class="p">)</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">initial_mask_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>                <span class="sa">f</span><span class="s2">"Skipping activities masking "</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>                <span class="sa">f</span><span class="s2">"using layer </span><span class="si">{</span><span class="n">mask_layer_path</span><span class="si">}</span><span class="s2">, not a valid layer."</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>            <span class="p">)</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>        <span class="c1"># see https://qgis.org/pyqgis/master/core/Qgis.html#qgis.core.Qgis.GeometryType</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>        <span class="k">if</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">versionInt</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">33000</span><span class="p">:</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>            <span class="n">layer_check</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>                <span class="n">initial_mask_layer</span><span class="o">.</span><span class="n">geometryType</span><span class="p">()</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>                <span class="o">==</span> <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">GeometryType</span><span class="o">.</span><span class="n">PolygonGeometry</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>            <span class="p">)</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>            <span class="n">layer_check</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>                <span class="n">initial_mask_layer</span><span class="o">.</span><span class="n">geometryType</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">GeometryType</span><span class="o">.</span><span class="n">Polygon</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>            <span class="p">)</span>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_check</span><span class="p">:</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>                <span class="sa">f</span><span class="s2">"Skipping activities masking "</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>                <span class="sa">f</span><span class="s2">"using layer </span><span class="si">{</span><span class="n">mask_layer_path</span><span class="si">}</span><span class="s2">, not a polygon layer."</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>            <span class="p">)</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>        <span class="n">extent_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">)</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>        <span class="n">mask_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_layer_difference</span><span class="p">(</span><span class="n">initial_mask_layer</span><span class="p">,</span> <span class="n">extent_layer</span><span class="p">)</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask_layer</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>            <span class="n">mask_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">mask_layer</span><span class="p">,</span> <span class="s2">"ogr"</span><span class="p">)</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>                <span class="sa">f</span><span class="s2">"Skipping activities masking "</span>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>                <span class="sa">f</span><span class="s2">"the created difference mask layer </span><span class="si">{</span><span class="n">mask_layer</span><span class="o">.</span><span class="n">source</span><span class="p">()</span><span class="si">}</span><span class="s2">,"</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>                <span class="sa">f</span><span class="s2">" not a valid layer."</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>            <span class="p">)</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>                        <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>                            <span class="sa">f</span><span class="s2">"Problem when masking activities, "</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>                            <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>                        <span class="p">),</span>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>                        <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>                        <span class="sa">f</span><span class="s2">"Problem when masking activities, "</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>                        <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>                    <span class="c1"># If the user cancelled the processing</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>                        <span class="n">tr</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing has been cancelled by the user."</span><span class="p">),</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>                        <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing has been cancelled by the user."</span><span class="p">)</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>            <span class="n">masked_activities_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"masked_activities"</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>            <span class="p">)</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>            <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">masked_activities_directory</span><span class="p">)</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">clean_filename</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>                <span class="n">masked_activities_directory</span><span class="p">,</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>            <span class="p">)</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>            <span class="n">output</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>                <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span> <span class="k">if</span> <span class="n">temporary_output</span> <span class="k">else</span> <span class="n">output_file</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>            <span class="p">)</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>            <span class="n">activity_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">"activity_layer"</span><span class="p">)</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>            <span class="k">if</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span> <span class="o">!=</span> <span class="n">mask_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">():</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>                    <span class="sa">f</span><span class="s2">"Skipping masking, activity layer and"</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>                    <span class="sa">f</span><span class="s2">" mask layer(s) have different CRS"</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>                <span class="p">)</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">mask_layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()):</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>                    <span class="s2">"Skipping masking, the extents of the activity layer "</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>                    <span class="s2">"and mask layer(s) do not overlap."</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>                <span class="p">)</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>            <span class="c1"># Actual processing calculation</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>            <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>                <span class="s2">"MASK"</span><span class="p">:</span> <span class="n">mask_layer</span><span class="p">,</span>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>                <span class="s2">"SOURCE_CRS"</span><span class="p">:</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>                <span class="s2">"DESTINATION_CRS"</span><span class="p">:</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>                <span class="s2">"TARGET_EXTENT"</span><span class="p">:</span> <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>                <span class="s2">"NO_DATA"</span><span class="p">:</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>                    <span class="n">Settings</span><span class="o">.</span><span class="n">NCS_NO_DATA_VALUE</span><span class="p">,</span> <span class="n">NO_DATA_VALUE</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>                <span class="p">),</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>            <span class="p">}</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>                <span class="sa">f</span><span class="s2">"Used parameters for masking activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> "</span>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>                <span class="sa">f</span><span class="s2">"using project mask layers: </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>            <span class="p">)</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>                <span class="s2">"gdal:cliprasterbymasklayer"</span><span class="p">,</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>                <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>            <span class="p">)</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>            <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem masking activities layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activities_sieve" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_activities_sieve</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activities_sieve" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_activities_sieve</span><span class="p">(</span><span class="n">activities</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Runs the sieve functionality analysis on the passed activities layers,
removing the activities layer polygons that are smaller than the provided
threshold size (in pixels) and replaces them with the pixel value of
the largest neighbour polygon.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activities</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the analyzed activities.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Selected area of interest extent</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>temporary_output</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the processing outputs as temporary files</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the task operations was successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span>
<span class="normal"><a href="#__codelineno-0-2369">2369</a></span>
<span class="normal"><a href="#__codelineno-0-2370">2370</a></span>
<span class="normal"><a href="#__codelineno-0-2371">2371</a></span>
<span class="normal"><a href="#__codelineno-0-2372">2372</a></span>
<span class="normal"><a href="#__codelineno-0-2373">2373</a></span>
<span class="normal"><a href="#__codelineno-0-2374">2374</a></span>
<span class="normal"><a href="#__codelineno-0-2375">2375</a></span>
<span class="normal"><a href="#__codelineno-0-2376">2376</a></span>
<span class="normal"><a href="#__codelineno-0-2377">2377</a></span>
<span class="normal"><a href="#__codelineno-0-2378">2378</a></span>
<span class="normal"><a href="#__codelineno-0-2379">2379</a></span>
<span class="normal"><a href="#__codelineno-0-2380">2380</a></span>
<span class="normal"><a href="#__codelineno-0-2381">2381</a></span>
<span class="normal"><a href="#__codelineno-0-2382">2382</a></span>
<span class="normal"><a href="#__codelineno-0-2383">2383</a></span>
<span class="normal"><a href="#__codelineno-0-2384">2384</a></span>
<span class="normal"><a href="#__codelineno-0-2385">2385</a></span>
<span class="normal"><a href="#__codelineno-0-2386">2386</a></span>
<span class="normal"><a href="#__codelineno-0-2387">2387</a></span>
<span class="normal"><a href="#__codelineno-0-2388">2388</a></span>
<span class="normal"><a href="#__codelineno-0-2389">2389</a></span>
<span class="normal"><a href="#__codelineno-0-2390">2390</a></span>
<span class="normal"><a href="#__codelineno-0-2391">2391</a></span>
<span class="normal"><a href="#__codelineno-0-2392">2392</a></span>
<span class="normal"><a href="#__codelineno-0-2393">2393</a></span>
<span class="normal"><a href="#__codelineno-0-2394">2394</a></span>
<span class="normal"><a href="#__codelineno-0-2395">2395</a></span>
<span class="normal"><a href="#__codelineno-0-2396">2396</a></span>
<span class="normal"><a href="#__codelineno-0-2397">2397</a></span>
<span class="normal"><a href="#__codelineno-0-2398">2398</a></span>
<span class="normal"><a href="#__codelineno-0-2399">2399</a></span>
<span class="normal"><a href="#__codelineno-0-2400">2400</a></span>
<span class="normal"><a href="#__codelineno-0-2401">2401</a></span>
<span class="normal"><a href="#__codelineno-0-2402">2402</a></span>
<span class="normal"><a href="#__codelineno-0-2403">2403</a></span>
<span class="normal"><a href="#__codelineno-0-2404">2404</a></span>
<span class="normal"><a href="#__codelineno-0-2405">2405</a></span>
<span class="normal"><a href="#__codelineno-0-2406">2406</a></span>
<span class="normal"><a href="#__codelineno-0-2407">2407</a></span>
<span class="normal"><a href="#__codelineno-0-2408">2408</a></span>
<span class="normal"><a href="#__codelineno-0-2409">2409</a></span>
<span class="normal"><a href="#__codelineno-0-2410">2410</a></span>
<span class="normal"><a href="#__codelineno-0-2411">2411</a></span>
<span class="normal"><a href="#__codelineno-0-2412">2412</a></span>
<span class="normal"><a href="#__codelineno-0-2413">2413</a></span>
<span class="normal"><a href="#__codelineno-0-2414">2414</a></span>
<span class="normal"><a href="#__codelineno-0-2415">2415</a></span>
<span class="normal"><a href="#__codelineno-0-2416">2416</a></span>
<span class="normal"><a href="#__codelineno-0-2417">2417</a></span>
<span class="normal"><a href="#__codelineno-0-2418">2418</a></span>
<span class="normal"><a href="#__codelineno-0-2419">2419</a></span>
<span class="normal"><a href="#__codelineno-0-2420">2420</a></span>
<span class="normal"><a href="#__codelineno-0-2421">2421</a></span>
<span class="normal"><a href="#__codelineno-0-2422">2422</a></span>
<span class="normal"><a href="#__codelineno-0-2423">2423</a></span>
<span class="normal"><a href="#__codelineno-0-2424">2424</a></span>
<span class="normal"><a href="#__codelineno-0-2425">2425</a></span>
<span class="normal"><a href="#__codelineno-0-2426">2426</a></span>
<span class="normal"><a href="#__codelineno-0-2427">2427</a></span>
<span class="normal"><a href="#__codelineno-0-2428">2428</a></span>
<span class="normal"><a href="#__codelineno-0-2429">2429</a></span>
<span class="normal"><a href="#__codelineno-0-2430">2430</a></span>
<span class="normal"><a href="#__codelineno-0-2431">2431</a></span>
<span class="normal"><a href="#__codelineno-0-2432">2432</a></span>
<span class="normal"><a href="#__codelineno-0-2433">2433</a></span>
<span class="normal"><a href="#__codelineno-0-2434">2434</a></span>
<span class="normal"><a href="#__codelineno-0-2435">2435</a></span>
<span class="normal"><a href="#__codelineno-0-2436">2436</a></span>
<span class="normal"><a href="#__codelineno-0-2437">2437</a></span>
<span class="normal"><a href="#__codelineno-0-2438">2438</a></span>
<span class="normal"><a href="#__codelineno-0-2439">2439</a></span>
<span class="normal"><a href="#__codelineno-0-2440">2440</a></span>
<span class="normal"><a href="#__codelineno-0-2441">2441</a></span>
<span class="normal"><a href="#__codelineno-0-2442">2442</a></span>
<span class="normal"><a href="#__codelineno-0-2443">2443</a></span>
<span class="normal"><a href="#__codelineno-0-2444">2444</a></span>
<span class="normal"><a href="#__codelineno-0-2445">2445</a></span>
<span class="normal"><a href="#__codelineno-0-2446">2446</a></span>
<span class="normal"><a href="#__codelineno-0-2447">2447</a></span>
<span class="normal"><a href="#__codelineno-0-2448">2448</a></span>
<span class="normal"><a href="#__codelineno-0-2449">2449</a></span>
<span class="normal"><a href="#__codelineno-0-2450">2450</a></span>
<span class="normal"><a href="#__codelineno-0-2451">2451</a></span>
<span class="normal"><a href="#__codelineno-0-2452">2452</a></span>
<span class="normal"><a href="#__codelineno-0-2453">2453</a></span>
<span class="normal"><a href="#__codelineno-0-2454">2454</a></span>
<span class="normal"><a href="#__codelineno-0-2455">2455</a></span>
<span class="normal"><a href="#__codelineno-0-2456">2456</a></span>
<span class="normal"><a href="#__codelineno-0-2457">2457</a></span>
<span class="normal"><a href="#__codelineno-0-2458">2458</a></span>
<span class="normal"><a href="#__codelineno-0-2459">2459</a></span>
<span class="normal"><a href="#__codelineno-0-2460">2460</a></span>
<span class="normal"><a href="#__codelineno-0-2461">2461</a></span>
<span class="normal"><a href="#__codelineno-0-2462">2462</a></span>
<span class="normal"><a href="#__codelineno-0-2463">2463</a></span>
<span class="normal"><a href="#__codelineno-0-2464">2464</a></span>
<span class="normal"><a href="#__codelineno-0-2465">2465</a></span>
<span class="normal"><a href="#__codelineno-0-2466">2466</a></span>
<span class="normal"><a href="#__codelineno-0-2467">2467</a></span>
<span class="normal"><a href="#__codelineno-0-2468">2468</a></span>
<span class="normal"><a href="#__codelineno-0-2469">2469</a></span>
<span class="normal"><a href="#__codelineno-0-2470">2470</a></span>
<span class="normal"><a href="#__codelineno-0-2471">2471</a></span>
<span class="normal"><a href="#__codelineno-0-2472">2472</a></span>
<span class="normal"><a href="#__codelineno-0-2473">2473</a></span>
<span class="normal"><a href="#__codelineno-0-2474">2474</a></span>
<span class="normal"><a href="#__codelineno-0-2475">2475</a></span>
<span class="normal"><a href="#__codelineno-0-2476">2476</a></span>
<span class="normal"><a href="#__codelineno-0-2477">2477</a></span>
<span class="normal"><a href="#__codelineno-0-2478">2478</a></span>
<span class="normal"><a href="#__codelineno-0-2479">2479</a></span>
<span class="normal"><a href="#__codelineno-0-2480">2480</a></span>
<span class="normal"><a href="#__codelineno-0-2481">2481</a></span>
<span class="normal"><a href="#__codelineno-0-2482">2482</a></span>
<span class="normal"><a href="#__codelineno-0-2483">2483</a></span>
<span class="normal"><a href="#__codelineno-0-2484">2484</a></span>
<span class="normal"><a href="#__codelineno-0-2485">2485</a></span>
<span class="normal"><a href="#__codelineno-0-2486">2486</a></span>
<span class="normal"><a href="#__codelineno-0-2487">2487</a></span>
<span class="normal"><a href="#__codelineno-0-2488">2488</a></span>
<span class="normal"><a href="#__codelineno-0-2489">2489</a></span>
<span class="normal"><a href="#__codelineno-0-2490">2490</a></span>
<span class="normal"><a href="#__codelineno-0-2491">2491</a></span>
<span class="normal"><a href="#__codelineno-0-2492">2492</a></span>
<span class="normal"><a href="#__codelineno-0-2493">2493</a></span>
<span class="normal"><a href="#__codelineno-0-2494">2494</a></span>
<span class="normal"><a href="#__codelineno-0-2495">2495</a></span>
<span class="normal"><a href="#__codelineno-0-2496">2496</a></span>
<span class="normal"><a href="#__codelineno-0-2497">2497</a></span>
<span class="normal"><a href="#__codelineno-0-2498">2498</a></span>
<span class="normal"><a href="#__codelineno-0-2499">2499</a></span>
<span class="normal"><a href="#__codelineno-0-2500">2500</a></span>
<span class="normal"><a href="#__codelineno-0-2501">2501</a></span>
<span class="normal"><a href="#__codelineno-0-2502">2502</a></span>
<span class="normal"><a href="#__codelineno-0-2503">2503</a></span>
<span class="normal"><a href="#__codelineno-0-2504">2504</a></span>
<span class="normal"><a href="#__codelineno-0-2505">2505</a></span>
<span class="normal"><a href="#__codelineno-0-2506">2506</a></span>
<span class="normal"><a href="#__codelineno-0-2507">2507</a></span>
<span class="normal"><a href="#__codelineno-0-2508">2508</a></span>
<span class="normal"><a href="#__codelineno-0-2509">2509</a></span>
<span class="normal"><a href="#__codelineno-0-2510">2510</a></span>
<span class="normal"><a href="#__codelineno-0-2511">2511</a></span>
<span class="normal"><a href="#__codelineno-0-2512">2512</a></span>
<span class="normal"><a href="#__codelineno-0-2513">2513</a></span>
<span class="normal"><a href="#__codelineno-0-2514">2514</a></span>
<span class="normal"><a href="#__codelineno-0-2515">2515</a></span>
<span class="normal"><a href="#__codelineno-0-2516">2516</a></span>
<span class="normal"><a href="#__codelineno-0-2517">2517</a></span>
<span class="normal"><a href="#__codelineno-0-2518">2518</a></span>
<span class="normal"><a href="#__codelineno-0-2519">2519</a></span>
<span class="normal"><a href="#__codelineno-0-2520">2520</a></span>
<span class="normal"><a href="#__codelineno-0-2521">2521</a></span>
<span class="normal"><a href="#__codelineno-0-2522">2522</a></span>
<span class="normal"><a href="#__codelineno-0-2523">2523</a></span>
<span class="normal"><a href="#__codelineno-0-2524">2524</a></span>
<span class="normal"><a href="#__codelineno-0-2525">2525</a></span>
<span class="normal"><a href="#__codelineno-0-2526">2526</a></span>
<span class="normal"><a href="#__codelineno-0-2527">2527</a></span>
<span class="normal"><a href="#__codelineno-0-2528">2528</a></span>
<span class="normal"><a href="#__codelineno-0-2529">2529</a></span>
<span class="normal"><a href="#__codelineno-0-2530">2530</a></span>
<span class="normal"><a href="#__codelineno-0-2531">2531</a></span>
<span class="normal"><a href="#__codelineno-0-2532">2532</a></span>
<span class="normal"><a href="#__codelineno-0-2533">2533</a></span>
<span class="normal"><a href="#__codelineno-0-2534">2534</a></span>
<span class="normal"><a href="#__codelineno-0-2535">2535</a></span>
<span class="normal"><a href="#__codelineno-0-2536">2536</a></span>
<span class="normal"><a href="#__codelineno-0-2537">2537</a></span>
<span class="normal"><a href="#__codelineno-0-2538">2538</a></span>
<span class="normal"><a href="#__codelineno-0-2539">2539</a></span>
<span class="normal"><a href="#__codelineno-0-2540">2540</a></span>
<span class="normal"><a href="#__codelineno-0-2541">2541</a></span>
<span class="normal"><a href="#__codelineno-0-2542">2542</a></span>
<span class="normal"><a href="#__codelineno-0-2543">2543</a></span>
<span class="normal"><a href="#__codelineno-0-2544">2544</a></span>
<span class="normal"><a href="#__codelineno-0-2545">2545</a></span>
<span class="normal"><a href="#__codelineno-0-2546">2546</a></span>
<span class="normal"><a href="#__codelineno-0-2547">2547</a></span>
<span class="normal"><a href="#__codelineno-0-2548">2548</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2338" name="__codelineno-0-2338"></a><span class="k">def</span> <span class="nf">run_activities_sieve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activities</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>    <span class="sd">"""Runs the sieve functionality analysis on the passed activities layers,</span>
<a id="__codelineno-0-2340" name="__codelineno-0-2340"></a><span class="sd">    removing the activities layer polygons that are smaller than the provided</span>
<a id="__codelineno-0-2341" name="__codelineno-0-2341"></a><span class="sd">    threshold size (in pixels) and replaces them with the pixel value of</span>
<a id="__codelineno-0-2342" name="__codelineno-0-2342"></a><span class="sd">    the largest neighbour polygon.</span>
<a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>
<a id="__codelineno-0-2344" name="__codelineno-0-2344"></a><span class="sd">    :param activities: List of the analyzed activities.</span>
<a id="__codelineno-0-2345" name="__codelineno-0-2345"></a><span class="sd">    :type activities: typing.List[Activity]</span>
<a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>
<a id="__codelineno-0-2347" name="__codelineno-0-2347"></a><span class="sd">    :param extent: Selected area of interest extent</span>
<a id="__codelineno-0-2348" name="__codelineno-0-2348"></a><span class="sd">    :type extent: str</span>
<a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>
<a id="__codelineno-0-2350" name="__codelineno-0-2350"></a><span class="sd">    :param temporary_output: Whether to save the processing outputs as temporary</span>
<a id="__codelineno-0-2351" name="__codelineno-0-2351"></a><span class="sd">    files</span>
<a id="__codelineno-0-2352" name="__codelineno-0-2352"></a><span class="sd">    :type temporary_output: bool</span>
<a id="__codelineno-0-2353" name="__codelineno-0-2353"></a>
<a id="__codelineno-0-2354" name="__codelineno-0-2354"></a><span class="sd">    :returns: Whether the task operations was successful</span>
<a id="__codelineno-0-2355" name="__codelineno-0-2355"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-2356" name="__codelineno-0-2356"></a><span class="sd">    """</span>
<a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>        <span class="c1"># Will not proceed if processing has been cancelled by the user</span>
<a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>
<a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">"Applying sieve function to the activities"</span><span class="p">))</span>
<a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>
<a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
<a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>                        <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-2369" name="__codelineno-0-2369"></a>                            <span class="sa">f</span><span class="s2">"Problem when running sieve function on activities, "</span>
<a id="__codelineno-0-2370" name="__codelineno-0-2370"></a>                            <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2371" name="__codelineno-0-2371"></a>                        <span class="p">),</span>
<a id="__codelineno-0-2372" name="__codelineno-0-2372"></a>                        <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-2373" name="__codelineno-0-2373"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2374" name="__codelineno-0-2374"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2375" name="__codelineno-0-2375"></a>                        <span class="sa">f</span><span class="s2">"Problem when running sieve function on activities, "</span>
<a id="__codelineno-0-2376" name="__codelineno-0-2376"></a>                        <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2377" name="__codelineno-0-2377"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2378" name="__codelineno-0-2378"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2379" name="__codelineno-0-2379"></a>                    <span class="c1"># If the user cancelled the processing</span>
<a id="__codelineno-0-2380" name="__codelineno-0-2380"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-2381" name="__codelineno-0-2381"></a>                        <span class="n">tr</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing has been cancelled by the user."</span><span class="p">),</span>
<a id="__codelineno-0-2382" name="__codelineno-0-2382"></a>                        <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-2383" name="__codelineno-0-2383"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2384" name="__codelineno-0-2384"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing has been cancelled by the user."</span><span class="p">)</span>
<a id="__codelineno-0-2385" name="__codelineno-0-2385"></a>
<a id="__codelineno-0-2386" name="__codelineno-0-2386"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2387" name="__codelineno-0-2387"></a>
<a id="__codelineno-0-2388" name="__codelineno-0-2388"></a>            <span class="n">sieved_activities_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2389" name="__codelineno-0-2389"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"sieved_activities"</span>
<a id="__codelineno-0-2390" name="__codelineno-0-2390"></a>            <span class="p">)</span>
<a id="__codelineno-0-2391" name="__codelineno-0-2391"></a>            <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">sieved_activities_directory</span><span class="p">)</span>
<a id="__codelineno-0-2392" name="__codelineno-0-2392"></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">clean_filename</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
<a id="__codelineno-0-2393" name="__codelineno-0-2393"></a>
<a id="__codelineno-0-2394" name="__codelineno-0-2394"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2395" name="__codelineno-0-2395"></a>                <span class="n">sieved_activities_directory</span><span class="p">,</span>
<a id="__codelineno-0-2396" name="__codelineno-0-2396"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-2397" name="__codelineno-0-2397"></a>            <span class="p">)</span>
<a id="__codelineno-0-2398" name="__codelineno-0-2398"></a>
<a id="__codelineno-0-2399" name="__codelineno-0-2399"></a>            <span class="n">threshold_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
<a id="__codelineno-0-2400" name="__codelineno-0-2400"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">SIEVE_THRESHOLD</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-2401" name="__codelineno-0-2401"></a>            <span class="p">)</span>
<a id="__codelineno-0-2402" name="__codelineno-0-2402"></a>
<a id="__codelineno-0-2403" name="__codelineno-0-2403"></a>            <span class="n">mask_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-2404" name="__codelineno-0-2404"></a>                <span class="n">Settings</span><span class="o">.</span><span class="n">SIEVE_MASK_PATH</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">""</span>
<a id="__codelineno-0-2405" name="__codelineno-0-2405"></a>            <span class="p">)</span>
<a id="__codelineno-0-2406" name="__codelineno-0-2406"></a>
<a id="__codelineno-0-2407" name="__codelineno-0-2407"></a>            <span class="n">no_mask</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mask_layer</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mask_layer</span><span class="p">))</span>
<a id="__codelineno-0-2408" name="__codelineno-0-2408"></a>            <span class="n">mask_layer_ref</span> <span class="o">=</span> <span class="n">mask_layer</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">no_mask</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-2409" name="__codelineno-0-2409"></a>
<a id="__codelineno-0-2410" name="__codelineno-0-2410"></a>            <span class="n">output</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2411" name="__codelineno-0-2411"></a>                <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span> <span class="k">if</span> <span class="n">temporary_output</span> <span class="k">else</span> <span class="n">output_file</span>
<a id="__codelineno-0-2412" name="__codelineno-0-2412"></a>            <span class="p">)</span>
<a id="__codelineno-0-2413" name="__codelineno-0-2413"></a>
<a id="__codelineno-0-2414" name="__codelineno-0-2414"></a>            <span class="n">input_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2415" name="__codelineno-0-2415"></a>
<a id="__codelineno-0-2416" name="__codelineno-0-2416"></a>            <span class="c1"># Step 1: Create a binary mask from the original raster</span>
<a id="__codelineno-0-2417" name="__codelineno-0-2417"></a>            <span class="n">binary_mask</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2418" name="__codelineno-0-2418"></a>                <span class="s2">"qgis:rastercalculator"</span><span class="p">,</span>
<a id="__codelineno-0-2419" name="__codelineno-0-2419"></a>                <span class="p">{</span>
<a id="__codelineno-0-2420" name="__codelineno-0-2420"></a>                    <span class="s2">"CELLSIZE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2421" name="__codelineno-0-2421"></a>                    <span class="s2">"LAYERS"</span><span class="p">:</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">],</span>
<a id="__codelineno-0-2422" name="__codelineno-0-2422"></a>                    <span class="s2">"CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2423" name="__codelineno-0-2423"></a>                    <span class="s2">"EXPRESSION"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">input_name</span><span class="si">}</span><span class="s2">@1 &gt; 0"</span><span class="p">,</span>
<a id="__codelineno-0-2424" name="__codelineno-0-2424"></a>                    <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-2425" name="__codelineno-0-2425"></a>                <span class="p">},</span>
<a id="__codelineno-0-2426" name="__codelineno-0-2426"></a>            <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2427" name="__codelineno-0-2427"></a>
<a id="__codelineno-0-2428" name="__codelineno-0-2428"></a>            <span class="n">sieve_alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2429" name="__codelineno-0-2429"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">binary_mask</span><span class="p">,</span>
<a id="__codelineno-0-2430" name="__codelineno-0-2430"></a>                <span class="s2">"THRESHOLD"</span><span class="p">:</span> <span class="n">threshold_value</span><span class="p">,</span>
<a id="__codelineno-0-2431" name="__codelineno-0-2431"></a>                <span class="s2">"EIGHT_CONNECTEDNESS"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2432" name="__codelineno-0-2432"></a>                <span class="s2">"NO_MASK"</span><span class="p">:</span> <span class="n">no_mask</span><span class="p">,</span>
<a id="__codelineno-0-2433" name="__codelineno-0-2433"></a>                <span class="s2">"MASK_LAYER"</span><span class="p">:</span> <span class="n">mask_layer_ref</span><span class="p">,</span>
<a id="__codelineno-0-2434" name="__codelineno-0-2434"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-2435" name="__codelineno-0-2435"></a>            <span class="p">}</span>
<a id="__codelineno-0-2436" name="__codelineno-0-2436"></a>
<a id="__codelineno-0-2437" name="__codelineno-0-2437"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Used parameters for sieving: </span><span class="si">{</span><span class="n">sieve_alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-2438" name="__codelineno-0-2438"></a>
<a id="__codelineno-0-2439" name="__codelineno-0-2439"></a>            <span class="c1"># Step 2: Run sieve analysis from the output of the binary mask</span>
<a id="__codelineno-0-2440" name="__codelineno-0-2440"></a>            <span class="n">sieved_mask</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2441" name="__codelineno-0-2441"></a>                <span class="s2">"gdal:sieve"</span><span class="p">,</span>
<a id="__codelineno-0-2442" name="__codelineno-0-2442"></a>                <span class="n">sieve_alg_params</span><span class="p">,</span>
<a id="__codelineno-0-2443" name="__codelineno-0-2443"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2444" name="__codelineno-0-2444"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2445" name="__codelineno-0-2445"></a>            <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2446" name="__codelineno-0-2446"></a>
<a id="__codelineno-0-2447" name="__codelineno-0-2447"></a>            <span class="n">expr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sieved_mask</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">@1 &gt; 0) * </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sieved_mask</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">@1"</span>
<a id="__codelineno-0-2448" name="__codelineno-0-2448"></a>
<a id="__codelineno-0-2449" name="__codelineno-0-2449"></a>            <span class="c1"># Step 3: Remove and convert any no data value to 0</span>
<a id="__codelineno-0-2450" name="__codelineno-0-2450"></a>            <span class="n">sieved_mask_clean</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2451" name="__codelineno-0-2451"></a>                <span class="s2">"qgis:rastercalculator"</span><span class="p">,</span>
<a id="__codelineno-0-2452" name="__codelineno-0-2452"></a>                <span class="p">{</span>
<a id="__codelineno-0-2453" name="__codelineno-0-2453"></a>                    <span class="s2">"CELLSIZE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2454" name="__codelineno-0-2454"></a>                    <span class="s2">"LAYERS"</span><span class="p">:</span> <span class="p">[</span><span class="n">sieved_mask</span><span class="p">],</span>
<a id="__codelineno-0-2455" name="__codelineno-0-2455"></a>                    <span class="s2">"CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2456" name="__codelineno-0-2456"></a>                    <span class="s2">"EXPRESSION"</span><span class="p">:</span> <span class="n">expr</span><span class="p">,</span>
<a id="__codelineno-0-2457" name="__codelineno-0-2457"></a>                    <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-2458" name="__codelineno-0-2458"></a>                <span class="p">},</span>
<a id="__codelineno-0-2459" name="__codelineno-0-2459"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2460" name="__codelineno-0-2460"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2461" name="__codelineno-0-2461"></a>            <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2462" name="__codelineno-0-2462"></a>
<a id="__codelineno-0-2463" name="__codelineno-0-2463"></a>            <span class="n">expr_2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">input_name</span><span class="si">}</span><span class="s2">@1 * </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sieved_mask_clean</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">@1"</span>
<a id="__codelineno-0-2464" name="__codelineno-0-2464"></a>
<a id="__codelineno-0-2465" name="__codelineno-0-2465"></a>            <span class="c1"># Step 4: Join the sieved mask with the original input layer to filter out the small areas</span>
<a id="__codelineno-0-2466" name="__codelineno-0-2466"></a>            <span class="n">sieve_output</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2467" name="__codelineno-0-2467"></a>                <span class="s2">"qgis:rastercalculator"</span><span class="p">,</span>
<a id="__codelineno-0-2468" name="__codelineno-0-2468"></a>                <span class="p">{</span>
<a id="__codelineno-0-2469" name="__codelineno-0-2469"></a>                    <span class="s2">"CELLSIZE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2470" name="__codelineno-0-2470"></a>                    <span class="s2">"LAYERS"</span><span class="p">:</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">sieved_mask_clean</span><span class="p">],</span>
<a id="__codelineno-0-2471" name="__codelineno-0-2471"></a>                    <span class="s2">"CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2472" name="__codelineno-0-2472"></a>                    <span class="s2">"EXPRESSION"</span><span class="p">:</span> <span class="n">expr_2</span><span class="p">,</span>
<a id="__codelineno-0-2473" name="__codelineno-0-2473"></a>                    <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-2474" name="__codelineno-0-2474"></a>                <span class="p">},</span>
<a id="__codelineno-0-2475" name="__codelineno-0-2475"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2476" name="__codelineno-0-2476"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2477" name="__codelineno-0-2477"></a>            <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2478" name="__codelineno-0-2478"></a>
<a id="__codelineno-0-2479" name="__codelineno-0-2479"></a>            <span class="c1"># Step 5. Replace all 0 with NO_DATA_VALUE using if</span>
<a id="__codelineno-0-2480" name="__codelineno-0-2480"></a>            <span class="c1"># ("combined@1" &lt;= 0, NO_DATA_VALUE, "combined@1")</span>
<a id="__codelineno-0-2481" name="__codelineno-0-2481"></a>            <span class="n">no_data_replace_exp</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2482" name="__codelineno-0-2482"></a>                <span class="sa">f</span><span class="s2">"(A &gt; 0)*A + (A &lt;= 0)*</span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">no_data_value</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2483" name="__codelineno-0-2483"></a>            <span class="p">)</span>
<a id="__codelineno-0-2484" name="__codelineno-0-2484"></a>            <span class="n">sieve_output_updated</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2485" name="__codelineno-0-2485"></a>                <span class="s2">"gdal:rastercalculator"</span><span class="p">,</span>
<a id="__codelineno-0-2486" name="__codelineno-0-2486"></a>                <span class="p">{</span>
<a id="__codelineno-0-2487" name="__codelineno-0-2487"></a>                    <span class="s2">"INPUT_A"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">sieve_output</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a id="__codelineno-0-2488" name="__codelineno-0-2488"></a>                    <span class="s2">"BAND_A"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-2489" name="__codelineno-0-2489"></a>                    <span class="s2">"FORMULA"</span><span class="p">:</span> <span class="n">no_data_replace_exp</span><span class="p">,</span>
<a id="__codelineno-0-2490" name="__codelineno-0-2490"></a>                    <span class="s2">"NO_DATA"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2491" name="__codelineno-0-2491"></a>                    <span class="s2">"EXTENT_OPT"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2492" name="__codelineno-0-2492"></a>                    <span class="s2">"RTYPE"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-2493" name="__codelineno-0-2493"></a>                    <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="s2">"TEMPORARY_OUTPUT"</span><span class="p">,</span>
<a id="__codelineno-0-2494" name="__codelineno-0-2494"></a>                <span class="p">},</span>
<a id="__codelineno-0-2495" name="__codelineno-0-2495"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2496" name="__codelineno-0-2496"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2497" name="__codelineno-0-2497"></a>            <span class="p">)[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2498" name="__codelineno-0-2498"></a>
<a id="__codelineno-0-2499" name="__codelineno-0-2499"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sieve_output_updated</span><span class="p">):</span>
<a id="__codelineno-0-2500" name="__codelineno-0-2500"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2501" name="__codelineno-0-2501"></a>                    <span class="sa">f</span><span class="s2">"Problem running sieve function "</span>
<a id="__codelineno-0-2502" name="__codelineno-0-2502"></a>                    <span class="sa">f</span><span class="s2">"on activity layers, sieve intermediate layer not found"</span>
<a id="__codelineno-0-2503" name="__codelineno-0-2503"></a>                    <span class="sa">f</span><span class="s2">" </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-2504" name="__codelineno-0-2504"></a>                <span class="p">)</span>
<a id="__codelineno-0-2505" name="__codelineno-0-2505"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">()</span>
<a id="__codelineno-0-2506" name="__codelineno-0-2506"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2507" name="__codelineno-0-2507"></a>
<a id="__codelineno-0-2508" name="__codelineno-0-2508"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-2509" name="__codelineno-0-2509"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-2510" name="__codelineno-0-2510"></a>
<a id="__codelineno-0-2511" name="__codelineno-0-2511"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2512" name="__codelineno-0-2512"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2513" name="__codelineno-0-2513"></a>
<a id="__codelineno-0-2514" name="__codelineno-0-2514"></a>            <span class="c1"># Step 6. Run sum statistics with ignore no data values set to false</span>
<a id="__codelineno-0-2515" name="__codelineno-0-2515"></a>            <span class="c1"># and no data value</span>
<a id="__codelineno-0-2516" name="__codelineno-0-2516"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2517" name="__codelineno-0-2517"></a>                <span class="s2">"native:cellstatistics"</span><span class="p">,</span>
<a id="__codelineno-0-2518" name="__codelineno-0-2518"></a>                <span class="p">{</span>
<a id="__codelineno-0-2519" name="__codelineno-0-2519"></a>                    <span class="s2">"INPUT"</span><span class="p">:</span> <span class="p">[</span><span class="n">sieve_output_updated</span><span class="p">],</span>
<a id="__codelineno-0-2520" name="__codelineno-0-2520"></a>                    <span class="s2">"STATISTIC"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2521" name="__codelineno-0-2521"></a>                    <span class="s2">"IGNORE_NODATA"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2522" name="__codelineno-0-2522"></a>                    <span class="s2">"REFERENCE_LAYER"</span><span class="p">:</span> <span class="n">sieve_output_updated</span><span class="p">,</span>
<a id="__codelineno-0-2523" name="__codelineno-0-2523"></a>                    <span class="s2">"OUTPUT_NODATA_VALUE"</span><span class="p">:</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-2524" name="__codelineno-0-2524"></a>                        <span class="n">Settings</span><span class="o">.</span><span class="n">NCS_NO_DATA_VALUE</span><span class="p">,</span> <span class="n">NO_DATA_VALUE</span>
<a id="__codelineno-0-2525" name="__codelineno-0-2525"></a>                    <span class="p">),</span>
<a id="__codelineno-0-2526" name="__codelineno-0-2526"></a>                    <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span>
<a id="__codelineno-0-2527" name="__codelineno-0-2527"></a>                <span class="p">},</span>
<a id="__codelineno-0-2528" name="__codelineno-0-2528"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2529" name="__codelineno-0-2529"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2530" name="__codelineno-0-2530"></a>            <span class="p">)</span>
<a id="__codelineno-0-2531" name="__codelineno-0-2531"></a>
<a id="__codelineno-0-2532" name="__codelineno-0-2532"></a>            <span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-2533" name="__codelineno-0-2533"></a>
<a id="__codelineno-0-2534" name="__codelineno-0-2534"></a>            <span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-2535" name="__codelineno-0-2535"></a>
<a id="__codelineno-0-2536" name="__codelineno-0-2536"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2537" name="__codelineno-0-2537"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2538" name="__codelineno-0-2538"></a>
<a id="__codelineno-0-2539" name="__codelineno-0-2539"></a>            <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2540" name="__codelineno-0-2540"></a>
<a id="__codelineno-0-2541" name="__codelineno-0-2541"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-2542" name="__codelineno-0-2542"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2543" name="__codelineno-0-2543"></a>            <span class="sa">f</span><span class="s2">"Problem running sieve function on activity layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-2544" name="__codelineno-0-2544"></a>        <span class="p">)</span>
<a id="__codelineno-0-2545" name="__codelineno-0-2545"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2546" name="__codelineno-0-2546"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2547" name="__codelineno-0-2547"></a>
<a id="__codelineno-0-2548" name="__codelineno-0-2548"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activity_normalization" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_activity_normalization</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_activity_normalization" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_activity_normalization</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Runs normalization analysis on the activities.
The formula is: (activity - min) / (max - min)</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1769" name="__codelineno-0-1769"></a><span class="k">def</span> <span class="nf">run_activity_normalization</span><span class="p">(</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>    <span class="sd">"""Runs normalization analysis on the activities.</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a><span class="sd">    The formula is: (activity - min) / (max - min)</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a><span class="sd">    """</span>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">"Normalization of activities"</span><span class="p">))</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>    <span class="n">normalized_activities_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"normalized_activities"</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>    <span class="p">)</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>    <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">normalized_activities_directory</span><span class="p">)</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">:</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"No defined activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>                    <span class="n">tr</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>                    <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>                <span class="p">)</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>            <span class="n">activity_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>                    <span class="sa">f</span><span class="s2">"Activity layer </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not valid, "</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>                    <span class="sa">f</span><span class="s2">"skipping the layer from normalization."</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>                <span class="p">)</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>            <span class="n">provider</span> <span class="o">=</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>            <span class="n">band_statistics</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">bandStatistics</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a>            <span class="n">min_value</span> <span class="o">=</span> <span class="n">band_statistics</span><span class="o">.</span><span class="n">minimumValue</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>            <span class="n">max_value</span> <span class="o">=</span> <span class="n">band_statistics</span><span class="o">.</span><span class="n">maximumValue</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>            <span class="k">if</span> <span class="n">min_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>                    <span class="sa">f</span><span class="s2">"Activity layer </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has no valid "</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>                    <span class="sa">f</span><span class="s2">"statistics, skipping the layer from normalization."</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>                <span class="p">)</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>            <span class="k">if</span> <span class="n">min_value</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">max_value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>                <span class="n">new_path</span> <span class="o">=</span> <span class="n">FileUtils</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>                    <span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">normalized_activities_directory</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>                <span class="p">)</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>                <span class="k">if</span> <span class="n">new_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>                    <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">new_path</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>                        <span class="sa">f</span><span class="s2">"Activity layer </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is already normalized (min=</span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s2">, max=</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s2">), "</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>                        <span class="sa">f</span><span class="s2">"skipping the layer from normalization."</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>                <span class="k">continue</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Normalizing </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> activity layer </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>            <span class="n">expression</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"(A - </span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s2">) / (</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s2">)"</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">normalized_activities_directory</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_norm_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>            <span class="p">)</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>            <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>                <span class="s2">"INPUT_A"</span><span class="p">:</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>                <span class="s2">"BAND_A"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>                <span class="s2">"FORMULA"</span><span class="p">:</span> <span class="n">expression</span><span class="p">,</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>                <span class="s2">"OPTIONS"</span><span class="p">:</span> <span class="s2">"COMPRESS=DEFLATE|ZLEVEL=6|TILED=YES"</span><span class="p">,</span>  <span class="c1"># Compress the layer</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output_path</span><span class="p">,</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>            <span class="p">}</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>                <span class="s2">"gdal:rastercalculator"</span><span class="p">,</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>                <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>            <span class="p">)</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"OUTPUT"</span><span class="p">):</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>                <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"OUTPUT"</span><span class="p">)</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>                    <span class="sa">f</span><span class="s2">"Problem normalizing activity layer </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, "</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>                    <span class="sa">f</span><span class="s2">"skipping the layer from normalization."</span>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>                <span class="p">)</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem normalizing activities, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_highest_position_analysis" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_highest_position_analysis</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_highest_position_analysis" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_highest_position_analysis</span><span class="p">(</span><span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Runs the highest position analysis which is last step
in scenario analysis. Uses the activities set by the current ongoing
analysis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>temporary_output</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the processing outputs as temporary files</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the task operations was successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3322">3322</a></span>
<span class="normal"><a href="#__codelineno-0-3323">3323</a></span>
<span class="normal"><a href="#__codelineno-0-3324">3324</a></span>
<span class="normal"><a href="#__codelineno-0-3325">3325</a></span>
<span class="normal"><a href="#__codelineno-0-3326">3326</a></span>
<span class="normal"><a href="#__codelineno-0-3327">3327</a></span>
<span class="normal"><a href="#__codelineno-0-3328">3328</a></span>
<span class="normal"><a href="#__codelineno-0-3329">3329</a></span>
<span class="normal"><a href="#__codelineno-0-3330">3330</a></span>
<span class="normal"><a href="#__codelineno-0-3331">3331</a></span>
<span class="normal"><a href="#__codelineno-0-3332">3332</a></span>
<span class="normal"><a href="#__codelineno-0-3333">3333</a></span>
<span class="normal"><a href="#__codelineno-0-3334">3334</a></span>
<span class="normal"><a href="#__codelineno-0-3335">3335</a></span>
<span class="normal"><a href="#__codelineno-0-3336">3336</a></span>
<span class="normal"><a href="#__codelineno-0-3337">3337</a></span>
<span class="normal"><a href="#__codelineno-0-3338">3338</a></span>
<span class="normal"><a href="#__codelineno-0-3339">3339</a></span>
<span class="normal"><a href="#__codelineno-0-3340">3340</a></span>
<span class="normal"><a href="#__codelineno-0-3341">3341</a></span>
<span class="normal"><a href="#__codelineno-0-3342">3342</a></span>
<span class="normal"><a href="#__codelineno-0-3343">3343</a></span>
<span class="normal"><a href="#__codelineno-0-3344">3344</a></span>
<span class="normal"><a href="#__codelineno-0-3345">3345</a></span>
<span class="normal"><a href="#__codelineno-0-3346">3346</a></span>
<span class="normal"><a href="#__codelineno-0-3347">3347</a></span>
<span class="normal"><a href="#__codelineno-0-3348">3348</a></span>
<span class="normal"><a href="#__codelineno-0-3349">3349</a></span>
<span class="normal"><a href="#__codelineno-0-3350">3350</a></span>
<span class="normal"><a href="#__codelineno-0-3351">3351</a></span>
<span class="normal"><a href="#__codelineno-0-3352">3352</a></span>
<span class="normal"><a href="#__codelineno-0-3353">3353</a></span>
<span class="normal"><a href="#__codelineno-0-3354">3354</a></span>
<span class="normal"><a href="#__codelineno-0-3355">3355</a></span>
<span class="normal"><a href="#__codelineno-0-3356">3356</a></span>
<span class="normal"><a href="#__codelineno-0-3357">3357</a></span>
<span class="normal"><a href="#__codelineno-0-3358">3358</a></span>
<span class="normal"><a href="#__codelineno-0-3359">3359</a></span>
<span class="normal"><a href="#__codelineno-0-3360">3360</a></span>
<span class="normal"><a href="#__codelineno-0-3361">3361</a></span>
<span class="normal"><a href="#__codelineno-0-3362">3362</a></span>
<span class="normal"><a href="#__codelineno-0-3363">3363</a></span>
<span class="normal"><a href="#__codelineno-0-3364">3364</a></span>
<span class="normal"><a href="#__codelineno-0-3365">3365</a></span>
<span class="normal"><a href="#__codelineno-0-3366">3366</a></span>
<span class="normal"><a href="#__codelineno-0-3367">3367</a></span>
<span class="normal"><a href="#__codelineno-0-3368">3368</a></span>
<span class="normal"><a href="#__codelineno-0-3369">3369</a></span>
<span class="normal"><a href="#__codelineno-0-3370">3370</a></span>
<span class="normal"><a href="#__codelineno-0-3371">3371</a></span>
<span class="normal"><a href="#__codelineno-0-3372">3372</a></span>
<span class="normal"><a href="#__codelineno-0-3373">3373</a></span>
<span class="normal"><a href="#__codelineno-0-3374">3374</a></span>
<span class="normal"><a href="#__codelineno-0-3375">3375</a></span>
<span class="normal"><a href="#__codelineno-0-3376">3376</a></span>
<span class="normal"><a href="#__codelineno-0-3377">3377</a></span>
<span class="normal"><a href="#__codelineno-0-3378">3378</a></span>
<span class="normal"><a href="#__codelineno-0-3379">3379</a></span>
<span class="normal"><a href="#__codelineno-0-3380">3380</a></span>
<span class="normal"><a href="#__codelineno-0-3381">3381</a></span>
<span class="normal"><a href="#__codelineno-0-3382">3382</a></span>
<span class="normal"><a href="#__codelineno-0-3383">3383</a></span>
<span class="normal"><a href="#__codelineno-0-3384">3384</a></span>
<span class="normal"><a href="#__codelineno-0-3385">3385</a></span>
<span class="normal"><a href="#__codelineno-0-3386">3386</a></span>
<span class="normal"><a href="#__codelineno-0-3387">3387</a></span>
<span class="normal"><a href="#__codelineno-0-3388">3388</a></span>
<span class="normal"><a href="#__codelineno-0-3389">3389</a></span>
<span class="normal"><a href="#__codelineno-0-3390">3390</a></span>
<span class="normal"><a href="#__codelineno-0-3391">3391</a></span>
<span class="normal"><a href="#__codelineno-0-3392">3392</a></span>
<span class="normal"><a href="#__codelineno-0-3393">3393</a></span>
<span class="normal"><a href="#__codelineno-0-3394">3394</a></span>
<span class="normal"><a href="#__codelineno-0-3395">3395</a></span>
<span class="normal"><a href="#__codelineno-0-3396">3396</a></span>
<span class="normal"><a href="#__codelineno-0-3397">3397</a></span>
<span class="normal"><a href="#__codelineno-0-3398">3398</a></span>
<span class="normal"><a href="#__codelineno-0-3399">3399</a></span>
<span class="normal"><a href="#__codelineno-0-3400">3400</a></span>
<span class="normal"><a href="#__codelineno-0-3401">3401</a></span>
<span class="normal"><a href="#__codelineno-0-3402">3402</a></span>
<span class="normal"><a href="#__codelineno-0-3403">3403</a></span>
<span class="normal"><a href="#__codelineno-0-3404">3404</a></span>
<span class="normal"><a href="#__codelineno-0-3405">3405</a></span>
<span class="normal"><a href="#__codelineno-0-3406">3406</a></span>
<span class="normal"><a href="#__codelineno-0-3407">3407</a></span>
<span class="normal"><a href="#__codelineno-0-3408">3408</a></span>
<span class="normal"><a href="#__codelineno-0-3409">3409</a></span>
<span class="normal"><a href="#__codelineno-0-3410">3410</a></span>
<span class="normal"><a href="#__codelineno-0-3411">3411</a></span>
<span class="normal"><a href="#__codelineno-0-3412">3412</a></span>
<span class="normal"><a href="#__codelineno-0-3413">3413</a></span>
<span class="normal"><a href="#__codelineno-0-3414">3414</a></span>
<span class="normal"><a href="#__codelineno-0-3415">3415</a></span>
<span class="normal"><a href="#__codelineno-0-3416">3416</a></span>
<span class="normal"><a href="#__codelineno-0-3417">3417</a></span>
<span class="normal"><a href="#__codelineno-0-3418">3418</a></span>
<span class="normal"><a href="#__codelineno-0-3419">3419</a></span>
<span class="normal"><a href="#__codelineno-0-3420">3420</a></span>
<span class="normal"><a href="#__codelineno-0-3421">3421</a></span>
<span class="normal"><a href="#__codelineno-0-3422">3422</a></span>
<span class="normal"><a href="#__codelineno-0-3423">3423</a></span>
<span class="normal"><a href="#__codelineno-0-3424">3424</a></span>
<span class="normal"><a href="#__codelineno-0-3425">3425</a></span>
<span class="normal"><a href="#__codelineno-0-3426">3426</a></span>
<span class="normal"><a href="#__codelineno-0-3427">3427</a></span>
<span class="normal"><a href="#__codelineno-0-3428">3428</a></span>
<span class="normal"><a href="#__codelineno-0-3429">3429</a></span>
<span class="normal"><a href="#__codelineno-0-3430">3430</a></span>
<span class="normal"><a href="#__codelineno-0-3431">3431</a></span>
<span class="normal"><a href="#__codelineno-0-3432">3432</a></span>
<span class="normal"><a href="#__codelineno-0-3433">3433</a></span>
<span class="normal"><a href="#__codelineno-0-3434">3434</a></span>
<span class="normal"><a href="#__codelineno-0-3435">3435</a></span>
<span class="normal"><a href="#__codelineno-0-3436">3436</a></span>
<span class="normal"><a href="#__codelineno-0-3437">3437</a></span>
<span class="normal"><a href="#__codelineno-0-3438">3438</a></span>
<span class="normal"><a href="#__codelineno-0-3439">3439</a></span>
<span class="normal"><a href="#__codelineno-0-3440">3440</a></span>
<span class="normal"><a href="#__codelineno-0-3441">3441</a></span>
<span class="normal"><a href="#__codelineno-0-3442">3442</a></span>
<span class="normal"><a href="#__codelineno-0-3443">3443</a></span>
<span class="normal"><a href="#__codelineno-0-3444">3444</a></span>
<span class="normal"><a href="#__codelineno-0-3445">3445</a></span>
<span class="normal"><a href="#__codelineno-0-3446">3446</a></span>
<span class="normal"><a href="#__codelineno-0-3447">3447</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-3322" name="__codelineno-0-3322"></a><span class="k">def</span> <span class="nf">run_highest_position_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-3323" name="__codelineno-0-3323"></a>    <span class="sd">"""Runs the highest position analysis which is last step</span>
<a id="__codelineno-0-3324" name="__codelineno-0-3324"></a><span class="sd">    in scenario analysis. Uses the activities set by the current ongoing</span>
<a id="__codelineno-0-3325" name="__codelineno-0-3325"></a><span class="sd">    analysis.</span>
<a id="__codelineno-0-3326" name="__codelineno-0-3326"></a>
<a id="__codelineno-0-3327" name="__codelineno-0-3327"></a><span class="sd">    :param temporary_output: Whether to save the processing outputs as temporary</span>
<a id="__codelineno-0-3328" name="__codelineno-0-3328"></a><span class="sd">    files</span>
<a id="__codelineno-0-3329" name="__codelineno-0-3329"></a><span class="sd">    :type temporary_output: bool</span>
<a id="__codelineno-0-3330" name="__codelineno-0-3330"></a>
<a id="__codelineno-0-3331" name="__codelineno-0-3331"></a><span class="sd">    :returns: Whether the task operations was successful</span>
<a id="__codelineno-0-3332" name="__codelineno-0-3332"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-3333" name="__codelineno-0-3333"></a>
<a id="__codelineno-0-3334" name="__codelineno-0-3334"></a><span class="sd">    """</span>
<a id="__codelineno-0-3335" name="__codelineno-0-3335"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3336" name="__codelineno-0-3336"></a>        <span class="c1"># Will not proceed if processing has been cancelled by the user</span>
<a id="__codelineno-0-3337" name="__codelineno-0-3337"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3338" name="__codelineno-0-3338"></a>
<a id="__codelineno-0-3339" name="__codelineno-0-3339"></a>    <span class="n">passed_extent_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_extent</span><span class="o">.</span><span class="n">bbox</span>
<a id="__codelineno-0-3340" name="__codelineno-0-3340"></a>    <span class="n">passed_extent</span> <span class="o">=</span> <span class="n">QgsRectangle</span><span class="p">(</span>
<a id="__codelineno-0-3341" name="__codelineno-0-3341"></a>        <span class="n">passed_extent_box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-3342" name="__codelineno-0-3342"></a>        <span class="n">passed_extent_box</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-0-3343" name="__codelineno-0-3343"></a>        <span class="n">passed_extent_box</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-3344" name="__codelineno-0-3344"></a>        <span class="n">passed_extent_box</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
<a id="__codelineno-0-3345" name="__codelineno-0-3345"></a>    <span class="p">)</span>
<a id="__codelineno-0-3346" name="__codelineno-0-3346"></a>
<a id="__codelineno-0-3347" name="__codelineno-0-3347"></a>    <span class="c1"># We explicitly set the created_date since the current implementation</span>
<a id="__codelineno-0-3348" name="__codelineno-0-3348"></a>    <span class="c1"># of the data model means that the attribute value is set only once when</span>
<a id="__codelineno-0-3349" name="__codelineno-0-3349"></a>    <span class="c1"># the class is loaded hence subsequent instances will have the same value.</span>
<a id="__codelineno-0-3350" name="__codelineno-0-3350"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scenario_result</span> <span class="o">=</span> <span class="n">ScenarioResult</span><span class="p">(</span>
<a id="__codelineno-0-3351" name="__codelineno-0-3351"></a>        <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span>
<a id="__codelineno-0-3352" name="__codelineno-0-3352"></a>        <span class="n">scenario_directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span>
<a id="__codelineno-0-3353" name="__codelineno-0-3353"></a>        <span class="n">created_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
<a id="__codelineno-0-3354" name="__codelineno-0-3354"></a>    <span class="p">)</span>
<a id="__codelineno-0-3355" name="__codelineno-0-3355"></a>
<a id="__codelineno-0-3356" name="__codelineno-0-3356"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-3357" name="__codelineno-0-3357"></a>        <span class="n">layers</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-3358" name="__codelineno-0-3358"></a>
<a id="__codelineno-0-3359" name="__codelineno-0-3359"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">"Calculating the highest position"</span><span class="p">))</span>
<a id="__codelineno-0-3360" name="__codelineno-0-3360"></a>
<a id="__codelineno-0-3361" name="__codelineno-0-3361"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">:</span>
<a id="__codelineno-0-3362" name="__codelineno-0-3362"></a>            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-3363" name="__codelineno-0-3363"></a>                <span class="n">raster_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-3364" name="__codelineno-0-3364"></a>                <span class="n">layers</span><span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3365" name="__codelineno-0-3365"></a>                    <span class="n">raster_layer</span> <span class="k">if</span> <span class="n">raster_layer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-3366" name="__codelineno-0-3366"></a>                <span class="p">)</span>
<a id="__codelineno-0-3367" name="__codelineno-0-3367"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3368" name="__codelineno-0-3368"></a>                <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-3369" name="__codelineno-0-3369"></a>                    <span class="n">layers</span><span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-3370" name="__codelineno-0-3370"></a>
<a id="__codelineno-0-3371" name="__codelineno-0-3371"></a>        <span class="n">source_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="o">.</span><span class="n">fromEpsgId</span><span class="p">(</span><span class="n">DEFAULT_CRS_ID</span><span class="p">)</span>
<a id="__codelineno-0-3372" name="__codelineno-0-3372"></a>        <span class="n">dest_crs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">source_crs</span>
<a id="__codelineno-0-3373" name="__codelineno-0-3373"></a>
<a id="__codelineno-0-3374" name="__codelineno-0-3374"></a>        <span class="n">extent_string</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3375" name="__codelineno-0-3375"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">passed_extent</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">()</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">passed_extent</span><span class="o">.</span><span class="n">xMaximum</span><span class="p">()</span><span class="si">}</span><span class="s2">,"</span>
<a id="__codelineno-0-3376" name="__codelineno-0-3376"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">passed_extent</span><span class="o">.</span><span class="n">yMinimum</span><span class="p">()</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">passed_extent</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-3377" name="__codelineno-0-3377"></a>            <span class="sa">f</span><span class="s2">" [</span><span class="si">{</span><span class="n">dest_crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="si">}</span><span class="s2">]"</span>
<a id="__codelineno-0-3378" name="__codelineno-0-3378"></a>        <span class="p">)</span>
<a id="__codelineno-0-3379" name="__codelineno-0-3379"></a>
<a id="__codelineno-0-3380" name="__codelineno-0-3380"></a>        <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-3381" name="__codelineno-0-3381"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span>
<a id="__codelineno-0-3382" name="__codelineno-0-3382"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">SCENARIO_OUTPUT_FILE_NAME</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">uuid</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-3383" name="__codelineno-0-3383"></a>        <span class="p">)</span>
<a id="__codelineno-0-3384" name="__codelineno-0-3384"></a>
<a id="__codelineno-0-3385" name="__codelineno-0-3385"></a>        <span class="c1"># Preparing the input rasters for the highest position</span>
<a id="__codelineno-0-3386" name="__codelineno-0-3386"></a>        <span class="c1"># analysis in a correct order</span>
<a id="__codelineno-0-3387" name="__codelineno-0-3387"></a>        <span class="n">activity_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">]</span>
<a id="__codelineno-0-3388" name="__codelineno-0-3388"></a>        <span class="n">all_activities</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-0-3389" name="__codelineno-0-3389"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">,</span>
<a id="__codelineno-0-3390" name="__codelineno-0-3390"></a>            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">activity_instance</span><span class="p">:</span> <span class="n">activity_instance</span><span class="o">.</span><span class="n">style_pixel_value</span><span class="p">,</span>
<a id="__codelineno-0-3391" name="__codelineno-0-3391"></a>        <span class="p">)</span>
<a id="__codelineno-0-3392" name="__codelineno-0-3392"></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">activity</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_activities</span><span class="p">):</span>
<a id="__codelineno-0-3393" name="__codelineno-0-3393"></a>            <span class="n">activity</span><span class="o">.</span><span class="n">style_pixel_value</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-0-3394" name="__codelineno-0-3394"></a>
<a id="__codelineno-0-3395" name="__codelineno-0-3395"></a>        <span class="n">all_activity_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">all_activities</span><span class="p">]</span>
<a id="__codelineno-0-3396" name="__codelineno-0-3396"></a>        <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-3397" name="__codelineno-0-3397"></a>        <span class="k">for</span> <span class="n">activity_name</span> <span class="ow">in</span> <span class="n">all_activity_names</span><span class="p">:</span>
<a id="__codelineno-0-3398" name="__codelineno-0-3398"></a>            <span class="k">if</span> <span class="n">activity_name</span> <span class="ow">in</span> <span class="n">activity_names</span><span class="p">:</span>
<a id="__codelineno-0-3399" name="__codelineno-0-3399"></a>                <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="n">activity_name</span><span class="p">]</span><span class="o">.</span><span class="n">source</span><span class="p">())</span>
<a id="__codelineno-0-3400" name="__codelineno-0-3400"></a>
<a id="__codelineno-0-3401" name="__codelineno-0-3401"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3402" name="__codelineno-0-3402"></a>            <span class="sa">f</span><span class="s2">"Layers sources </span><span class="si">{</span><span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-3403" name="__codelineno-0-3403"></a>        <span class="p">)</span>
<a id="__codelineno-0-3404" name="__codelineno-0-3404"></a>
<a id="__codelineno-0-3405" name="__codelineno-0-3405"></a>        <span class="n">output_file</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3406" name="__codelineno-0-3406"></a>            <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span> <span class="k">if</span> <span class="n">temporary_output</span> <span class="k">else</span> <span class="n">output_file</span>
<a id="__codelineno-0-3407" name="__codelineno-0-3407"></a>        <span class="p">)</span>
<a id="__codelineno-0-3408" name="__codelineno-0-3408"></a>
<a id="__codelineno-0-3409" name="__codelineno-0-3409"></a>        <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-3410" name="__codelineno-0-3410"></a>            <span class="s2">"IGNORE_NODATA"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-3411" name="__codelineno-0-3411"></a>            <span class="s2">"INPUT_RASTERS"</span><span class="p">:</span> <span class="n">sources</span><span class="p">,</span>
<a id="__codelineno-0-3412" name="__codelineno-0-3412"></a>            <span class="s2">"EXTENT"</span><span class="p">:</span> <span class="n">extent_string</span><span class="p">,</span>
<a id="__codelineno-0-3413" name="__codelineno-0-3413"></a>            <span class="s2">"OUTPUT_NODATA_VALUE"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_data_value</span><span class="p">,</span>
<a id="__codelineno-0-3414" name="__codelineno-0-3414"></a>            <span class="s2">"REFERENCE_LAYER"</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-3415" name="__codelineno-0-3415"></a>                <span class="nb">list</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-3416" name="__codelineno-0-3416"></a>            <span class="p">),</span>
<a id="__codelineno-0-3417" name="__codelineno-0-3417"></a>            <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output_file</span><span class="p">,</span>
<a id="__codelineno-0-3418" name="__codelineno-0-3418"></a>        <span class="p">}</span>
<a id="__codelineno-0-3419" name="__codelineno-0-3419"></a>
<a id="__codelineno-0-3420" name="__codelineno-0-3420"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3421" name="__codelineno-0-3421"></a>            <span class="sa">f</span><span class="s2">"Used parameters for highest position analysis </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-3422" name="__codelineno-0-3422"></a>        <span class="p">)</span>
<a id="__codelineno-0-3423" name="__codelineno-0-3423"></a>
<a id="__codelineno-0-3424" name="__codelineno-0-3424"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-3425" name="__codelineno-0-3425"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-3426" name="__codelineno-0-3426"></a>
<a id="__codelineno-0-3427" name="__codelineno-0-3427"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3428" name="__codelineno-0-3428"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3429" name="__codelineno-0-3429"></a>
<a id="__codelineno-0-3430" name="__codelineno-0-3430"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-3431" name="__codelineno-0-3431"></a>            <span class="s2">"native:highestpositioninrasterstack"</span><span class="p">,</span>
<a id="__codelineno-0-3432" name="__codelineno-0-3432"></a>            <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-3433" name="__codelineno-0-3433"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-3434" name="__codelineno-0-3434"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-3435" name="__codelineno-0-3435"></a>        <span class="p">)</span>
<a id="__codelineno-0-3436" name="__codelineno-0-3436"></a>
<a id="__codelineno-0-3437" name="__codelineno-0-3437"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<a id="__codelineno-0-3438" name="__codelineno-0-3438"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3439" name="__codelineno-0-3439"></a>            <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-3440" name="__codelineno-0-3440"></a>                <span class="s2">"An error occurred when running task for "</span>
<a id="__codelineno-0-3441" name="__codelineno-0-3441"></a>                <span class="s1">'scenario analysis, error message "</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
<a id="__codelineno-0-3442" name="__codelineno-0-3442"></a>            <span class="p">)</span>
<a id="__codelineno-0-3443" name="__codelineno-0-3443"></a>        <span class="p">)</span>
<a id="__codelineno-0-3444" name="__codelineno-0-3444"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-3445" name="__codelineno-0-3445"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3446" name="__codelineno-0-3446"></a>
<a id="__codelineno-0-3447" name="__codelineno-0-3447"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_internal_activities_masking" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_internal_activities_masking</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_internal_activities_masking" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_internal_activities_masking</span><span class="p">(</span><span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Applies the mask layers into the passed activities</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activities</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the selected activities</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>selected extent from user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>temporary_output</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the processing outputs as temporary files</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the task operations was successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2045" name="__codelineno-0-2045"></a><span class="k">def</span> <span class="nf">run_internal_activities_masking</span><span class="p">(</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a><span class="p">):</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>    <span class="sd">"""Applies the mask layers into the passed activities</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a><span class="sd">    :param activities: List of the selected activities</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a><span class="sd">    :type activities: typing.List[Activity]</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a><span class="sd">    :param extent: selected extent from user</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a><span class="sd">    :type extent: str</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a><span class="sd">    :param temporary_output: Whether to save the processing outputs as temporary</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a><span class="sd">    files</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a><span class="sd">    :type temporary_output: bool</span>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a><span class="sd">    :returns: Whether the task operations was successful</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a><span class="sd">    """</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>        <span class="c1"># Will not proceed if processing has been cancelled by the user</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>        <span class="n">tr</span><span class="p">(</span><span class="s2">"Masking activities using their respective mask layers."</span><span class="p">)</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>    <span class="p">)</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>            <span class="n">masking_layers</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="n">mask_paths</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">masking_layers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>                    <span class="sa">f</span><span class="s2">"Skipping activity masking "</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a>                    <span class="sa">f</span><span class="s2">"No mask layer(s) for activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a>                <span class="p">)</span>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">masking_layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a>                <span class="n">initial_mask_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">merge_vector_layers</span><span class="p">(</span><span class="n">masking_layers</span><span class="p">)</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a>                <span class="n">mask_layer_path</span> <span class="o">=</span> <span class="n">masking_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a>                <span class="n">initial_mask_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">mask_layer_path</span><span class="p">,</span> <span class="s2">"mask"</span><span class="p">,</span> <span class="s2">"ogr"</span><span class="p">)</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">initial_mask_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>                    <span class="sa">f</span><span class="s2">"Skipping activity masking "</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>                    <span class="sa">f</span><span class="s2">"using layer </span><span class="si">{</span><span class="n">mask_layer_path</span><span class="si">}</span><span class="s2">, not a valid layer."</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>                <span class="p">)</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>            <span class="c1"># see https://qgis.org/pyqgis/master/core/Qgis.html#qgis.core.Qgis.GeometryType</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>            <span class="k">if</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">versionInt</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">33000</span><span class="p">:</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>                <span class="n">layer_check</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>                    <span class="n">initial_mask_layer</span><span class="o">.</span><span class="n">geometryType</span><span class="p">()</span>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>                    <span class="o">==</span> <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">GeometryType</span><span class="o">.</span><span class="n">PolygonGeometry</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>                <span class="p">)</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>                <span class="n">layer_check</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>                    <span class="n">initial_mask_layer</span><span class="o">.</span><span class="n">geometryType</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qgis</span><span class="o">.</span><span class="n">GeometryType</span><span class="o">.</span><span class="n">Polygon</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>                <span class="p">)</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_check</span><span class="p">:</span>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>                    <span class="sa">f</span><span class="s2">"Skipping activity masking "</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>                    <span class="sa">f</span><span class="s2">"using layer </span><span class="si">{</span><span class="n">mask_layer_path</span><span class="si">}</span><span class="s2">, not a polygon layer."</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>                <span class="p">)</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>            <span class="n">extent_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">)</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>            <span class="k">if</span> <span class="n">extent_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span> <span class="o">!=</span> <span class="n">initial_mask_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">():</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>                    <span class="s2">"Skipping masking, the mask layers crs"</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>                    <span class="s2">" do not match the scenario crs."</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>                <span class="p">)</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">extent_layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">initial_mask_layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()):</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>                    <span class="s2">"Skipping masking, the mask layers extent"</span>
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>                    <span class="s2">" and the scenario extent do not overlap."</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>                <span class="p">)</span>
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>            <span class="n">mask_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_layer_difference</span><span class="p">(</span>
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>                <span class="n">initial_mask_layer</span><span class="p">,</span> <span class="n">extent_layer</span>
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>            <span class="p">)</span>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask_layer</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>                <span class="n">mask_layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">mask_layer</span><span class="p">,</span> <span class="s2">"ogr"</span><span class="p">)</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">mask_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2137" name="__codelineno-0-2137"></a>                    <span class="sa">f</span><span class="s2">"Skipping activity masking "</span>
<a id="__codelineno-0-2138" name="__codelineno-0-2138"></a>                    <span class="sa">f</span><span class="s2">"the created difference mask layer </span><span class="si">{</span><span class="n">mask_layer</span><span class="o">.</span><span class="n">source</span><span class="p">()</span><span class="si">}</span><span class="s2">,"</span>
<a id="__codelineno-0-2139" name="__codelineno-0-2139"></a>                    <span class="sa">f</span><span class="s2">"is not a valid layer."</span>
<a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>                <span class="p">)</span>
<a id="__codelineno-0-2141" name="__codelineno-0-2141"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2142" name="__codelineno-0-2142"></a>            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-2143" name="__codelineno-0-2143"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-2145" name="__codelineno-0-2145"></a>                        <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-2146" name="__codelineno-0-2146"></a>                            <span class="sa">f</span><span class="s2">"Problem when masking activity, "</span>
<a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>                            <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2148" name="__codelineno-0-2148"></a>                        <span class="p">),</span>
<a id="__codelineno-0-2149" name="__codelineno-0-2149"></a>                        <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-2150" name="__codelineno-0-2150"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>                        <span class="sa">f</span><span class="s2">"Problem when masking activity, "</span>
<a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>                        <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>                    <span class="c1"># If the user cancelled the processing</span>
<a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>                        <span class="n">tr</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing has been cancelled by the user."</span><span class="p">),</span>
<a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>                        <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing has been cancelled by the user."</span><span class="p">)</span>
<a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>
<a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>
<a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>            <span class="n">masked_activities_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"final_masked_activities"</span>
<a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>            <span class="p">)</span>
<a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>            <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">masked_activities_directory</span><span class="p">)</span>
<a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">clean_filename</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
<a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>
<a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2172" name="__codelineno-0-2172"></a>                <span class="n">masked_activities_directory</span><span class="p">,</span>
<a id="__codelineno-0-2173" name="__codelineno-0-2173"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-2174" name="__codelineno-0-2174"></a>            <span class="p">)</span>
<a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>
<a id="__codelineno-0-2176" name="__codelineno-0-2176"></a>            <span class="n">output</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2177" name="__codelineno-0-2177"></a>                <span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TEMPORARY_OUTPUT</span> <span class="k">if</span> <span class="n">temporary_output</span> <span class="k">else</span> <span class="n">output_file</span>
<a id="__codelineno-0-2178" name="__codelineno-0-2178"></a>            <span class="p">)</span>
<a id="__codelineno-0-2179" name="__codelineno-0-2179"></a>
<a id="__codelineno-0-2180" name="__codelineno-0-2180"></a>            <span class="n">activity_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s2">"activity_layer"</span><span class="p">)</span>
<a id="__codelineno-0-2181" name="__codelineno-0-2181"></a>
<a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>            <span class="k">if</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span> <span class="o">!=</span> <span class="n">mask_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">():</span>
<a id="__codelineno-0-2183" name="__codelineno-0-2183"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2184" name="__codelineno-0-2184"></a>                    <span class="sa">f</span><span class="s2">"Skipping masking, activity layer and"</span>
<a id="__codelineno-0-2185" name="__codelineno-0-2185"></a>                    <span class="sa">f</span><span class="s2">" mask layer(s) have different CRS"</span>
<a id="__codelineno-0-2186" name="__codelineno-0-2186"></a>                <span class="p">)</span>
<a id="__codelineno-0-2187" name="__codelineno-0-2187"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2188" name="__codelineno-0-2188"></a>
<a id="__codelineno-0-2189" name="__codelineno-0-2189"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">mask_layer</span><span class="o">.</span><span class="n">extent</span><span class="p">()):</span>
<a id="__codelineno-0-2190" name="__codelineno-0-2190"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>                    <span class="s2">"Skipping masking, the extents of the activity layer "</span>
<a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>                    <span class="s2">"and mask layers do not overlap."</span>
<a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>                <span class="p">)</span>
<a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>
<a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>            <span class="c1"># Actual processing calculation</span>
<a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>            <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>                <span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
<a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>                <span class="s2">"MASK"</span><span class="p">:</span> <span class="n">mask_layer</span><span class="p">,</span>
<a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>                <span class="s2">"SOURCE_CRS"</span><span class="p">:</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
<a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>                <span class="s2">"DESTINATION_CRS"</span><span class="p">:</span> <span class="n">activity_layer</span><span class="o">.</span><span class="n">crs</span><span class="p">(),</span>
<a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>                <span class="s2">"TARGET_EXTENT"</span><span class="p">:</span> <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span>
<a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>                <span class="s2">"NO_DATA"</span><span class="p">:</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>                    <span class="n">Settings</span><span class="o">.</span><span class="n">NCS_NO_DATA_VALUE</span><span class="p">,</span> <span class="n">NO_DATA_VALUE</span>
<a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>                <span class="p">),</span>
<a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>            <span class="p">}</span>
<a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>
<a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>                <span class="sa">f</span><span class="s2">"Used parameters for masking the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>                <span class="sa">f</span><span class="s2">" using activity respective mask layer(s): </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>            <span class="p">)</span>
<a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>
<a id="__codelineno-0-2214" name="__codelineno-0-2214"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-2216" name="__codelineno-0-2216"></a>
<a id="__codelineno-0-2217" name="__codelineno-0-2217"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2218" name="__codelineno-0-2218"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2219" name="__codelineno-0-2219"></a>
<a id="__codelineno-0-2220" name="__codelineno-0-2220"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2221" name="__codelineno-0-2221"></a>                <span class="s2">"gdal:cliprasterbymasklayer"</span><span class="p">,</span>
<a id="__codelineno-0-2222" name="__codelineno-0-2222"></a>                <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-2223" name="__codelineno-0-2223"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2224" name="__codelineno-0-2224"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2225" name="__codelineno-0-2225"></a>            <span class="p">)</span>
<a id="__codelineno-0-2226" name="__codelineno-0-2226"></a>            <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2227" name="__codelineno-0-2227"></a>
<a id="__codelineno-0-2228" name="__codelineno-0-2228"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-2229" name="__codelineno-0-2229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem masking activities layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-2230" name="__codelineno-0-2230"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2231" name="__codelineno-0-2231"></a>
<a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2233" name="__codelineno-0-2233"></a>
<a id="__codelineno-0-2234" name="__codelineno-0-2234"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_investability_analysis" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_investability_analysis</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_investability_analysis" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_investability_analysis</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Run activity investability analysis</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3138">3138</a></span>
<span class="normal"><a href="#__codelineno-0-3139">3139</a></span>
<span class="normal"><a href="#__codelineno-0-3140">3140</a></span>
<span class="normal"><a href="#__codelineno-0-3141">3141</a></span>
<span class="normal"><a href="#__codelineno-0-3142">3142</a></span>
<span class="normal"><a href="#__codelineno-0-3143">3143</a></span>
<span class="normal"><a href="#__codelineno-0-3144">3144</a></span>
<span class="normal"><a href="#__codelineno-0-3145">3145</a></span>
<span class="normal"><a href="#__codelineno-0-3146">3146</a></span>
<span class="normal"><a href="#__codelineno-0-3147">3147</a></span>
<span class="normal"><a href="#__codelineno-0-3148">3148</a></span>
<span class="normal"><a href="#__codelineno-0-3149">3149</a></span>
<span class="normal"><a href="#__codelineno-0-3150">3150</a></span>
<span class="normal"><a href="#__codelineno-0-3151">3151</a></span>
<span class="normal"><a href="#__codelineno-0-3152">3152</a></span>
<span class="normal"><a href="#__codelineno-0-3153">3153</a></span>
<span class="normal"><a href="#__codelineno-0-3154">3154</a></span>
<span class="normal"><a href="#__codelineno-0-3155">3155</a></span>
<span class="normal"><a href="#__codelineno-0-3156">3156</a></span>
<span class="normal"><a href="#__codelineno-0-3157">3157</a></span>
<span class="normal"><a href="#__codelineno-0-3158">3158</a></span>
<span class="normal"><a href="#__codelineno-0-3159">3159</a></span>
<span class="normal"><a href="#__codelineno-0-3160">3160</a></span>
<span class="normal"><a href="#__codelineno-0-3161">3161</a></span>
<span class="normal"><a href="#__codelineno-0-3162">3162</a></span>
<span class="normal"><a href="#__codelineno-0-3163">3163</a></span>
<span class="normal"><a href="#__codelineno-0-3164">3164</a></span>
<span class="normal"><a href="#__codelineno-0-3165">3165</a></span>
<span class="normal"><a href="#__codelineno-0-3166">3166</a></span>
<span class="normal"><a href="#__codelineno-0-3167">3167</a></span>
<span class="normal"><a href="#__codelineno-0-3168">3168</a></span>
<span class="normal"><a href="#__codelineno-0-3169">3169</a></span>
<span class="normal"><a href="#__codelineno-0-3170">3170</a></span>
<span class="normal"><a href="#__codelineno-0-3171">3171</a></span>
<span class="normal"><a href="#__codelineno-0-3172">3172</a></span>
<span class="normal"><a href="#__codelineno-0-3173">3173</a></span>
<span class="normal"><a href="#__codelineno-0-3174">3174</a></span>
<span class="normal"><a href="#__codelineno-0-3175">3175</a></span>
<span class="normal"><a href="#__codelineno-0-3176">3176</a></span>
<span class="normal"><a href="#__codelineno-0-3177">3177</a></span>
<span class="normal"><a href="#__codelineno-0-3178">3178</a></span>
<span class="normal"><a href="#__codelineno-0-3179">3179</a></span>
<span class="normal"><a href="#__codelineno-0-3180">3180</a></span>
<span class="normal"><a href="#__codelineno-0-3181">3181</a></span>
<span class="normal"><a href="#__codelineno-0-3182">3182</a></span>
<span class="normal"><a href="#__codelineno-0-3183">3183</a></span>
<span class="normal"><a href="#__codelineno-0-3184">3184</a></span>
<span class="normal"><a href="#__codelineno-0-3185">3185</a></span>
<span class="normal"><a href="#__codelineno-0-3186">3186</a></span>
<span class="normal"><a href="#__codelineno-0-3187">3187</a></span>
<span class="normal"><a href="#__codelineno-0-3188">3188</a></span>
<span class="normal"><a href="#__codelineno-0-3189">3189</a></span>
<span class="normal"><a href="#__codelineno-0-3190">3190</a></span>
<span class="normal"><a href="#__codelineno-0-3191">3191</a></span>
<span class="normal"><a href="#__codelineno-0-3192">3192</a></span>
<span class="normal"><a href="#__codelineno-0-3193">3193</a></span>
<span class="normal"><a href="#__codelineno-0-3194">3194</a></span>
<span class="normal"><a href="#__codelineno-0-3195">3195</a></span>
<span class="normal"><a href="#__codelineno-0-3196">3196</a></span>
<span class="normal"><a href="#__codelineno-0-3197">3197</a></span>
<span class="normal"><a href="#__codelineno-0-3198">3198</a></span>
<span class="normal"><a href="#__codelineno-0-3199">3199</a></span>
<span class="normal"><a href="#__codelineno-0-3200">3200</a></span>
<span class="normal"><a href="#__codelineno-0-3201">3201</a></span>
<span class="normal"><a href="#__codelineno-0-3202">3202</a></span>
<span class="normal"><a href="#__codelineno-0-3203">3203</a></span>
<span class="normal"><a href="#__codelineno-0-3204">3204</a></span>
<span class="normal"><a href="#__codelineno-0-3205">3205</a></span>
<span class="normal"><a href="#__codelineno-0-3206">3206</a></span>
<span class="normal"><a href="#__codelineno-0-3207">3207</a></span>
<span class="normal"><a href="#__codelineno-0-3208">3208</a></span>
<span class="normal"><a href="#__codelineno-0-3209">3209</a></span>
<span class="normal"><a href="#__codelineno-0-3210">3210</a></span>
<span class="normal"><a href="#__codelineno-0-3211">3211</a></span>
<span class="normal"><a href="#__codelineno-0-3212">3212</a></span>
<span class="normal"><a href="#__codelineno-0-3213">3213</a></span>
<span class="normal"><a href="#__codelineno-0-3214">3214</a></span>
<span class="normal"><a href="#__codelineno-0-3215">3215</a></span>
<span class="normal"><a href="#__codelineno-0-3216">3216</a></span>
<span class="normal"><a href="#__codelineno-0-3217">3217</a></span>
<span class="normal"><a href="#__codelineno-0-3218">3218</a></span>
<span class="normal"><a href="#__codelineno-0-3219">3219</a></span>
<span class="normal"><a href="#__codelineno-0-3220">3220</a></span>
<span class="normal"><a href="#__codelineno-0-3221">3221</a></span>
<span class="normal"><a href="#__codelineno-0-3222">3222</a></span>
<span class="normal"><a href="#__codelineno-0-3223">3223</a></span>
<span class="normal"><a href="#__codelineno-0-3224">3224</a></span>
<span class="normal"><a href="#__codelineno-0-3225">3225</a></span>
<span class="normal"><a href="#__codelineno-0-3226">3226</a></span>
<span class="normal"><a href="#__codelineno-0-3227">3227</a></span>
<span class="normal"><a href="#__codelineno-0-3228">3228</a></span>
<span class="normal"><a href="#__codelineno-0-3229">3229</a></span>
<span class="normal"><a href="#__codelineno-0-3230">3230</a></span>
<span class="normal"><a href="#__codelineno-0-3231">3231</a></span>
<span class="normal"><a href="#__codelineno-0-3232">3232</a></span>
<span class="normal"><a href="#__codelineno-0-3233">3233</a></span>
<span class="normal"><a href="#__codelineno-0-3234">3234</a></span>
<span class="normal"><a href="#__codelineno-0-3235">3235</a></span>
<span class="normal"><a href="#__codelineno-0-3236">3236</a></span>
<span class="normal"><a href="#__codelineno-0-3237">3237</a></span>
<span class="normal"><a href="#__codelineno-0-3238">3238</a></span>
<span class="normal"><a href="#__codelineno-0-3239">3239</a></span>
<span class="normal"><a href="#__codelineno-0-3240">3240</a></span>
<span class="normal"><a href="#__codelineno-0-3241">3241</a></span>
<span class="normal"><a href="#__codelineno-0-3242">3242</a></span>
<span class="normal"><a href="#__codelineno-0-3243">3243</a></span>
<span class="normal"><a href="#__codelineno-0-3244">3244</a></span>
<span class="normal"><a href="#__codelineno-0-3245">3245</a></span>
<span class="normal"><a href="#__codelineno-0-3246">3246</a></span>
<span class="normal"><a href="#__codelineno-0-3247">3247</a></span>
<span class="normal"><a href="#__codelineno-0-3248">3248</a></span>
<span class="normal"><a href="#__codelineno-0-3249">3249</a></span>
<span class="normal"><a href="#__codelineno-0-3250">3250</a></span>
<span class="normal"><a href="#__codelineno-0-3251">3251</a></span>
<span class="normal"><a href="#__codelineno-0-3252">3252</a></span>
<span class="normal"><a href="#__codelineno-0-3253">3253</a></span>
<span class="normal"><a href="#__codelineno-0-3254">3254</a></span>
<span class="normal"><a href="#__codelineno-0-3255">3255</a></span>
<span class="normal"><a href="#__codelineno-0-3256">3256</a></span>
<span class="normal"><a href="#__codelineno-0-3257">3257</a></span>
<span class="normal"><a href="#__codelineno-0-3258">3258</a></span>
<span class="normal"><a href="#__codelineno-0-3259">3259</a></span>
<span class="normal"><a href="#__codelineno-0-3260">3260</a></span>
<span class="normal"><a href="#__codelineno-0-3261">3261</a></span>
<span class="normal"><a href="#__codelineno-0-3262">3262</a></span>
<span class="normal"><a href="#__codelineno-0-3263">3263</a></span>
<span class="normal"><a href="#__codelineno-0-3264">3264</a></span>
<span class="normal"><a href="#__codelineno-0-3265">3265</a></span>
<span class="normal"><a href="#__codelineno-0-3266">3266</a></span>
<span class="normal"><a href="#__codelineno-0-3267">3267</a></span>
<span class="normal"><a href="#__codelineno-0-3268">3268</a></span>
<span class="normal"><a href="#__codelineno-0-3269">3269</a></span>
<span class="normal"><a href="#__codelineno-0-3270">3270</a></span>
<span class="normal"><a href="#__codelineno-0-3271">3271</a></span>
<span class="normal"><a href="#__codelineno-0-3272">3272</a></span>
<span class="normal"><a href="#__codelineno-0-3273">3273</a></span>
<span class="normal"><a href="#__codelineno-0-3274">3274</a></span>
<span class="normal"><a href="#__codelineno-0-3275">3275</a></span>
<span class="normal"><a href="#__codelineno-0-3276">3276</a></span>
<span class="normal"><a href="#__codelineno-0-3277">3277</a></span>
<span class="normal"><a href="#__codelineno-0-3278">3278</a></span>
<span class="normal"><a href="#__codelineno-0-3279">3279</a></span>
<span class="normal"><a href="#__codelineno-0-3280">3280</a></span>
<span class="normal"><a href="#__codelineno-0-3281">3281</a></span>
<span class="normal"><a href="#__codelineno-0-3282">3282</a></span>
<span class="normal"><a href="#__codelineno-0-3283">3283</a></span>
<span class="normal"><a href="#__codelineno-0-3284">3284</a></span>
<span class="normal"><a href="#__codelineno-0-3285">3285</a></span>
<span class="normal"><a href="#__codelineno-0-3286">3286</a></span>
<span class="normal"><a href="#__codelineno-0-3287">3287</a></span>
<span class="normal"><a href="#__codelineno-0-3288">3288</a></span>
<span class="normal"><a href="#__codelineno-0-3289">3289</a></span>
<span class="normal"><a href="#__codelineno-0-3290">3290</a></span>
<span class="normal"><a href="#__codelineno-0-3291">3291</a></span>
<span class="normal"><a href="#__codelineno-0-3292">3292</a></span>
<span class="normal"><a href="#__codelineno-0-3293">3293</a></span>
<span class="normal"><a href="#__codelineno-0-3294">3294</a></span>
<span class="normal"><a href="#__codelineno-0-3295">3295</a></span>
<span class="normal"><a href="#__codelineno-0-3296">3296</a></span>
<span class="normal"><a href="#__codelineno-0-3297">3297</a></span>
<span class="normal"><a href="#__codelineno-0-3298">3298</a></span>
<span class="normal"><a href="#__codelineno-0-3299">3299</a></span>
<span class="normal"><a href="#__codelineno-0-3300">3300</a></span>
<span class="normal"><a href="#__codelineno-0-3301">3301</a></span>
<span class="normal"><a href="#__codelineno-0-3302">3302</a></span>
<span class="normal"><a href="#__codelineno-0-3303">3303</a></span>
<span class="normal"><a href="#__codelineno-0-3304">3304</a></span>
<span class="normal"><a href="#__codelineno-0-3305">3305</a></span>
<span class="normal"><a href="#__codelineno-0-3306">3306</a></span>
<span class="normal"><a href="#__codelineno-0-3307">3307</a></span>
<span class="normal"><a href="#__codelineno-0-3308">3308</a></span>
<span class="normal"><a href="#__codelineno-0-3309">3309</a></span>
<span class="normal"><a href="#__codelineno-0-3310">3310</a></span>
<span class="normal"><a href="#__codelineno-0-3311">3311</a></span>
<span class="normal"><a href="#__codelineno-0-3312">3312</a></span>
<span class="normal"><a href="#__codelineno-0-3313">3313</a></span>
<span class="normal"><a href="#__codelineno-0-3314">3314</a></span>
<span class="normal"><a href="#__codelineno-0-3315">3315</a></span>
<span class="normal"><a href="#__codelineno-0-3316">3316</a></span>
<span class="normal"><a href="#__codelineno-0-3317">3317</a></span>
<span class="normal"><a href="#__codelineno-0-3318">3318</a></span>
<span class="normal"><a href="#__codelineno-0-3319">3319</a></span>
<span class="normal"><a href="#__codelineno-0-3320">3320</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-3138" name="__codelineno-0-3138"></a><span class="k">def</span> <span class="nf">run_investability_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-3139" name="__codelineno-0-3139"></a>    <span class="sd">"""Run activity investability analysis</span>
<a id="__codelineno-0-3140" name="__codelineno-0-3140"></a>
<a id="__codelineno-0-3141" name="__codelineno-0-3141"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-3142" name="__codelineno-0-3142"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-3143" name="__codelineno-0-3143"></a><span class="sd">    """</span>
<a id="__codelineno-0-3144" name="__codelineno-0-3144"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3145" name="__codelineno-0-3145"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3146" name="__codelineno-0-3146"></a>
<a id="__codelineno-0-3147" name="__codelineno-0-3147"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="s2">"Calculating investability of the activities"</span><span class="p">))</span>
<a id="__codelineno-0-3148" name="__codelineno-0-3148"></a>
<a id="__codelineno-0-3149" name="__codelineno-0-3149"></a>    <span class="n">investable_activities</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-3150" name="__codelineno-0-3150"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"investable_activities"</span>
<a id="__codelineno-0-3151" name="__codelineno-0-3151"></a>    <span class="p">)</span>
<a id="__codelineno-0-3152" name="__codelineno-0-3152"></a>    <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">investable_activities</span><span class="p">)</span>
<a id="__codelineno-0-3153" name="__codelineno-0-3153"></a>
<a id="__codelineno-0-3154" name="__codelineno-0-3154"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-3155" name="__codelineno-0-3155"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-3156" name="__codelineno-0-3156"></a>
<a id="__codelineno-0-3157" name="__codelineno-0-3157"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-3158" name="__codelineno-0-3158"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">:</span>
<a id="__codelineno-0-3159" name="__codelineno-0-3159"></a>            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-3160" name="__codelineno-0-3160"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3161" name="__codelineno-0-3161"></a>                    <span class="sa">f</span><span class="s2">"Problem when running activity investability, "</span>
<a id="__codelineno-0-3162" name="__codelineno-0-3162"></a>                    <span class="sa">f</span><span class="s2">"there is no map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-3163" name="__codelineno-0-3163"></a>                <span class="p">)</span>
<a id="__codelineno-0-3164" name="__codelineno-0-3164"></a>
<a id="__codelineno-0-3165" name="__codelineno-0-3165"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3166" name="__codelineno-0-3166"></a>
<a id="__codelineno-0-3167" name="__codelineno-0-3167"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
<a id="__codelineno-0-3168" name="__codelineno-0-3168"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3169" name="__codelineno-0-3169"></a>                    <span class="sa">f</span><span class="s2">"Problem when running activity investability, "</span>
<a id="__codelineno-0-3170" name="__codelineno-0-3170"></a>                    <span class="sa">f</span><span class="s2">"the map layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist"</span>
<a id="__codelineno-0-3171" name="__codelineno-0-3171"></a>                <span class="p">)</span>
<a id="__codelineno-0-3172" name="__codelineno-0-3172"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3173" name="__codelineno-0-3173"></a>
<a id="__codelineno-0-3174" name="__codelineno-0-3174"></a>            <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">]</span>
<a id="__codelineno-0-3175" name="__codelineno-0-3175"></a>
<a id="__codelineno-0-3176" name="__codelineno-0-3176"></a>            <span class="n">activity_basename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
<a id="__codelineno-0-3177" name="__codelineno-0-3177"></a>            <span class="n">expression_items</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">'("</span><span class="si">{</span><span class="n">activity_basename</span><span class="si">}</span><span class="s1">@1")'</span><span class="p">]</span>
<a id="__codelineno-0-3178" name="__codelineno-0-3178"></a>
<a id="__codelineno-0-3179" name="__codelineno-0-3179"></a>            <span class="n">constant_raster_components</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-3180" name="__codelineno-0-3180"></a>                <span class="n">constant_raster_registry</span><span class="o">.</span><span class="n">activity_components</span><span class="p">(</span>
<a id="__codelineno-0-3181" name="__codelineno-0-3181"></a>                    <span class="n">activity_identifier</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
<a id="__codelineno-0-3182" name="__codelineno-0-3182"></a>                <span class="p">)</span>
<a id="__codelineno-0-3183" name="__codelineno-0-3183"></a>            <span class="p">)</span>
<a id="__codelineno-0-3184" name="__codelineno-0-3184"></a>
<a id="__codelineno-0-3185" name="__codelineno-0-3185"></a>            <span class="c1"># Serialize the constant rasters</span>
<a id="__codelineno-0-3186" name="__codelineno-0-3186"></a>            <span class="n">constant_rasters</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-3187" name="__codelineno-0-3187"></a>                <span class="p">{</span>
<a id="__codelineno-0-3188" name="__codelineno-0-3188"></a>                    <span class="s2">"name"</span><span class="p">:</span> <span class="n">component</span><span class="o">.</span><span class="n">base_name</span><span class="p">,</span>
<a id="__codelineno-0-3189" name="__codelineno-0-3189"></a>                    <span class="s2">"uuid"</span><span class="p">:</span> <span class="n">component</span><span class="o">.</span><span class="n">component_id</span><span class="p">,</span>
<a id="__codelineno-0-3190" name="__codelineno-0-3190"></a>                    <span class="s2">"absolute"</span><span class="p">:</span> <span class="n">component</span><span class="o">.</span><span class="n">value_info</span><span class="o">.</span><span class="n">absolute</span><span class="p">,</span>
<a id="__codelineno-0-3191" name="__codelineno-0-3191"></a>                    <span class="s2">"normalized"</span><span class="p">:</span> <span class="n">component</span><span class="o">.</span><span class="n">value_info</span><span class="o">.</span><span class="n">normalized</span><span class="p">,</span>
<a id="__codelineno-0-3192" name="__codelineno-0-3192"></a>                    <span class="s2">"path"</span><span class="p">:</span> <span class="n">component</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
<a id="__codelineno-0-3193" name="__codelineno-0-3193"></a>                    <span class="s2">"skip_raster"</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-3194" name="__codelineno-0-3194"></a>                        <span class="n">component</span><span class="o">.</span><span class="n">skip_raster</span>
<a id="__codelineno-0-3195" name="__codelineno-0-3195"></a>                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-3196" name="__codelineno-0-3196"></a>                        <span class="k">else</span> <span class="kc">True</span>
<a id="__codelineno-0-3197" name="__codelineno-0-3197"></a>                    <span class="p">),</span>
<a id="__codelineno-0-3198" name="__codelineno-0-3198"></a>                <span class="p">}</span>
<a id="__codelineno-0-3199" name="__codelineno-0-3199"></a>                <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">constant_raster_components</span>
<a id="__codelineno-0-3200" name="__codelineno-0-3200"></a>            <span class="p">]</span>
<a id="__codelineno-0-3201" name="__codelineno-0-3201"></a>
<a id="__codelineno-0-3202" name="__codelineno-0-3202"></a>            <span class="k">if</span> <span class="n">constant_rasters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-3203" name="__codelineno-0-3203"></a>                <span class="n">constant_rasters</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-3204" name="__codelineno-0-3204"></a>
<a id="__codelineno-0-3205" name="__codelineno-0-3205"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3206" name="__codelineno-0-3206"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3207" name="__codelineno-0-3207"></a>
<a id="__codelineno-0-3208" name="__codelineno-0-3208"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-3209" name="__codelineno-0-3209"></a>                <span class="n">Settings</span><span class="o">.</span><span class="n">PIXEL_CONNECTIVITY_ENABLED</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-3210" name="__codelineno-0-3210"></a>            <span class="p">):</span>
<a id="__codelineno-0-3211" name="__codelineno-0-3211"></a>                <span class="c1"># Add connectivity layer</span>
<a id="__codelineno-0-3212" name="__codelineno-0-3212"></a>                <span class="n">connectivity_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_activity_connectivity_layer</span><span class="p">(</span>
<a id="__codelineno-0-3213" name="__codelineno-0-3213"></a>                    <span class="n">activity</span><span class="o">=</span><span class="n">activity</span>
<a id="__codelineno-0-3214" name="__codelineno-0-3214"></a>                <span class="p">)</span>
<a id="__codelineno-0-3215" name="__codelineno-0-3215"></a>                <span class="k">if</span> <span class="n">connectivity_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">connectivity_path</span><span class="p">):</span>
<a id="__codelineno-0-3216" name="__codelineno-0-3216"></a>                    <span class="n">constant_rasters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-3217" name="__codelineno-0-3217"></a>                        <span class="p">{</span>
<a id="__codelineno-0-3218" name="__codelineno-0-3218"></a>                            <span class="s2">"path"</span><span class="p">:</span> <span class="n">connectivity_path</span><span class="p">,</span>
<a id="__codelineno-0-3219" name="__codelineno-0-3219"></a>                            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Connectivity layer"</span><span class="p">,</span>
<a id="__codelineno-0-3220" name="__codelineno-0-3220"></a>                            <span class="s2">"skip_raster"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-3221" name="__codelineno-0-3221"></a>                        <span class="p">}</span>
<a id="__codelineno-0-3222" name="__codelineno-0-3222"></a>                    <span class="p">)</span>
<a id="__codelineno-0-3223" name="__codelineno-0-3223"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3224" name="__codelineno-0-3224"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3225" name="__codelineno-0-3225"></a>                        <span class="sa">f</span><span class="s2">"Invalid path for connectivity layer of activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-3226" name="__codelineno-0-3226"></a>                    <span class="p">)</span>
<a id="__codelineno-0-3227" name="__codelineno-0-3227"></a>
<a id="__codelineno-0-3228" name="__codelineno-0-3228"></a>            <span class="n">nr_constant_rasters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">constant_rasters</span><span class="p">)</span>
<a id="__codelineno-0-3229" name="__codelineno-0-3229"></a>
<a id="__codelineno-0-3230" name="__codelineno-0-3230"></a>            <span class="k">if</span> <span class="n">nr_constant_rasters</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-3231" name="__codelineno-0-3231"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3232" name="__codelineno-0-3232"></a>                    <span class="sa">f</span><span class="s2">"No defined constant rasters, "</span>
<a id="__codelineno-0-3233" name="__codelineno-0-3233"></a>                    <span class="sa">f</span><span class="s2">"Skipping investability analysis for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-3234" name="__codelineno-0-3234"></a>                <span class="p">)</span>
<a id="__codelineno-0-3235" name="__codelineno-0-3235"></a>                <span class="k">continue</span>
<a id="__codelineno-0-3236" name="__codelineno-0-3236"></a>
<a id="__codelineno-0-3237" name="__codelineno-0-3237"></a>            <span class="k">for</span> <span class="n">constant_raster</span> <span class="ow">in</span> <span class="n">constant_rasters</span><span class="p">:</span>
<a id="__codelineno-0-3238" name="__codelineno-0-3238"></a>                <span class="k">if</span> <span class="s2">"normalized"</span> <span class="ow">in</span> <span class="n">constant_raster</span><span class="p">:</span>
<a id="__codelineno-0-3239" name="__codelineno-0-3239"></a>                    <span class="n">expression_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-3240" name="__codelineno-0-3240"></a>                        <span class="nb">str</span><span class="p">(</span><span class="n">constant_raster</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"normalized"</span><span class="p">)</span> <span class="o">/</span> <span class="n">nr_constant_rasters</span><span class="p">)</span>
<a id="__codelineno-0-3241" name="__codelineno-0-3241"></a>                    <span class="p">)</span>
<a id="__codelineno-0-3242" name="__codelineno-0-3242"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3243" name="__codelineno-0-3243"></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">constant_raster</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"path"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
<a id="__codelineno-0-3244" name="__codelineno-0-3244"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<a id="__codelineno-0-3245" name="__codelineno-0-3245"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3246" name="__codelineno-0-3246"></a>                            <span class="sa">f</span><span class="s2">"Invalid constant raster path </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">,"</span>
<a id="__codelineno-0-3247" name="__codelineno-0-3247"></a>                            <span class="sa">f</span><span class="s2">"Skipping from the investability analysis for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-3248" name="__codelineno-0-3248"></a>                        <span class="p">)</span>
<a id="__codelineno-0-3249" name="__codelineno-0-3249"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-3250" name="__codelineno-0-3250"></a>
<a id="__codelineno-0-3251" name="__codelineno-0-3251"></a>                    <span class="n">normalized_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-3252" name="__codelineno-0-3252"></a>                        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">investable_activities</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a id="__codelineno-0-3253" name="__codelineno-0-3253"></a>                        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_norm_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-3254" name="__codelineno-0-3254"></a>                    <span class="p">)</span>
<a id="__codelineno-0-3255" name="__codelineno-0-3255"></a>
<a id="__codelineno-0-3256" name="__codelineno-0-3256"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3257" name="__codelineno-0-3257"></a>                        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3258" name="__codelineno-0-3258"></a>
<a id="__codelineno-0-3259" name="__codelineno-0-3259"></a>                    <span class="n">ok</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="n">normalize_raster</span><span class="p">(</span>
<a id="__codelineno-0-3260" name="__codelineno-0-3260"></a>                        <span class="n">input_raster_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
<a id="__codelineno-0-3261" name="__codelineno-0-3261"></a>                        <span class="n">output_raster_path</span><span class="o">=</span><span class="n">normalized_path</span><span class="p">,</span>
<a id="__codelineno-0-3262" name="__codelineno-0-3262"></a>                        <span class="n">processing_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-3263" name="__codelineno-0-3263"></a>                        <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-3264" name="__codelineno-0-3264"></a>                    <span class="p">)</span>
<a id="__codelineno-0-3265" name="__codelineno-0-3265"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
<a id="__codelineno-0-3266" name="__codelineno-0-3266"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
<a id="__codelineno-0-3267" name="__codelineno-0-3267"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3268" name="__codelineno-0-3268"></a>                            <span class="sa">f</span><span class="s2">"Skipping </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> from the investability analysis for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-3269" name="__codelineno-0-3269"></a>                        <span class="p">)</span>
<a id="__codelineno-0-3270" name="__codelineno-0-3270"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-3271" name="__codelineno-0-3271"></a>
<a id="__codelineno-0-3272" name="__codelineno-0-3272"></a>                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">normalized_path</span><span class="p">):</span>
<a id="__codelineno-0-3273" name="__codelineno-0-3273"></a>                        <span class="n">path</span> <span class="o">=</span> <span class="n">normalized_path</span>
<a id="__codelineno-0-3274" name="__codelineno-0-3274"></a>
<a id="__codelineno-0-3275" name="__codelineno-0-3275"></a>                    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-3276" name="__codelineno-0-3276"></a>                    <span class="n">expression_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-3277" name="__codelineno-0-3277"></a>                        <span class="sa">f</span><span class="s1">'("</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s1">@1" / </span><span class="si">{</span><span class="n">nr_constant_rasters</span><span class="si">}</span><span class="s1">)'</span>
<a id="__codelineno-0-3278" name="__codelineno-0-3278"></a>                    <span class="p">)</span>
<a id="__codelineno-0-3279" name="__codelineno-0-3279"></a>
<a id="__codelineno-0-3280" name="__codelineno-0-3280"></a>            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-3281" name="__codelineno-0-3281"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">investable_activities</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a id="__codelineno-0-3282" name="__codelineno-0-3282"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_invest_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-3283" name="__codelineno-0-3283"></a>            <span class="p">)</span>
<a id="__codelineno-0-3284" name="__codelineno-0-3284"></a>
<a id="__codelineno-0-3285" name="__codelineno-0-3285"></a>            <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-3286" name="__codelineno-0-3286"></a>                <span class="s2">"CELLSIZE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-3287" name="__codelineno-0-3287"></a>                <span class="s2">"CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-3288" name="__codelineno-0-3288"></a>                <span class="s2">"EXPRESSION"</span><span class="p">:</span> <span class="s2">" + "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">expression_items</span><span class="p">),</span>
<a id="__codelineno-0-3289" name="__codelineno-0-3289"></a>                <span class="s2">"LAYERS"</span><span class="p">:</span> <span class="n">layers</span><span class="p">,</span>
<a id="__codelineno-0-3290" name="__codelineno-0-3290"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output_path</span><span class="p">,</span>
<a id="__codelineno-0-3291" name="__codelineno-0-3291"></a>            <span class="p">}</span>
<a id="__codelineno-0-3292" name="__codelineno-0-3292"></a>
<a id="__codelineno-0-3293" name="__codelineno-0-3293"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3294" name="__codelineno-0-3294"></a>                <span class="sa">f</span><span class="s2">" Used parameters for calculating investability for activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, "</span>
<a id="__codelineno-0-3295" name="__codelineno-0-3295"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-3296" name="__codelineno-0-3296"></a>            <span class="p">)</span>
<a id="__codelineno-0-3297" name="__codelineno-0-3297"></a>
<a id="__codelineno-0-3298" name="__codelineno-0-3298"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-3299" name="__codelineno-0-3299"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3300" name="__codelineno-0-3300"></a>
<a id="__codelineno-0-3301" name="__codelineno-0-3301"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-3302" name="__codelineno-0-3302"></a>                <span class="s2">"qgis:rastercalculator"</span><span class="p">,</span>
<a id="__codelineno-0-3303" name="__codelineno-0-3303"></a>                <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-3304" name="__codelineno-0-3304"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-3305" name="__codelineno-0-3305"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-3306" name="__codelineno-0-3306"></a>            <span class="p">)</span>
<a id="__codelineno-0-3307" name="__codelineno-0-3307"></a>
<a id="__codelineno-0-3308" name="__codelineno-0-3308"></a>            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"OUTPUT"</span><span class="p">):</span>
<a id="__codelineno-0-3309" name="__codelineno-0-3309"></a>                <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"OUTPUT"</span><span class="p">)</span>
<a id="__codelineno-0-3310" name="__codelineno-0-3310"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-3311" name="__codelineno-0-3311"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-3312" name="__codelineno-0-3312"></a>                    <span class="sa">f</span><span class="s2">"Problem calculating investability for activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-3313" name="__codelineno-0-3313"></a>                <span class="p">)</span>
<a id="__codelineno-0-3314" name="__codelineno-0-3314"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-3315" name="__codelineno-0-3315"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem calculating activity investability, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-3316" name="__codelineno-0-3316"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
<a id="__codelineno-0-3317" name="__codelineno-0-3317"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-3318" name="__codelineno-0-3318"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-3319" name="__codelineno-0-3319"></a>
<a id="__codelineno-0-3320" name="__codelineno-0-3320"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_normalize_pathways_carbon_impact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_normalize_pathways_carbon_impact</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_normalize_pathways_carbon_impact" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_normalize_pathways_carbon_impact</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Normalizes the total carbon impact for the pathways grouped by the pathway type</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>pathways</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="NcsPathway (src.cplus_plugin.models.base.NcsPathway)" href="../../models/api_base/#src.cplus_plugin.models.base.NcsPathway">NcsPathway</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the pathways</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2550">2550</a></span>
<span class="normal"><a href="#__codelineno-0-2551">2551</a></span>
<span class="normal"><a href="#__codelineno-0-2552">2552</a></span>
<span class="normal"><a href="#__codelineno-0-2553">2553</a></span>
<span class="normal"><a href="#__codelineno-0-2554">2554</a></span>
<span class="normal"><a href="#__codelineno-0-2555">2555</a></span>
<span class="normal"><a href="#__codelineno-0-2556">2556</a></span>
<span class="normal"><a href="#__codelineno-0-2557">2557</a></span>
<span class="normal"><a href="#__codelineno-0-2558">2558</a></span>
<span class="normal"><a href="#__codelineno-0-2559">2559</a></span>
<span class="normal"><a href="#__codelineno-0-2560">2560</a></span>
<span class="normal"><a href="#__codelineno-0-2561">2561</a></span>
<span class="normal"><a href="#__codelineno-0-2562">2562</a></span>
<span class="normal"><a href="#__codelineno-0-2563">2563</a></span>
<span class="normal"><a href="#__codelineno-0-2564">2564</a></span>
<span class="normal"><a href="#__codelineno-0-2565">2565</a></span>
<span class="normal"><a href="#__codelineno-0-2566">2566</a></span>
<span class="normal"><a href="#__codelineno-0-2567">2567</a></span>
<span class="normal"><a href="#__codelineno-0-2568">2568</a></span>
<span class="normal"><a href="#__codelineno-0-2569">2569</a></span>
<span class="normal"><a href="#__codelineno-0-2570">2570</a></span>
<span class="normal"><a href="#__codelineno-0-2571">2571</a></span>
<span class="normal"><a href="#__codelineno-0-2572">2572</a></span>
<span class="normal"><a href="#__codelineno-0-2573">2573</a></span>
<span class="normal"><a href="#__codelineno-0-2574">2574</a></span>
<span class="normal"><a href="#__codelineno-0-2575">2575</a></span>
<span class="normal"><a href="#__codelineno-0-2576">2576</a></span>
<span class="normal"><a href="#__codelineno-0-2577">2577</a></span>
<span class="normal"><a href="#__codelineno-0-2578">2578</a></span>
<span class="normal"><a href="#__codelineno-0-2579">2579</a></span>
<span class="normal"><a href="#__codelineno-0-2580">2580</a></span>
<span class="normal"><a href="#__codelineno-0-2581">2581</a></span>
<span class="normal"><a href="#__codelineno-0-2582">2582</a></span>
<span class="normal"><a href="#__codelineno-0-2583">2583</a></span>
<span class="normal"><a href="#__codelineno-0-2584">2584</a></span>
<span class="normal"><a href="#__codelineno-0-2585">2585</a></span>
<span class="normal"><a href="#__codelineno-0-2586">2586</a></span>
<span class="normal"><a href="#__codelineno-0-2587">2587</a></span>
<span class="normal"><a href="#__codelineno-0-2588">2588</a></span>
<span class="normal"><a href="#__codelineno-0-2589">2589</a></span>
<span class="normal"><a href="#__codelineno-0-2590">2590</a></span>
<span class="normal"><a href="#__codelineno-0-2591">2591</a></span>
<span class="normal"><a href="#__codelineno-0-2592">2592</a></span>
<span class="normal"><a href="#__codelineno-0-2593">2593</a></span>
<span class="normal"><a href="#__codelineno-0-2594">2594</a></span>
<span class="normal"><a href="#__codelineno-0-2595">2595</a></span>
<span class="normal"><a href="#__codelineno-0-2596">2596</a></span>
<span class="normal"><a href="#__codelineno-0-2597">2597</a></span>
<span class="normal"><a href="#__codelineno-0-2598">2598</a></span>
<span class="normal"><a href="#__codelineno-0-2599">2599</a></span>
<span class="normal"><a href="#__codelineno-0-2600">2600</a></span>
<span class="normal"><a href="#__codelineno-0-2601">2601</a></span>
<span class="normal"><a href="#__codelineno-0-2602">2602</a></span>
<span class="normal"><a href="#__codelineno-0-2603">2603</a></span>
<span class="normal"><a href="#__codelineno-0-2604">2604</a></span>
<span class="normal"><a href="#__codelineno-0-2605">2605</a></span>
<span class="normal"><a href="#__codelineno-0-2606">2606</a></span>
<span class="normal"><a href="#__codelineno-0-2607">2607</a></span>
<span class="normal"><a href="#__codelineno-0-2608">2608</a></span>
<span class="normal"><a href="#__codelineno-0-2609">2609</a></span>
<span class="normal"><a href="#__codelineno-0-2610">2610</a></span>
<span class="normal"><a href="#__codelineno-0-2611">2611</a></span>
<span class="normal"><a href="#__codelineno-0-2612">2612</a></span>
<span class="normal"><a href="#__codelineno-0-2613">2613</a></span>
<span class="normal"><a href="#__codelineno-0-2614">2614</a></span>
<span class="normal"><a href="#__codelineno-0-2615">2615</a></span>
<span class="normal"><a href="#__codelineno-0-2616">2616</a></span>
<span class="normal"><a href="#__codelineno-0-2617">2617</a></span>
<span class="normal"><a href="#__codelineno-0-2618">2618</a></span>
<span class="normal"><a href="#__codelineno-0-2619">2619</a></span>
<span class="normal"><a href="#__codelineno-0-2620">2620</a></span>
<span class="normal"><a href="#__codelineno-0-2621">2621</a></span>
<span class="normal"><a href="#__codelineno-0-2622">2622</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2550" name="__codelineno-0-2550"></a><span class="k">def</span> <span class="nf">run_normalize_pathways_carbon_impact</span><span class="p">(</span>
<a id="__codelineno-0-2551" name="__codelineno-0-2551"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">pathways</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">NcsPathway</span><span class="p">]</span>
<a id="__codelineno-0-2552" name="__codelineno-0-2552"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-2553" name="__codelineno-0-2553"></a>    <span class="sd">"""Normalizes the total carbon impact for the pathways grouped by the pathway type</span>
<a id="__codelineno-0-2554" name="__codelineno-0-2554"></a>
<a id="__codelineno-0-2555" name="__codelineno-0-2555"></a><span class="sd">    :param pathways: List of the pathways</span>
<a id="__codelineno-0-2556" name="__codelineno-0-2556"></a><span class="sd">    :type pathways: typing.List[NcsPathway]</span>
<a id="__codelineno-0-2557" name="__codelineno-0-2557"></a>
<a id="__codelineno-0-2558" name="__codelineno-0-2558"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-2559" name="__codelineno-0-2559"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-2560" name="__codelineno-0-2560"></a><span class="sd">    """</span>
<a id="__codelineno-0-2561" name="__codelineno-0-2561"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2562" name="__codelineno-0-2562"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2563" name="__codelineno-0-2563"></a>
<a id="__codelineno-0-2564" name="__codelineno-0-2564"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Normalizing Total Carbon Impact for Pathways"</span><span class="p">))</span>
<a id="__codelineno-0-2565" name="__codelineno-0-2565"></a>
<a id="__codelineno-0-2566" name="__codelineno-0-2566"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2567" name="__codelineno-0-2567"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">tr</span><span class="p">(</span><span class="sa">f</span><span class="s2">"No defined pathways for running normalize total carbon impact."</span><span class="p">)</span>
<a id="__codelineno-0-2568" name="__codelineno-0-2568"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-2569" name="__codelineno-0-2569"></a>            <span class="n">msg</span><span class="p">,</span>
<a id="__codelineno-0-2570" name="__codelineno-0-2570"></a>            <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-2571" name="__codelineno-0-2571"></a>        <span class="p">)</span>
<a id="__codelineno-0-2572" name="__codelineno-0-2572"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-2573" name="__codelineno-0-2573"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2574" name="__codelineno-0-2574"></a>
<a id="__codelineno-0-2575" name="__codelineno-0-2575"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-2576" name="__codelineno-0-2576"></a>        <span class="n">pathways_carbon_value</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-2577" name="__codelineno-0-2577"></a>            <span class="n">p</span><span class="o">.</span><span class="n">type_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"carbon_impact"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-2578" name="__codelineno-0-2578"></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pathways</span>
<a id="__codelineno-0-2579" name="__codelineno-0-2579"></a>            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">pathway_type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">NcsPathwayType</span><span class="o">.</span><span class="n">MANAGE</span><span class="p">,</span> <span class="n">NcsPathwayType</span><span class="o">.</span><span class="n">RESTORE</span><span class="p">)</span>
<a id="__codelineno-0-2580" name="__codelineno-0-2580"></a>        <span class="p">]</span>
<a id="__codelineno-0-2581" name="__codelineno-0-2581"></a>        <span class="n">pathways_carbon_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pathways_carbon_value</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-2582" name="__codelineno-0-2582"></a>
<a id="__codelineno-0-2583" name="__codelineno-0-2583"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathways_carbon_value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2584" name="__codelineno-0-2584"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="s2">"No manage or restore pathways"</span><span class="p">)</span>
<a id="__codelineno-0-2585" name="__codelineno-0-2585"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2586" name="__codelineno-0-2586"></a>
<a id="__codelineno-0-2587" name="__codelineno-0-2587"></a>        <span class="c1"># Calculate min/max for each pathway type</span>
<a id="__codelineno-0-2588" name="__codelineno-0-2588"></a>
<a id="__codelineno-0-2589" name="__codelineno-0-2589"></a>        <span class="n">carbon_stats</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2590" name="__codelineno-0-2590"></a>            <span class="s2">"min"</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">pathways_carbon_value</span><span class="p">),</span>
<a id="__codelineno-0-2591" name="__codelineno-0-2591"></a>            <span class="s2">"max"</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">pathways_carbon_value</span><span class="p">),</span>
<a id="__codelineno-0-2592" name="__codelineno-0-2592"></a>            <span class="s2">"range"</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">pathways_carbon_value</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">pathways_carbon_value</span><span class="p">),</span>
<a id="__codelineno-0-2593" name="__codelineno-0-2593"></a>        <span class="p">}</span>
<a id="__codelineno-0-2594" name="__codelineno-0-2594"></a>
<a id="__codelineno-0-2595" name="__codelineno-0-2595"></a>        <span class="c1"># Normalize carbon impact for each pathway</span>
<a id="__codelineno-0-2596" name="__codelineno-0-2596"></a>        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-2597" name="__codelineno-0-2597"></a>            <span class="c1"># Ignore protect pathways</span>
<a id="__codelineno-0-2598" name="__codelineno-0-2598"></a>            <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">pathway_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
<a id="__codelineno-0-2599" name="__codelineno-0-2599"></a>                <span class="n">NcsPathwayType</span><span class="o">.</span><span class="n">MANAGE</span><span class="p">,</span>
<a id="__codelineno-0-2600" name="__codelineno-0-2600"></a>                <span class="n">NcsPathwayType</span><span class="o">.</span><span class="n">RESTORE</span><span class="p">,</span>
<a id="__codelineno-0-2601" name="__codelineno-0-2601"></a>            <span class="p">):</span>
<a id="__codelineno-0-2602" name="__codelineno-0-2602"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2603" name="__codelineno-0-2603"></a>
<a id="__codelineno-0-2604" name="__codelineno-0-2604"></a>            <span class="n">carbon_impact</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">type_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"carbon_impact"</span><span class="p">)</span>
<a id="__codelineno-0-2605" name="__codelineno-0-2605"></a>            <span class="k">if</span> <span class="n">carbon_impact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2606" name="__codelineno-0-2606"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2607" name="__codelineno-0-2607"></a>
<a id="__codelineno-0-2608" name="__codelineno-0-2608"></a>            <span class="k">if</span> <span class="n">carbon_stats</span><span class="p">[</span><span class="s2">"range"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2609" name="__codelineno-0-2609"></a>                <span class="c1"># All values are the same carbon impact</span>
<a id="__codelineno-0-2610" name="__codelineno-0-2610"></a>                <span class="n">norm_carbon_impact</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathways_carbon_value</span><span class="p">)</span>
<a id="__codelineno-0-2611" name="__codelineno-0-2611"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2612" name="__codelineno-0-2612"></a>                <span class="n">norm_carbon_impact</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2613" name="__codelineno-0-2613"></a>                    <span class="n">carbon_impact</span> <span class="o">-</span> <span class="n">carbon_stats</span><span class="p">[</span><span class="s2">"min"</span><span class="p">]</span>
<a id="__codelineno-0-2614" name="__codelineno-0-2614"></a>                <span class="p">)</span> <span class="o">/</span> <span class="n">carbon_stats</span><span class="p">[</span><span class="s2">"range"</span><span class="p">]</span>
<a id="__codelineno-0-2615" name="__codelineno-0-2615"></a>
<a id="__codelineno-0-2616" name="__codelineno-0-2616"></a>            <span class="n">pathway</span><span class="o">.</span><span class="n">type_options</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">"norm_carbon_impact"</span><span class="p">:</span> <span class="n">norm_carbon_impact</span><span class="p">})</span>
<a id="__codelineno-0-2617" name="__codelineno-0-2617"></a>
<a id="__codelineno-0-2618" name="__codelineno-0-2618"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-2619" name="__codelineno-0-2619"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-2620" name="__codelineno-0-2620"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem normalizing pathways carbon impact, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-2621" name="__codelineno-0-2621"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2622" name="__codelineno-0-2622"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_pathways_carbon_summation" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_pathways_carbon_summation</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_pathways_carbon_summation" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_pathways_carbon_summation</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Calculates total carbon mitigation values for the Naturebase pathways.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="k">def</span> <span class="nf">run_pathways_carbon_summation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>    <span class="sd">"""Calculates total carbon mitigation values for the Naturebase pathways.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">    """</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="n">tr</span><span class="p">(</span><span class="s2">"Calculating total carbon mitigation values for the Naturebase pathways"</span><span class="p">)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>    <span class="p">)</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="n">pathways</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">NcsPathway</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"""No defined activity pathways or</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="s2">                 activity layers for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"></span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="s2">                """</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"Naturebase:"</span><span class="p">)</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                    <span class="ow">and</span> <span class="n">pathway</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathways</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                <span class="p">):</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                    <span class="n">pathways</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="s2">"No Naturebase pathways found in any activity."</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>            <span class="n">pathway_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">pathway_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>                    <span class="sa">f</span><span class="s2">"Pathway layer </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not valid, "</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>                    <span class="sa">f</span><span class="s2">"skipping calculating total carbon value for layer."</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                <span class="p">)</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                <span class="k">continue</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>            <span class="n">raster_provider</span> <span class="o">=</span> <span class="n">pathway_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">raster_provider</span><span class="o">.</span><span class="n">bandStatistics</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">QgsRasterBandStats</span><span class="o">.</span><span class="n">Stats</span><span class="o">.</span><span class="n">Sum</span><span class="p">)</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="k">if</span> <span class="n">stats</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">stats</span><span class="o">.</span><span class="n">sum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>                    <span class="sa">f</span><span class="s2">"Could not calculate statistics for </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, skipping."</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>                <span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>                <span class="k">continue</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="n">pathway</span><span class="o">.</span><span class="n">carbon_impact_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">sum</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="sa">f</span><span class="s2">"Problem calculating total carbon values for layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="p">)</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_pathways_replace_nodata" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_pathways_replace_nodata</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_pathways_replace_nodata" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_pathways_replace_nodata</span><span class="p">(</span><span class="n">nodata_value</span><span class="o">=-</span><span class="mf">9999.0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Replace the nodata value for activity pathways and priority layers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>nodata_value</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The nodata value to replace in the pathways and priority layers</p>
              </div>
            </td>
            <td>
                  <code>-9999.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="k">def</span> <span class="nf">run_pathways_replace_nodata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodata_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>    <span class="sd">"""Replace the nodata value for activity pathways and priority layers.</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    :param nodata_value: The nodata value to replace in the pathways and priority layers</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">    :type nodata_value: float</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">    """</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="s2">"Replacing the nodata value for the activity pathways and priority layers"</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="p">)</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>    <span class="n">pathways</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">NcsPathway</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="c1"># Create directories for replaced nodata pathways and priority layers</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="n">replaced_nodata_pathways_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"pathways"</span><span class="p">,</span> <span class="s2">"replaced_nodata"</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">replaced_nodata_pathways_directory</span><span class="p">)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="n">replaced_nodata_priority_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"priority_layer"</span><span class="p">,</span> <span class="s2">"replaced_nodata"</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="p">)</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">replaced_nodata_priority_directory</span><span class="p">)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_activities</span><span class="p">:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>            <span class="p">):</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>                    <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>                        <span class="sa">f</span><span class="s2">"No defined activity pathways or "</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>                        <span class="sa">f</span><span class="s2">" activity layers for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>                    <span class="p">),</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>                    <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                <span class="p">)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                    <span class="sa">f</span><span class="s2">"No defined activity pathways or "</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                    <span class="sa">f</span><span class="s2">"activity layers for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                <span class="p">)</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">):</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>                    <span class="n">pathways</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="c1"># Replace the no data value for priority layers</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="c1"># Dict with PWL uuid as key and path as value</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>        <span class="n">priority_layers_paths</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>        <span class="k">for</span> <span class="n">priority_layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_priority_layers</span><span class="p">():</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="k">if</span> <span class="n">priority_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                <span class="k">continue</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>            <span class="n">priority_layer_path</span> <span class="o">=</span> <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">priority_layer_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                <span class="k">continue</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>            <span class="n">priority_layers_paths</span><span class="p">[</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">priority_layer_path</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>            <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">priority_layer_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>                    <span class="sa">f</span><span class="s2">"Priority layer </span><span class="si">{</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not valid, "</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>                    <span class="sa">f</span><span class="s2">"skipping replacing nodata value for layer."</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>                <span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>                <span class="k">continue</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>            <span class="n">raster_provider</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>            <span class="n">raster_no_data_value</span> <span class="o">=</span> <span class="n">raster_provider</span><span class="o">.</span><span class="n">sourceNoDataValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>            <span class="k">if</span> <span class="n">raster_no_data_value</span> <span class="o">==</span> <span class="n">nodata_value</span><span class="p">:</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>                    <span class="sa">f</span><span class="s2">"Priority layer </span><span class="si">{</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="si">}</span><span class="s2"> already has the nodata value "</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">nodata_value</span><span class="si">}</span><span class="s2">, skipping replacing nodata value for layer."</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                <span class="p">)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                <span class="k">continue</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>                <span class="sa">f</span><span class="s2">"Replacing nodata value for </span><span class="si">{</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="si">}</span><span class="s2"> priority layer "</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>                <span class="sa">f</span><span class="s2">"to </span><span class="si">{</span><span class="n">nodata_value</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>            <span class="p">)</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>                <span class="n">replaced_nodata_priority_directory</span><span class="p">,</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">uuid</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>            <span class="p">)</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nodata</span><span class="p">(</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="n">priority_layer_path</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">nodata_value</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="p">)</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>                <span class="n">priority_layers_paths</span><span class="p">[</span><span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">output_file</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="k">if</span> <span class="n">pathways</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                <span class="n">pathway_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                    <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pathway_layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                        <span class="sa">f</span><span class="s2">"Pathway layer </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not valid, "</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                        <span class="sa">f</span><span class="s2">"skipping replacing nodata value for layer."</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                    <span class="p">)</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                <span class="n">raster_provider</span> <span class="o">=</span> <span class="n">pathway_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                <span class="n">raster_no_data_value</span> <span class="o">=</span> <span class="n">raster_provider</span><span class="o">.</span><span class="n">sourceNoDataValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                <span class="k">if</span> <span class="n">raster_no_data_value</span> <span class="o">==</span> <span class="n">nodata_value</span><span class="p">:</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>                        <span class="sa">f</span><span class="s2">"Pathway layer </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> already has the nodata value "</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">nodata_value</span><span class="si">}</span><span class="s2">, skipping replacing nodata value for layer."</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                    <span class="p">)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                        <span class="sa">f</span><span class="s2">"Replacing nodata value for </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> pathway layer "</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                        <span class="sa">f</span><span class="s2">"from </span><span class="si">{</span><span class="n">raster_no_data_value</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">nodata_value</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                    <span class="p">)</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                    <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                        <span class="n">replaced_nodata_pathways_directory</span><span class="p">,</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                        <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">uuid</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>                    <span class="p">)</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_nodata</span><span class="p">(</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                        <span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">nodata_value</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                    <span class="p">)</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>                    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                        <span class="n">pathway</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">output_file</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>                <span class="p">):</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>                    <span class="n">pathway_priority_layers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>                    <span class="k">for</span> <span class="n">priority_layer</span> <span class="ow">in</span> <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">:</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                        <span class="n">pwl_uuid</span> <span class="o">=</span> <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                        <span class="k">if</span> <span class="n">pwl_uuid</span> <span class="ow">in</span> <span class="n">priority_layers_paths</span><span class="p">:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                            <span class="n">priority_layer</span><span class="p">[</span><span class="s2">"path"</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority_layers_paths</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>                                <span class="n">pwl_uuid</span><span class="p">,</span> <span class="s2">""</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                            <span class="p">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                        <span class="n">pathway_priority_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priority_layer</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span> <span class="o">=</span> <span class="n">pathway_priority_layers</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem replacing nodata value for layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.run_pathways_weighting" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_pathways_weighting</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.run_pathways_weighting" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">run_pathways_weighting</span><span class="p">(</span><span class="n">activities</span><span class="p">,</span> <span class="n">priority_layers_groups</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Runs weighting analysis on the pathways in the activities using
the corresponding NCS PWLs.</p>
<p>The formula is: (suitability_index * pathway) *
((priority group coefficient 1 * impact weight * PWL 1) +
(priority group coefficient 2 * impact weight * PWL 2) ...)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activities</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the selected activities</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>priority_layers_groups</code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used priority layers groups and their values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>selected extent from user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>temporary_output</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the processing outputs as temporary files</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the task operation was successfully completed else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2624">2624</a></span>
<span class="normal"><a href="#__codelineno-0-2625">2625</a></span>
<span class="normal"><a href="#__codelineno-0-2626">2626</a></span>
<span class="normal"><a href="#__codelineno-0-2627">2627</a></span>
<span class="normal"><a href="#__codelineno-0-2628">2628</a></span>
<span class="normal"><a href="#__codelineno-0-2629">2629</a></span>
<span class="normal"><a href="#__codelineno-0-2630">2630</a></span>
<span class="normal"><a href="#__codelineno-0-2631">2631</a></span>
<span class="normal"><a href="#__codelineno-0-2632">2632</a></span>
<span class="normal"><a href="#__codelineno-0-2633">2633</a></span>
<span class="normal"><a href="#__codelineno-0-2634">2634</a></span>
<span class="normal"><a href="#__codelineno-0-2635">2635</a></span>
<span class="normal"><a href="#__codelineno-0-2636">2636</a></span>
<span class="normal"><a href="#__codelineno-0-2637">2637</a></span>
<span class="normal"><a href="#__codelineno-0-2638">2638</a></span>
<span class="normal"><a href="#__codelineno-0-2639">2639</a></span>
<span class="normal"><a href="#__codelineno-0-2640">2640</a></span>
<span class="normal"><a href="#__codelineno-0-2641">2641</a></span>
<span class="normal"><a href="#__codelineno-0-2642">2642</a></span>
<span class="normal"><a href="#__codelineno-0-2643">2643</a></span>
<span class="normal"><a href="#__codelineno-0-2644">2644</a></span>
<span class="normal"><a href="#__codelineno-0-2645">2645</a></span>
<span class="normal"><a href="#__codelineno-0-2646">2646</a></span>
<span class="normal"><a href="#__codelineno-0-2647">2647</a></span>
<span class="normal"><a href="#__codelineno-0-2648">2648</a></span>
<span class="normal"><a href="#__codelineno-0-2649">2649</a></span>
<span class="normal"><a href="#__codelineno-0-2650">2650</a></span>
<span class="normal"><a href="#__codelineno-0-2651">2651</a></span>
<span class="normal"><a href="#__codelineno-0-2652">2652</a></span>
<span class="normal"><a href="#__codelineno-0-2653">2653</a></span>
<span class="normal"><a href="#__codelineno-0-2654">2654</a></span>
<span class="normal"><a href="#__codelineno-0-2655">2655</a></span>
<span class="normal"><a href="#__codelineno-0-2656">2656</a></span>
<span class="normal"><a href="#__codelineno-0-2657">2657</a></span>
<span class="normal"><a href="#__codelineno-0-2658">2658</a></span>
<span class="normal"><a href="#__codelineno-0-2659">2659</a></span>
<span class="normal"><a href="#__codelineno-0-2660">2660</a></span>
<span class="normal"><a href="#__codelineno-0-2661">2661</a></span>
<span class="normal"><a href="#__codelineno-0-2662">2662</a></span>
<span class="normal"><a href="#__codelineno-0-2663">2663</a></span>
<span class="normal"><a href="#__codelineno-0-2664">2664</a></span>
<span class="normal"><a href="#__codelineno-0-2665">2665</a></span>
<span class="normal"><a href="#__codelineno-0-2666">2666</a></span>
<span class="normal"><a href="#__codelineno-0-2667">2667</a></span>
<span class="normal"><a href="#__codelineno-0-2668">2668</a></span>
<span class="normal"><a href="#__codelineno-0-2669">2669</a></span>
<span class="normal"><a href="#__codelineno-0-2670">2670</a></span>
<span class="normal"><a href="#__codelineno-0-2671">2671</a></span>
<span class="normal"><a href="#__codelineno-0-2672">2672</a></span>
<span class="normal"><a href="#__codelineno-0-2673">2673</a></span>
<span class="normal"><a href="#__codelineno-0-2674">2674</a></span>
<span class="normal"><a href="#__codelineno-0-2675">2675</a></span>
<span class="normal"><a href="#__codelineno-0-2676">2676</a></span>
<span class="normal"><a href="#__codelineno-0-2677">2677</a></span>
<span class="normal"><a href="#__codelineno-0-2678">2678</a></span>
<span class="normal"><a href="#__codelineno-0-2679">2679</a></span>
<span class="normal"><a href="#__codelineno-0-2680">2680</a></span>
<span class="normal"><a href="#__codelineno-0-2681">2681</a></span>
<span class="normal"><a href="#__codelineno-0-2682">2682</a></span>
<span class="normal"><a href="#__codelineno-0-2683">2683</a></span>
<span class="normal"><a href="#__codelineno-0-2684">2684</a></span>
<span class="normal"><a href="#__codelineno-0-2685">2685</a></span>
<span class="normal"><a href="#__codelineno-0-2686">2686</a></span>
<span class="normal"><a href="#__codelineno-0-2687">2687</a></span>
<span class="normal"><a href="#__codelineno-0-2688">2688</a></span>
<span class="normal"><a href="#__codelineno-0-2689">2689</a></span>
<span class="normal"><a href="#__codelineno-0-2690">2690</a></span>
<span class="normal"><a href="#__codelineno-0-2691">2691</a></span>
<span class="normal"><a href="#__codelineno-0-2692">2692</a></span>
<span class="normal"><a href="#__codelineno-0-2693">2693</a></span>
<span class="normal"><a href="#__codelineno-0-2694">2694</a></span>
<span class="normal"><a href="#__codelineno-0-2695">2695</a></span>
<span class="normal"><a href="#__codelineno-0-2696">2696</a></span>
<span class="normal"><a href="#__codelineno-0-2697">2697</a></span>
<span class="normal"><a href="#__codelineno-0-2698">2698</a></span>
<span class="normal"><a href="#__codelineno-0-2699">2699</a></span>
<span class="normal"><a href="#__codelineno-0-2700">2700</a></span>
<span class="normal"><a href="#__codelineno-0-2701">2701</a></span>
<span class="normal"><a href="#__codelineno-0-2702">2702</a></span>
<span class="normal"><a href="#__codelineno-0-2703">2703</a></span>
<span class="normal"><a href="#__codelineno-0-2704">2704</a></span>
<span class="normal"><a href="#__codelineno-0-2705">2705</a></span>
<span class="normal"><a href="#__codelineno-0-2706">2706</a></span>
<span class="normal"><a href="#__codelineno-0-2707">2707</a></span>
<span class="normal"><a href="#__codelineno-0-2708">2708</a></span>
<span class="normal"><a href="#__codelineno-0-2709">2709</a></span>
<span class="normal"><a href="#__codelineno-0-2710">2710</a></span>
<span class="normal"><a href="#__codelineno-0-2711">2711</a></span>
<span class="normal"><a href="#__codelineno-0-2712">2712</a></span>
<span class="normal"><a href="#__codelineno-0-2713">2713</a></span>
<span class="normal"><a href="#__codelineno-0-2714">2714</a></span>
<span class="normal"><a href="#__codelineno-0-2715">2715</a></span>
<span class="normal"><a href="#__codelineno-0-2716">2716</a></span>
<span class="normal"><a href="#__codelineno-0-2717">2717</a></span>
<span class="normal"><a href="#__codelineno-0-2718">2718</a></span>
<span class="normal"><a href="#__codelineno-0-2719">2719</a></span>
<span class="normal"><a href="#__codelineno-0-2720">2720</a></span>
<span class="normal"><a href="#__codelineno-0-2721">2721</a></span>
<span class="normal"><a href="#__codelineno-0-2722">2722</a></span>
<span class="normal"><a href="#__codelineno-0-2723">2723</a></span>
<span class="normal"><a href="#__codelineno-0-2724">2724</a></span>
<span class="normal"><a href="#__codelineno-0-2725">2725</a></span>
<span class="normal"><a href="#__codelineno-0-2726">2726</a></span>
<span class="normal"><a href="#__codelineno-0-2727">2727</a></span>
<span class="normal"><a href="#__codelineno-0-2728">2728</a></span>
<span class="normal"><a href="#__codelineno-0-2729">2729</a></span>
<span class="normal"><a href="#__codelineno-0-2730">2730</a></span>
<span class="normal"><a href="#__codelineno-0-2731">2731</a></span>
<span class="normal"><a href="#__codelineno-0-2732">2732</a></span>
<span class="normal"><a href="#__codelineno-0-2733">2733</a></span>
<span class="normal"><a href="#__codelineno-0-2734">2734</a></span>
<span class="normal"><a href="#__codelineno-0-2735">2735</a></span>
<span class="normal"><a href="#__codelineno-0-2736">2736</a></span>
<span class="normal"><a href="#__codelineno-0-2737">2737</a></span>
<span class="normal"><a href="#__codelineno-0-2738">2738</a></span>
<span class="normal"><a href="#__codelineno-0-2739">2739</a></span>
<span class="normal"><a href="#__codelineno-0-2740">2740</a></span>
<span class="normal"><a href="#__codelineno-0-2741">2741</a></span>
<span class="normal"><a href="#__codelineno-0-2742">2742</a></span>
<span class="normal"><a href="#__codelineno-0-2743">2743</a></span>
<span class="normal"><a href="#__codelineno-0-2744">2744</a></span>
<span class="normal"><a href="#__codelineno-0-2745">2745</a></span>
<span class="normal"><a href="#__codelineno-0-2746">2746</a></span>
<span class="normal"><a href="#__codelineno-0-2747">2747</a></span>
<span class="normal"><a href="#__codelineno-0-2748">2748</a></span>
<span class="normal"><a href="#__codelineno-0-2749">2749</a></span>
<span class="normal"><a href="#__codelineno-0-2750">2750</a></span>
<span class="normal"><a href="#__codelineno-0-2751">2751</a></span>
<span class="normal"><a href="#__codelineno-0-2752">2752</a></span>
<span class="normal"><a href="#__codelineno-0-2753">2753</a></span>
<span class="normal"><a href="#__codelineno-0-2754">2754</a></span>
<span class="normal"><a href="#__codelineno-0-2755">2755</a></span>
<span class="normal"><a href="#__codelineno-0-2756">2756</a></span>
<span class="normal"><a href="#__codelineno-0-2757">2757</a></span>
<span class="normal"><a href="#__codelineno-0-2758">2758</a></span>
<span class="normal"><a href="#__codelineno-0-2759">2759</a></span>
<span class="normal"><a href="#__codelineno-0-2760">2760</a></span>
<span class="normal"><a href="#__codelineno-0-2761">2761</a></span>
<span class="normal"><a href="#__codelineno-0-2762">2762</a></span>
<span class="normal"><a href="#__codelineno-0-2763">2763</a></span>
<span class="normal"><a href="#__codelineno-0-2764">2764</a></span>
<span class="normal"><a href="#__codelineno-0-2765">2765</a></span>
<span class="normal"><a href="#__codelineno-0-2766">2766</a></span>
<span class="normal"><a href="#__codelineno-0-2767">2767</a></span>
<span class="normal"><a href="#__codelineno-0-2768">2768</a></span>
<span class="normal"><a href="#__codelineno-0-2769">2769</a></span>
<span class="normal"><a href="#__codelineno-0-2770">2770</a></span>
<span class="normal"><a href="#__codelineno-0-2771">2771</a></span>
<span class="normal"><a href="#__codelineno-0-2772">2772</a></span>
<span class="normal"><a href="#__codelineno-0-2773">2773</a></span>
<span class="normal"><a href="#__codelineno-0-2774">2774</a></span>
<span class="normal"><a href="#__codelineno-0-2775">2775</a></span>
<span class="normal"><a href="#__codelineno-0-2776">2776</a></span>
<span class="normal"><a href="#__codelineno-0-2777">2777</a></span>
<span class="normal"><a href="#__codelineno-0-2778">2778</a></span>
<span class="normal"><a href="#__codelineno-0-2779">2779</a></span>
<span class="normal"><a href="#__codelineno-0-2780">2780</a></span>
<span class="normal"><a href="#__codelineno-0-2781">2781</a></span>
<span class="normal"><a href="#__codelineno-0-2782">2782</a></span>
<span class="normal"><a href="#__codelineno-0-2783">2783</a></span>
<span class="normal"><a href="#__codelineno-0-2784">2784</a></span>
<span class="normal"><a href="#__codelineno-0-2785">2785</a></span>
<span class="normal"><a href="#__codelineno-0-2786">2786</a></span>
<span class="normal"><a href="#__codelineno-0-2787">2787</a></span>
<span class="normal"><a href="#__codelineno-0-2788">2788</a></span>
<span class="normal"><a href="#__codelineno-0-2789">2789</a></span>
<span class="normal"><a href="#__codelineno-0-2790">2790</a></span>
<span class="normal"><a href="#__codelineno-0-2791">2791</a></span>
<span class="normal"><a href="#__codelineno-0-2792">2792</a></span>
<span class="normal"><a href="#__codelineno-0-2793">2793</a></span>
<span class="normal"><a href="#__codelineno-0-2794">2794</a></span>
<span class="normal"><a href="#__codelineno-0-2795">2795</a></span>
<span class="normal"><a href="#__codelineno-0-2796">2796</a></span>
<span class="normal"><a href="#__codelineno-0-2797">2797</a></span>
<span class="normal"><a href="#__codelineno-0-2798">2798</a></span>
<span class="normal"><a href="#__codelineno-0-2799">2799</a></span>
<span class="normal"><a href="#__codelineno-0-2800">2800</a></span>
<span class="normal"><a href="#__codelineno-0-2801">2801</a></span>
<span class="normal"><a href="#__codelineno-0-2802">2802</a></span>
<span class="normal"><a href="#__codelineno-0-2803">2803</a></span>
<span class="normal"><a href="#__codelineno-0-2804">2804</a></span>
<span class="normal"><a href="#__codelineno-0-2805">2805</a></span>
<span class="normal"><a href="#__codelineno-0-2806">2806</a></span>
<span class="normal"><a href="#__codelineno-0-2807">2807</a></span>
<span class="normal"><a href="#__codelineno-0-2808">2808</a></span>
<span class="normal"><a href="#__codelineno-0-2809">2809</a></span>
<span class="normal"><a href="#__codelineno-0-2810">2810</a></span>
<span class="normal"><a href="#__codelineno-0-2811">2811</a></span>
<span class="normal"><a href="#__codelineno-0-2812">2812</a></span>
<span class="normal"><a href="#__codelineno-0-2813">2813</a></span>
<span class="normal"><a href="#__codelineno-0-2814">2814</a></span>
<span class="normal"><a href="#__codelineno-0-2815">2815</a></span>
<span class="normal"><a href="#__codelineno-0-2816">2816</a></span>
<span class="normal"><a href="#__codelineno-0-2817">2817</a></span>
<span class="normal"><a href="#__codelineno-0-2818">2818</a></span>
<span class="normal"><a href="#__codelineno-0-2819">2819</a></span>
<span class="normal"><a href="#__codelineno-0-2820">2820</a></span>
<span class="normal"><a href="#__codelineno-0-2821">2821</a></span>
<span class="normal"><a href="#__codelineno-0-2822">2822</a></span>
<span class="normal"><a href="#__codelineno-0-2823">2823</a></span>
<span class="normal"><a href="#__codelineno-0-2824">2824</a></span>
<span class="normal"><a href="#__codelineno-0-2825">2825</a></span>
<span class="normal"><a href="#__codelineno-0-2826">2826</a></span>
<span class="normal"><a href="#__codelineno-0-2827">2827</a></span>
<span class="normal"><a href="#__codelineno-0-2828">2828</a></span>
<span class="normal"><a href="#__codelineno-0-2829">2829</a></span>
<span class="normal"><a href="#__codelineno-0-2830">2830</a></span>
<span class="normal"><a href="#__codelineno-0-2831">2831</a></span>
<span class="normal"><a href="#__codelineno-0-2832">2832</a></span>
<span class="normal"><a href="#__codelineno-0-2833">2833</a></span>
<span class="normal"><a href="#__codelineno-0-2834">2834</a></span>
<span class="normal"><a href="#__codelineno-0-2835">2835</a></span>
<span class="normal"><a href="#__codelineno-0-2836">2836</a></span>
<span class="normal"><a href="#__codelineno-0-2837">2837</a></span>
<span class="normal"><a href="#__codelineno-0-2838">2838</a></span>
<span class="normal"><a href="#__codelineno-0-2839">2839</a></span>
<span class="normal"><a href="#__codelineno-0-2840">2840</a></span>
<span class="normal"><a href="#__codelineno-0-2841">2841</a></span>
<span class="normal"><a href="#__codelineno-0-2842">2842</a></span>
<span class="normal"><a href="#__codelineno-0-2843">2843</a></span>
<span class="normal"><a href="#__codelineno-0-2844">2844</a></span>
<span class="normal"><a href="#__codelineno-0-2845">2845</a></span>
<span class="normal"><a href="#__codelineno-0-2846">2846</a></span>
<span class="normal"><a href="#__codelineno-0-2847">2847</a></span>
<span class="normal"><a href="#__codelineno-0-2848">2848</a></span>
<span class="normal"><a href="#__codelineno-0-2849">2849</a></span>
<span class="normal"><a href="#__codelineno-0-2850">2850</a></span>
<span class="normal"><a href="#__codelineno-0-2851">2851</a></span>
<span class="normal"><a href="#__codelineno-0-2852">2852</a></span>
<span class="normal"><a href="#__codelineno-0-2853">2853</a></span>
<span class="normal"><a href="#__codelineno-0-2854">2854</a></span>
<span class="normal"><a href="#__codelineno-0-2855">2855</a></span>
<span class="normal"><a href="#__codelineno-0-2856">2856</a></span>
<span class="normal"><a href="#__codelineno-0-2857">2857</a></span>
<span class="normal"><a href="#__codelineno-0-2858">2858</a></span>
<span class="normal"><a href="#__codelineno-0-2859">2859</a></span>
<span class="normal"><a href="#__codelineno-0-2860">2860</a></span>
<span class="normal"><a href="#__codelineno-0-2861">2861</a></span>
<span class="normal"><a href="#__codelineno-0-2862">2862</a></span>
<span class="normal"><a href="#__codelineno-0-2863">2863</a></span>
<span class="normal"><a href="#__codelineno-0-2864">2864</a></span>
<span class="normal"><a href="#__codelineno-0-2865">2865</a></span>
<span class="normal"><a href="#__codelineno-0-2866">2866</a></span>
<span class="normal"><a href="#__codelineno-0-2867">2867</a></span>
<span class="normal"><a href="#__codelineno-0-2868">2868</a></span>
<span class="normal"><a href="#__codelineno-0-2869">2869</a></span>
<span class="normal"><a href="#__codelineno-0-2870">2870</a></span>
<span class="normal"><a href="#__codelineno-0-2871">2871</a></span>
<span class="normal"><a href="#__codelineno-0-2872">2872</a></span>
<span class="normal"><a href="#__codelineno-0-2873">2873</a></span>
<span class="normal"><a href="#__codelineno-0-2874">2874</a></span>
<span class="normal"><a href="#__codelineno-0-2875">2875</a></span>
<span class="normal"><a href="#__codelineno-0-2876">2876</a></span>
<span class="normal"><a href="#__codelineno-0-2877">2877</a></span>
<span class="normal"><a href="#__codelineno-0-2878">2878</a></span>
<span class="normal"><a href="#__codelineno-0-2879">2879</a></span>
<span class="normal"><a href="#__codelineno-0-2880">2880</a></span>
<span class="normal"><a href="#__codelineno-0-2881">2881</a></span>
<span class="normal"><a href="#__codelineno-0-2882">2882</a></span>
<span class="normal"><a href="#__codelineno-0-2883">2883</a></span>
<span class="normal"><a href="#__codelineno-0-2884">2884</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-2624" name="__codelineno-0-2624"></a><span class="k">def</span> <span class="nf">run_pathways_weighting</span><span class="p">(</span>
<a id="__codelineno-0-2625" name="__codelineno-0-2625"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2626" name="__codelineno-0-2626"></a>    <span class="n">activities</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Activity</span><span class="p">],</span>
<a id="__codelineno-0-2627" name="__codelineno-0-2627"></a>    <span class="n">priority_layers_groups</span><span class="p">,</span>
<a id="__codelineno-0-2628" name="__codelineno-0-2628"></a>    <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-2629" name="__codelineno-0-2629"></a>    <span class="n">temporary_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2630" name="__codelineno-0-2630"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-2631" name="__codelineno-0-2631"></a>    <span class="sd">"""Runs weighting analysis on the pathways in the activities using</span>
<a id="__codelineno-0-2632" name="__codelineno-0-2632"></a><span class="sd">    the corresponding NCS PWLs.</span>
<a id="__codelineno-0-2633" name="__codelineno-0-2633"></a>
<a id="__codelineno-0-2634" name="__codelineno-0-2634"></a><span class="sd">    The formula is: (suitability_index * pathway) *</span>
<a id="__codelineno-0-2635" name="__codelineno-0-2635"></a><span class="sd">    ((priority group coefficient 1 * impact weight * PWL 1) +</span>
<a id="__codelineno-0-2636" name="__codelineno-0-2636"></a><span class="sd">    (priority group coefficient 2 * impact weight * PWL 2) ...)</span>
<a id="__codelineno-0-2637" name="__codelineno-0-2637"></a>
<a id="__codelineno-0-2638" name="__codelineno-0-2638"></a><span class="sd">    :param activities: List of the selected activities</span>
<a id="__codelineno-0-2639" name="__codelineno-0-2639"></a><span class="sd">    :type activities: typing.List[Activity]</span>
<a id="__codelineno-0-2640" name="__codelineno-0-2640"></a>
<a id="__codelineno-0-2641" name="__codelineno-0-2641"></a><span class="sd">    :param priority_layers_groups: Used priority layers groups and their values</span>
<a id="__codelineno-0-2642" name="__codelineno-0-2642"></a><span class="sd">    :type priority_layers_groups: dict</span>
<a id="__codelineno-0-2643" name="__codelineno-0-2643"></a>
<a id="__codelineno-0-2644" name="__codelineno-0-2644"></a><span class="sd">    :param extent: selected extent from user</span>
<a id="__codelineno-0-2645" name="__codelineno-0-2645"></a><span class="sd">    :type extent: str</span>
<a id="__codelineno-0-2646" name="__codelineno-0-2646"></a>
<a id="__codelineno-0-2647" name="__codelineno-0-2647"></a><span class="sd">    :param temporary_output: Whether to save the processing outputs as temporary</span>
<a id="__codelineno-0-2648" name="__codelineno-0-2648"></a><span class="sd">    files</span>
<a id="__codelineno-0-2649" name="__codelineno-0-2649"></a><span class="sd">    :type temporary_output: bool</span>
<a id="__codelineno-0-2650" name="__codelineno-0-2650"></a>
<a id="__codelineno-0-2651" name="__codelineno-0-2651"></a><span class="sd">    :returns: True if the task operation was successfully completed else False.</span>
<a id="__codelineno-0-2652" name="__codelineno-0-2652"></a><span class="sd">    :rtype: bool</span>
<a id="__codelineno-0-2653" name="__codelineno-0-2653"></a><span class="sd">    """</span>
<a id="__codelineno-0-2654" name="__codelineno-0-2654"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2655" name="__codelineno-0-2655"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2656" name="__codelineno-0-2656"></a>
<a id="__codelineno-0-2657" name="__codelineno-0-2657"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span><span class="n">tr</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Weighting of pathways"</span><span class="p">))</span>
<a id="__codelineno-0-2658" name="__codelineno-0-2658"></a>
<a id="__codelineno-0-2659" name="__codelineno-0-2659"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2660" name="__codelineno-0-2660"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">tr</span><span class="p">(</span><span class="sa">f</span><span class="s2">"No defined activities for running pathways weighting."</span><span class="p">)</span>
<a id="__codelineno-0-2661" name="__codelineno-0-2661"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-2662" name="__codelineno-0-2662"></a>            <span class="n">msg</span><span class="p">,</span>
<a id="__codelineno-0-2663" name="__codelineno-0-2663"></a>            <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-2664" name="__codelineno-0-2664"></a>        <span class="p">)</span>
<a id="__codelineno-0-2665" name="__codelineno-0-2665"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-2666" name="__codelineno-0-2666"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2667" name="__codelineno-0-2667"></a>
<a id="__codelineno-0-2668" name="__codelineno-0-2668"></a>    <span class="c1"># Get the relative impact matrix</span>
<a id="__codelineno-0-2669" name="__codelineno-0-2669"></a>    <span class="n">relative_impact_matrix</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-2670" name="__codelineno-0-2670"></a>    <span class="n">impact_matrix</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
<a id="__codelineno-0-2671" name="__codelineno-0-2671"></a>        <span class="n">Settings</span><span class="o">.</span><span class="n">SCENARIO_IMPACT_MATRIX</span><span class="p">,</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-2672" name="__codelineno-0-2672"></a>    <span class="p">)</span>
<a id="__codelineno-0-2673" name="__codelineno-0-2673"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">impact_matrix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2674" name="__codelineno-0-2674"></a>        <span class="n">relative_impact_matrix</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">impact_matrix</span><span class="p">)</span>
<a id="__codelineno-0-2675" name="__codelineno-0-2675"></a>
<a id="__codelineno-0-2676" name="__codelineno-0-2676"></a>    <span class="n">pathway_uuids</span> <span class="o">=</span> <span class="n">relative_impact_matrix</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"pathway_uuids"</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-2677" name="__codelineno-0-2677"></a>    <span class="n">priority_layer_uuids</span> <span class="o">=</span> <span class="n">relative_impact_matrix</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"priority_layer_uuids"</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-2678" name="__codelineno-0-2678"></a>    <span class="n">relative_impact_values</span> <span class="o">=</span> <span class="n">relative_impact_matrix</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"values"</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-0-2679" name="__codelineno-0-2679"></a>
<a id="__codelineno-0-2680" name="__codelineno-0-2680"></a>    <span class="c1"># Get valid pathways</span>
<a id="__codelineno-0-2681" name="__codelineno-0-2681"></a>    <span class="n">pathways</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">NcsPathway</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2682" name="__codelineno-0-2682"></a>    <span class="n">activities_paths</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2683" name="__codelineno-0-2683"></a>
<a id="__codelineno-0-2684" name="__codelineno-0-2684"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-2685" name="__codelineno-0-2685"></a>        <span class="c1"># Validate activities and corresponding pathways</span>
<a id="__codelineno-0-2686" name="__codelineno-0-2686"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
<a id="__codelineno-0-2687" name="__codelineno-0-2687"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-2688" name="__codelineno-0-2688"></a>                <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span>
<a id="__codelineno-0-2689" name="__codelineno-0-2689"></a>            <span class="p">):</span>
<a id="__codelineno-0-2690" name="__codelineno-0-2690"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-2691" name="__codelineno-0-2691"></a>                    <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-2692" name="__codelineno-0-2692"></a>                        <span class="sa">f</span><span class="s2">"No defined activity pathways or an"</span>
<a id="__codelineno-0-2693" name="__codelineno-0-2693"></a>                        <span class="sa">f</span><span class="s2">" activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2694" name="__codelineno-0-2694"></a>                    <span class="p">),</span>
<a id="__codelineno-0-2695" name="__codelineno-0-2695"></a>                    <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-2696" name="__codelineno-0-2696"></a>                <span class="p">)</span>
<a id="__codelineno-0-2697" name="__codelineno-0-2697"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2698" name="__codelineno-0-2698"></a>                    <span class="sa">f</span><span class="s2">"No defined activity pathways or an "</span>
<a id="__codelineno-0-2699" name="__codelineno-0-2699"></a>                    <span class="sa">f</span><span class="s2">"activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2700" name="__codelineno-0-2700"></a>                <span class="p">)</span>
<a id="__codelineno-0-2701" name="__codelineno-0-2701"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2702" name="__codelineno-0-2702"></a>
<a id="__codelineno-0-2703" name="__codelineno-0-2703"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-2704" name="__codelineno-0-2704"></a>                <span class="k">if</span> <span class="n">pathway</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-2705" name="__codelineno-0-2705"></a>                    <span class="n">pathways</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
<a id="__codelineno-0-2706" name="__codelineno-0-2706"></a>
<a id="__codelineno-0-2707" name="__codelineno-0-2707"></a>            <span class="k">if</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">:</span>
<a id="__codelineno-0-2708" name="__codelineno-0-2708"></a>                <span class="n">activities_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-2709" name="__codelineno-0-2709"></a>
<a id="__codelineno-0-2710" name="__codelineno-0-2710"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pathways</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">activities_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2711" name="__codelineno-0-2711"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_activities_analysis</span><span class="p">(</span><span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="p">)</span>
<a id="__codelineno-0-2712" name="__codelineno-0-2712"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2713" name="__codelineno-0-2713"></a>
<a id="__codelineno-0-2714" name="__codelineno-0-2714"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_normalize_pathways_carbon_impact</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span>
<a id="__codelineno-0-2715" name="__codelineno-0-2715"></a>
<a id="__codelineno-0-2716" name="__codelineno-0-2716"></a>        <span class="n">settings_priority_layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_priority_layers</span><span class="p">()</span>
<a id="__codelineno-0-2717" name="__codelineno-0-2717"></a>
<a id="__codelineno-0-2718" name="__codelineno-0-2718"></a>        <span class="n">weighted_pathways_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2719" name="__codelineno-0-2719"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"weighted_pathways"</span>
<a id="__codelineno-0-2720" name="__codelineno-0-2720"></a>        <span class="p">)</span>
<a id="__codelineno-0-2721" name="__codelineno-0-2721"></a>        <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">weighted_pathways_directory</span><span class="p">)</span>
<a id="__codelineno-0-2722" name="__codelineno-0-2722"></a>
<a id="__codelineno-0-2723" name="__codelineno-0-2723"></a>        <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-2724" name="__codelineno-0-2724"></a>            <span class="c1"># Skip processing if cancelled</span>
<a id="__codelineno-0-2725" name="__codelineno-0-2725"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2726" name="__codelineno-0-2726"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2727" name="__codelineno-0-2727"></a>
<a id="__codelineno-0-2728" name="__codelineno-0-2728"></a>            <span class="n">base_names</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2729" name="__codelineno-0-2729"></a>            <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">]</span>
<a id="__codelineno-0-2730" name="__codelineno-0-2730"></a>            <span class="n">run_calculation</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-2731" name="__codelineno-0-2731"></a>
<a id="__codelineno-0-2732" name="__codelineno-0-2732"></a>            <span class="c1"># Include suitability index if not zero</span>
<a id="__codelineno-0-2733" name="__codelineno-0-2733"></a>            <span class="n">pathway_basename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
<a id="__codelineno-0-2734" name="__codelineno-0-2734"></a>            <span class="k">if</span> <span class="n">pathway</span><span class="o">.</span><span class="n">suitability_index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2735" name="__codelineno-0-2735"></a>                <span class="n">base_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-2736" name="__codelineno-0-2736"></a>                    <span class="sa">f</span><span class="s1">'(</span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">suitability_index</span><span class="si">}</span><span class="s1">*"</span><span class="si">{</span><span class="n">pathway_basename</span><span class="si">}</span><span class="s1">@1")'</span>
<a id="__codelineno-0-2737" name="__codelineno-0-2737"></a>                <span class="p">)</span>
<a id="__codelineno-0-2738" name="__codelineno-0-2738"></a>                <span class="n">run_calculation</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2739" name="__codelineno-0-2739"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2740" name="__codelineno-0-2740"></a>                <span class="n">base_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">'("</span><span class="si">{</span><span class="n">pathway_basename</span><span class="si">}</span><span class="s1">@1")'</span><span class="p">)</span>
<a id="__codelineno-0-2741" name="__codelineno-0-2741"></a>
<a id="__codelineno-0-2742" name="__codelineno-0-2742"></a>            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">:</span>
<a id="__codelineno-0-2743" name="__codelineno-0-2743"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">priority_layers_groups</span><span class="p">):</span>
<a id="__codelineno-0-2744" name="__codelineno-0-2744"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2745" name="__codelineno-0-2745"></a>                        <span class="sa">f</span><span class="s2">"There are no defined priority layers in groups,"</span>
<a id="__codelineno-0-2746" name="__codelineno-0-2746"></a>                        <span class="sa">f</span><span class="s2">" skipping the inclusion of PWLs in pathways "</span>
<a id="__codelineno-0-2747" name="__codelineno-0-2747"></a>                        <span class="sa">f</span><span class="s2">"weighting."</span>
<a id="__codelineno-0-2748" name="__codelineno-0-2748"></a>                    <span class="p">)</span>
<a id="__codelineno-0-2749" name="__codelineno-0-2749"></a>                    <span class="k">break</span>
<a id="__codelineno-0-2750" name="__codelineno-0-2750"></a>
<a id="__codelineno-0-2751" name="__codelineno-0-2751"></a>                <span class="k">if</span> <span class="n">layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2752" name="__codelineno-0-2752"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-2753" name="__codelineno-0-2753"></a>
<a id="__codelineno-0-2754" name="__codelineno-0-2754"></a>                <span class="n">settings_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_priority_layer</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">))</span>
<a id="__codelineno-0-2755" name="__codelineno-0-2755"></a>                <span class="k">if</span> <span class="n">settings_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2756" name="__codelineno-0-2756"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-2757" name="__codelineno-0-2757"></a>
<a id="__codelineno-0-2758" name="__codelineno-0-2758"></a>                <span class="n">pwl</span> <span class="o">=</span> <span class="n">settings_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
<a id="__codelineno-0-2759" name="__codelineno-0-2759"></a>
<a id="__codelineno-0-2760" name="__codelineno-0-2760"></a>                <span class="n">missing_pwl_message</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2761" name="__codelineno-0-2761"></a>                    <span class="sa">f</span><span class="s2">"Path </span><span class="si">{</span><span class="n">pwl</span><span class="si">}</span><span class="s2"> for priority "</span>
<a id="__codelineno-0-2762" name="__codelineno-0-2762"></a>                    <span class="sa">f</span><span class="s2">"weighting layer </span><span class="si">{</span><span class="n">layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span><span class="si">}</span><span class="s2"> "</span>
<a id="__codelineno-0-2763" name="__codelineno-0-2763"></a>                    <span class="sa">f</span><span class="s2">"doesn't exist, skipping the layer "</span>
<a id="__codelineno-0-2764" name="__codelineno-0-2764"></a>                    <span class="sa">f</span><span class="s2">"from the pathway </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> weighting."</span>
<a id="__codelineno-0-2765" name="__codelineno-0-2765"></a>                <span class="p">)</span>
<a id="__codelineno-0-2766" name="__codelineno-0-2766"></a>                <span class="k">if</span> <span class="n">pwl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2767" name="__codelineno-0-2767"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">missing_pwl_message</span><span class="p">)</span>
<a id="__codelineno-0-2768" name="__codelineno-0-2768"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-2769" name="__codelineno-0-2769"></a>
<a id="__codelineno-0-2770" name="__codelineno-0-2770"></a>                <span class="n">pwl_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pwl</span><span class="p">)</span>
<a id="__codelineno-0-2771" name="__codelineno-0-2771"></a>
<a id="__codelineno-0-2772" name="__codelineno-0-2772"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pwl_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-2773" name="__codelineno-0-2773"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">missing_pwl_message</span><span class="p">)</span>
<a id="__codelineno-0-2774" name="__codelineno-0-2774"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-2775" name="__codelineno-0-2775"></a>
<a id="__codelineno-0-2776" name="__codelineno-0-2776"></a>                <span class="n">pwl_path_basename</span> <span class="o">=</span> <span class="n">pwl_path</span><span class="o">.</span><span class="n">stem</span>
<a id="__codelineno-0-2777" name="__codelineno-0-2777"></a>
<a id="__codelineno-0-2778" name="__codelineno-0-2778"></a>                <span class="k">for</span> <span class="n">priority_layer</span> <span class="ow">in</span> <span class="n">settings_priority_layers</span><span class="p">:</span>
<a id="__codelineno-0-2779" name="__codelineno-0-2779"></a>                    <span class="k">if</span> <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span> <span class="o">==</span> <span class="n">layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">):</span>
<a id="__codelineno-0-2780" name="__codelineno-0-2780"></a>                        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"groups"</span><span class="p">,</span> <span class="p">[]):</span>
<a id="__codelineno-0-2781" name="__codelineno-0-2781"></a>                            <span class="n">impact_value</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-2782" name="__codelineno-0-2782"></a>                            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-2783" name="__codelineno-0-2783"></a>                                <span class="n">row</span> <span class="o">=</span> <span class="n">pathway_uuids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">uuid</span><span class="p">))</span>
<a id="__codelineno-0-2784" name="__codelineno-0-2784"></a>                                <span class="n">col</span> <span class="o">=</span> <span class="n">priority_layer_uuids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">"uuid"</span><span class="p">])</span>
<a id="__codelineno-0-2785" name="__codelineno-0-2785"></a>                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-2786" name="__codelineno-0-2786"></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2787" name="__codelineno-0-2787"></a>                                    <span class="sa">f</span><span class="s2">"Could not find pathway uuid </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2"> or "</span>
<a id="__codelineno-0-2788" name="__codelineno-0-2788"></a>                                    <span class="sa">f</span><span class="s2">"priority layer uuid </span><span class="si">{</span><span class="n">layer</span><span class="p">[</span><span class="s1">'uuid'</span><span class="p">]</span><span class="si">}</span><span class="s2"> in the relative impact matrix."</span>
<a id="__codelineno-0-2789" name="__codelineno-0-2789"></a>                                <span class="p">)</span>
<a id="__codelineno-0-2790" name="__codelineno-0-2790"></a>                            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2791" name="__codelineno-0-2791"></a>                                <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">relative_impact_values</span><span class="p">)</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span>
<a id="__codelineno-0-2792" name="__codelineno-0-2792"></a>                                    <span class="n">relative_impact_values</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
<a id="__codelineno-0-2793" name="__codelineno-0-2793"></a>                                <span class="p">):</span>
<a id="__codelineno-0-2794" name="__codelineno-0-2794"></a>                                    <span class="n">impact_value</span> <span class="o">=</span> <span class="n">relative_impact_values</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
<a id="__codelineno-0-2795" name="__codelineno-0-2795"></a>                                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2796" name="__codelineno-0-2796"></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2797" name="__codelineno-0-2797"></a>                                        <span class="sa">f</span><span class="s2">"Index out of range for relative impact "</span>
<a id="__codelineno-0-2798" name="__codelineno-0-2798"></a>                                        <span class="sa">f</span><span class="s2">"matrix: row=</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">, col=</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">."</span>
<a id="__codelineno-0-2799" name="__codelineno-0-2799"></a>                                    <span class="p">)</span>
<a id="__codelineno-0-2800" name="__codelineno-0-2800"></a>
<a id="__codelineno-0-2801" name="__codelineno-0-2801"></a>                            <span class="n">value</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"value"</span><span class="p">)</span>
<a id="__codelineno-0-2802" name="__codelineno-0-2802"></a>                            <span class="n">priority_group_coefficient</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-2803" name="__codelineno-0-2803"></a>                            <span class="k">if</span> <span class="n">priority_group_coefficient</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2804" name="__codelineno-0-2804"></a>                                <span class="k">if</span> <span class="n">pwl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
<a id="__codelineno-0-2805" name="__codelineno-0-2805"></a>                                    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pwl</span><span class="p">)</span>
<a id="__codelineno-0-2806" name="__codelineno-0-2806"></a>
<a id="__codelineno-0-2807" name="__codelineno-0-2807"></a>                                <span class="n">pwl_expression</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2808" name="__codelineno-0-2808"></a>                                    <span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="n">priority_group_coefficient</span><span class="si">}</span><span class="s2">*"</span>
<a id="__codelineno-0-2809" name="__codelineno-0-2809"></a>                                    <span class="sa">f</span><span class="s1">'"</span><span class="si">{</span><span class="n">pwl_path_basename</span><span class="si">}</span><span class="s1">@1")'</span>
<a id="__codelineno-0-2810" name="__codelineno-0-2810"></a>                                <span class="p">)</span>
<a id="__codelineno-0-2811" name="__codelineno-0-2811"></a>
<a id="__codelineno-0-2812" name="__codelineno-0-2812"></a>                                <span class="k">if</span> <span class="n">impact_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">impact_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-2813" name="__codelineno-0-2813"></a>                                    <span class="c1"># Inverse the PWL</span>
<a id="__codelineno-0-2814" name="__codelineno-0-2814"></a>                                    <span class="n">pwl_expression</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-2815" name="__codelineno-0-2815"></a>                                        <span class="sa">f</span><span class="s2">"(</span><span class="si">{</span><span class="n">priority_group_coefficient</span><span class="si">}</span><span class="s2">*"</span>
<a id="__codelineno-0-2816" name="__codelineno-0-2816"></a>                                        <span class="sa">f</span><span class="s1">'("</span><span class="si">{</span><span class="n">pwl_path_basename</span><span class="si">}</span><span class="s1">@1" - 1) * -1)'</span>
<a id="__codelineno-0-2817" name="__codelineno-0-2817"></a>                                    <span class="p">)</span>
<a id="__codelineno-0-2818" name="__codelineno-0-2818"></a>                                <span class="n">norm_carbon_impact</span> <span class="o">=</span> <span class="n">pathway</span><span class="o">.</span><span class="n">type_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-2819" name="__codelineno-0-2819"></a>                                    <span class="s2">"norm_carbon_impact"</span>
<a id="__codelineno-0-2820" name="__codelineno-0-2820"></a>                                <span class="p">)</span>
<a id="__codelineno-0-2821" name="__codelineno-0-2821"></a>                                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-2822" name="__codelineno-0-2822"></a>                                    <span class="n">layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"is_carbon"</span><span class="p">)</span>
<a id="__codelineno-0-2823" name="__codelineno-0-2823"></a>                                    <span class="ow">and</span> <span class="n">norm_carbon_impact</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-2824" name="__codelineno-0-2824"></a>                                <span class="p">):</span>
<a id="__codelineno-0-2825" name="__codelineno-0-2825"></a>                                    <span class="c1"># For restore and manage pathways, multiply by normalized carbon impact</span>
<a id="__codelineno-0-2826" name="__codelineno-0-2826"></a>                                    <span class="n">pwl_expression</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">" * </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">impact_value</span><span class="p">))</span> <span class="o">*</span> <span class="n">norm_carbon_impact</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2827" name="__codelineno-0-2827"></a>                                <span class="k">elif</span> <span class="n">impact_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2828" name="__codelineno-0-2828"></a>                                    <span class="c1"># For non-carbon PWLS and and protect pathways,</span>
<a id="__codelineno-0-2829" name="__codelineno-0-2829"></a>                                    <span class="n">pwl_expression</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"* </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">impact_value</span><span class="p">))</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2830" name="__codelineno-0-2830"></a>
<a id="__codelineno-0-2831" name="__codelineno-0-2831"></a>                                <span class="n">base_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pwl_expression</span><span class="p">)</span>
<a id="__codelineno-0-2832" name="__codelineno-0-2832"></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">run_calculation</span><span class="p">:</span>
<a id="__codelineno-0-2833" name="__codelineno-0-2833"></a>                                    <span class="n">run_calculation</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2834" name="__codelineno-0-2834"></a>
<a id="__codelineno-0-2835" name="__codelineno-0-2835"></a>            <span class="c1"># No need to run the calculation if suitability index is</span>
<a id="__codelineno-0-2836" name="__codelineno-0-2836"></a>            <span class="c1"># zero or there are no PWLs in the activity.</span>
<a id="__codelineno-0-2837" name="__codelineno-0-2837"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">run_calculation</span><span class="p">:</span>
<a id="__codelineno-0-2838" name="__codelineno-0-2838"></a>                <span class="k">continue</span>
<a id="__codelineno-0-2839" name="__codelineno-0-2839"></a>
<a id="__codelineno-0-2840" name="__codelineno-0-2840"></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="n">clean_filename</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="s2">"_"</span><span class="p">))</span>
<a id="__codelineno-0-2841" name="__codelineno-0-2841"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-2842" name="__codelineno-0-2842"></a>                <span class="n">weighted_pathways_directory</span><span class="p">,</span>
<a id="__codelineno-0-2843" name="__codelineno-0-2843"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span>
<a id="__codelineno-0-2844" name="__codelineno-0-2844"></a>            <span class="p">)</span>
<a id="__codelineno-0-2845" name="__codelineno-0-2845"></a>
<a id="__codelineno-0-2846" name="__codelineno-0-2846"></a>            <span class="n">expression</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">base_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-2847" name="__codelineno-0-2847"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2848" name="__codelineno-0-2848"></a>                <span class="n">pwl_calc_expression</span> <span class="o">=</span> <span class="s2">" + "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<a id="__codelineno-0-2849" name="__codelineno-0-2849"></a>                <span class="n">expression</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">" * (</span><span class="si">{</span><span class="n">pwl_calc_expression</span><span class="si">}</span><span class="s2">)"</span>
<a id="__codelineno-0-2850" name="__codelineno-0-2850"></a>
<a id="__codelineno-0-2851" name="__codelineno-0-2851"></a>            <span class="c1"># Actual processing calculation</span>
<a id="__codelineno-0-2852" name="__codelineno-0-2852"></a>            <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-2853" name="__codelineno-0-2853"></a>                <span class="s2">"CELLSIZE"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2854" name="__codelineno-0-2854"></a>                <span class="s2">"CRS"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2855" name="__codelineno-0-2855"></a>                <span class="s2">"EXPRESSION"</span><span class="p">:</span> <span class="n">expression</span><span class="p">,</span>
<a id="__codelineno-0-2856" name="__codelineno-0-2856"></a>                <span class="s2">"EXTENT"</span><span class="p">:</span> <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-2857" name="__codelineno-0-2857"></a>                <span class="s2">"LAYERS"</span><span class="p">:</span> <span class="n">layers</span><span class="p">,</span>
<a id="__codelineno-0-2858" name="__codelineno-0-2858"></a>                <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output_file</span><span class="p">,</span>
<a id="__codelineno-0-2859" name="__codelineno-0-2859"></a>            <span class="p">}</span>
<a id="__codelineno-0-2860" name="__codelineno-0-2860"></a>
<a id="__codelineno-0-2861" name="__codelineno-0-2861"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-2862" name="__codelineno-0-2862"></a>                <span class="sa">f</span><span class="s2">" Used parameters for calculating weighting pathways </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-2863" name="__codelineno-0-2863"></a>            <span class="p">)</span>
<a id="__codelineno-0-2864" name="__codelineno-0-2864"></a>
<a id="__codelineno-0-2865" name="__codelineno-0-2865"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-2866" name="__codelineno-0-2866"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-2867" name="__codelineno-0-2867"></a>
<a id="__codelineno-0-2868" name="__codelineno-0-2868"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-2869" name="__codelineno-0-2869"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2870" name="__codelineno-0-2870"></a>
<a id="__codelineno-0-2871" name="__codelineno-0-2871"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-2872" name="__codelineno-0-2872"></a>                <span class="s2">"qgis:rastercalculator"</span><span class="p">,</span>
<a id="__codelineno-0-2873" name="__codelineno-0-2873"></a>                <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-2874" name="__codelineno-0-2874"></a>                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-2875" name="__codelineno-0-2875"></a>                <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-2876" name="__codelineno-0-2876"></a>            <span class="p">)</span>
<a id="__codelineno-0-2877" name="__codelineno-0-2877"></a>            <span class="n">pathway</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">"OUTPUT"</span><span class="p">]</span>
<a id="__codelineno-0-2878" name="__codelineno-0-2878"></a>
<a id="__codelineno-0-2879" name="__codelineno-0-2879"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-2880" name="__codelineno-0-2880"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem weighting pathways, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-2881" name="__codelineno-0-2881"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-2882" name="__codelineno-0-2882"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-2883" name="__codelineno-0-2883"></a>
<a id="__codelineno-0-2884" name="__codelineno-0-2884"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.set_custom_progress" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_custom_progress</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.set_custom_progress" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">set_custom_progress</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Set task progress value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>value</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to be set on the progress bar</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="k">def</span> <span class="nf">set_custom_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="sd">"""Set task progress value.</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    :param value: Value to be set on the progress bar</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a><span class="sd">    :type value: float</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a><span class="sd">    """</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">custom_progress</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">custom_progress_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_progress</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.set_info_message" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_info_message</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.set_info_message" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">set_info_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Set info message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>message</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Message</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>level</code></td>
            <td>
                  <code>(<span title="int">int</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>log level, defaults to Qgis.Info</p>
              </div>
            </td>
            <td>
                  <code><span title="qgis.core.Qgis.MessageLevel.Info">Info</span></code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="k">def</span> <span class="nf">set_info_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Info</span><span class="p">):</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="sd">"""Set info message.</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="sd">    :param message: Message</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    :type message: str</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    :param level: log level, defaults to Qgis.Info</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">    :type level: int, optional</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    """</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">info_message</span> <span class="o">=</span> <span class="n">message</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">info_message_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_message</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.set_status_message" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_status_message</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.set_status_message" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">set_status_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Set status message in progress dialog</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>message</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Message to be displayed</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="k">def</span> <span class="nf">set_status_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="sd">"""Set status message in progress dialog</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    :param message: Message to be displayed</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    :type message: str</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">    """</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">message</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">status_message_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_message</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.snap_analysis_data" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">snap_analysis_data</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.snap_analysis_data" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">snap_analysis_data</span><span class="p">(</span><span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Snaps the passed activities pathways, carbon layers and priority layers
 to align with the reference layer set on the settings
manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>activities</code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="Activity (src.cplus_plugin.models.base.Activity)" href="../../models/api_base/#src.cplus_plugin.models.base.Activity">Activity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the selected activities</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The selected extent from user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1169" name="__codelineno-0-1169"></a><span class="k">def</span> <span class="nf">snap_analysis_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activities</span><span class="p">,</span> <span class="n">extent</span><span class="p">):</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>    <span class="sd">"""Snaps the passed activities pathways, carbon layers and priority layers</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><span class="sd">     to align with the reference layer set on the settings</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><span class="sd">    manager.</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a><span class="sd">    :param activities: List of the selected activities</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="sd">    :type activities: typing.List[Activity]</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a><span class="sd">    :param extent: The selected extent from user</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><span class="sd">    :type extent: list</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><span class="sd">    """</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>        <span class="c1"># Will not proceed if processing has been cancelled by the user</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_status_message</span><span class="p">(</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>        <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>            <span class="s2">"Snapping the selected activity pathways, "</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>            <span class="s2">"carbon layers and priority layers"</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>        <span class="p">)</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>    <span class="p">)</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>    <span class="n">pathways</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">activities</span><span class="p">:</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>                <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">activity</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s2">""</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>            <span class="p">):</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_info_message</span><span class="p">(</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>                    <span class="n">tr</span><span class="p">(</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                        <span class="sa">f</span><span class="s2">"No defined activity pathways or a"</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>                        <span class="sa">f</span><span class="s2">" activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>                    <span class="n">level</span><span class="o">=</span><span class="n">Qgis</span><span class="o">.</span><span class="n">MessageLevel</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>                <span class="p">)</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                    <span class="sa">f</span><span class="s2">"No defined activity pathways or a "</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                    <span class="sa">f</span><span class="s2">"activity layer for the activity </span><span class="si">{</span><span class="n">activity</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                <span class="p">)</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">activity</span><span class="o">.</span><span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">):</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>                    <span class="n">pathways</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathway</span><span class="p">)</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>        <span class="n">reference_layer_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span><span class="n">Settings</span><span class="o">.</span><span class="n">SNAP_LAYER</span><span class="p">)</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>        <span class="n">rescale_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">RESCALE_VALUES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">setting_type</span><span class="o">=</span><span class="nb">bool</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>        <span class="p">)</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>        <span class="n">resampling_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings_value</span><span class="p">(</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>            <span class="n">Settings</span><span class="o">.</span><span class="n">RESAMPLING_METHOD</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>        <span class="p">)</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>        <span class="k">if</span> <span class="n">pathways</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathways</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>            <span class="n">snapped_pathways_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"pathways"</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>            <span class="p">)</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>            <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">snapped_pathways_directory</span><span class="p">)</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>            <span class="k">for</span> <span class="n">pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>                <span class="n">pathway_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>                <span class="n">nodata_value</span> <span class="o">=</span> <span class="n">pathway_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">sourceNoDataValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>                    <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>                <span class="c1"># carbon layer snapping</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>                    <span class="sa">f</span><span class="s2">"Snapping carbon layers from </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> pathway"</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>                <span class="p">)</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">carbon_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pathway</span><span class="o">.</span><span class="n">carbon_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>                <span class="p">):</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>                    <span class="n">snapped_carbon_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"carbon_layers"</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>                    <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">snapped_carbon_directory</span><span class="p">)</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>                    <span class="n">snapped_carbon_paths</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>                    <span class="k">for</span> <span class="n">carbon_path</span> <span class="ow">in</span> <span class="n">pathway</span><span class="o">.</span><span class="n">carbon_paths</span><span class="p">:</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>                        <span class="n">carbon_layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>                            <span class="n">carbon_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>                        <span class="n">nodata_value_carbon</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>                            <span class="n">carbon_layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">sourceNoDataValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>                        <span class="n">carbon_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_layer</span><span class="p">(</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>                            <span class="n">carbon_path</span><span class="p">,</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>                            <span class="n">reference_layer_path</span><span class="p">,</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>                            <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>                            <span class="n">snapped_carbon_directory</span><span class="p">,</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>                            <span class="n">rescale_values</span><span class="p">,</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>                            <span class="n">resampling_method</span><span class="p">,</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>                            <span class="n">nodata_value_carbon</span><span class="p">,</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>                        <span class="p">)</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>                        <span class="k">if</span> <span class="n">carbon_output_path</span><span class="p">:</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>                            <span class="n">snapped_carbon_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carbon_output_path</span><span class="p">)</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>                        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>                            <span class="n">snapped_carbon_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carbon_path</span><span class="p">)</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">carbon_paths</span> <span class="o">=</span> <span class="n">snapped_carbon_paths</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Snapping </span><span class="si">{</span><span class="n">pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> pathway layer </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>                <span class="c1"># Pathway snapping</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>                <span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_layer</span><span class="p">(</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>                    <span class="n">reference_layer_path</span><span class="p">,</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>                    <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>                    <span class="n">snapped_pathways_directory</span><span class="p">,</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>                    <span class="n">rescale_values</span><span class="p">,</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>                    <span class="n">resampling_method</span><span class="p">,</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>                    <span class="n">nodata_value</span><span class="p">,</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>                <span class="p">)</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>                <span class="k">if</span> <span class="n">output_path</span><span class="p">:</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>                    <span class="n">pathway</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">output_path</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>        <span class="k">for</span> <span class="n">pwl_pathway</span> <span class="ow">in</span> <span class="n">pathways</span><span class="p">:</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>                <span class="sa">f</span><span class="s2">"Snapping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pwl_pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">)</span><span class="si">}</span><span class="s2"> "</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>                <span class="sa">f</span><span class="s2">"priority weighting layers from pathway </span><span class="si">{</span><span class="n">pwl_pathway</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with layers</span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>            <span class="p">)</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>            <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>                <span class="n">pwl_pathway</span><span class="o">.</span><span class="n">priority_layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pwl_pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>            <span class="p">):</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>                <span class="n">snapped_priority_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">scenario_directory</span><span class="p">,</span> <span class="s2">"priority_layers"</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>                <span class="p">)</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>                <span class="n">FileUtils</span><span class="o">.</span><span class="n">create_new_dir</span><span class="p">(</span><span class="n">snapped_priority_directory</span><span class="p">)</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>                <span class="n">priority_layers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>                <span class="k">for</span> <span class="n">priority_layer</span> <span class="ow">in</span> <span class="n">pwl_pathway</span><span class="o">.</span><span class="n">priority_layers</span><span class="p">:</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>                    <span class="k">if</span> <span class="n">priority_layer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>                    <span class="n">priority_layer_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_priority_layer</span><span class="p">(</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>                        <span class="n">priority_layer</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"uuid"</span><span class="p">)</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>                    <span class="k">if</span> <span class="n">priority_layer_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                    <span class="n">priority_layer_path</span> <span class="o">=</span> <span class="n">priority_layer_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">priority_layer_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                        <span class="n">priority_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priority_layer</span><span class="p">)</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                    <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                        <span class="n">priority_layer_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>                    <span class="n">nodata_value_priority</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span><span class="o">.</span><span class="n">sourceNoDataValue</span><span class="p">(</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>                        <span class="mi">1</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                    <span class="n">priority_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snap_layer</span><span class="p">(</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                        <span class="n">priority_layer_path</span><span class="p">,</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>                        <span class="n">reference_layer_path</span><span class="p">,</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>                        <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>                        <span class="n">snapped_priority_directory</span><span class="p">,</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>                        <span class="n">rescale_values</span><span class="p">,</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>                        <span class="n">resampling_method</span><span class="p">,</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>                        <span class="n">nodata_value_priority</span><span class="p">,</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>                    <span class="k">if</span> <span class="n">priority_output_path</span><span class="p">:</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>                        <span class="n">priority_layer</span><span class="p">[</span><span class="s2">"path"</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority_output_path</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>                    <span class="n">priority_layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">priority_layer</span><span class="p">)</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>                <span class="n">pwl_pathway</span><span class="o">.</span><span class="n">priority_layers</span> <span class="o">=</span> <span class="n">priority_layers</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem snapping layers, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.snap_layer" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">snap_layer</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.snap_layer" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">snap_layer</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">reference_path</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">rescale_values</span><span class="p">,</span> <span class="n">resampling_method</span><span class="p">,</span> <span class="n">nodata_value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Snaps the passed input layer using the reference layer and updates
the snap output no data value to be the same as the original input layer
no data value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>input_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input layer source</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>reference_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference layer source</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>extent</code></td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Clip extent</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>directory</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Absolute path of the output directory for the snapped layers</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>rescale_values</code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to rescale pixel values</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>resample_method</code></td>
            <td>
                  <code><span title="QgsAlignRaster.ResampleAlg">ResampleAlg</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method to use when resampling</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nodata_value</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original no data value of the input layer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1359" name="__codelineno-0-1359"></a><span class="k">def</span> <span class="nf">snap_layer</span><span class="p">(</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>    <span class="n">input_path</span><span class="p">,</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>    <span class="n">reference_path</span><span class="p">,</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>    <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>    <span class="n">directory</span><span class="p">,</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>    <span class="n">rescale_values</span><span class="p">,</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>    <span class="n">resampling_method</span><span class="p">,</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>    <span class="n">nodata_value</span><span class="p">,</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a><span class="p">):</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>    <span class="sd">"""Snaps the passed input layer using the reference layer and updates</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a><span class="sd">    the snap output no data value to be the same as the original input layer</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a><span class="sd">    no data value.</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a><span class="sd">    :param input_path: Input layer source</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a><span class="sd">    :type input_path: str</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a><span class="sd">    :param reference_path: Reference layer source</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a><span class="sd">    :type reference_path: str</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="sd">    :param extent: Clip extent</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="sd">    :type extent: list</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a><span class="sd">    :param directory: Absolute path of the output directory for the snapped</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a><span class="sd">    layers</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a><span class="sd">    :type directory: str</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a><span class="sd">    :param rescale_values: Whether to rescale pixel values</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a><span class="sd">    :type rescale_values: bool</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a><span class="sd">    :param resample_method: Method to use when resampling</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a><span class="sd">    :type resample_method: QgsAlignRaster.ResampleAlg</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a><span class="sd">    :param nodata_value: Original no data value of the input layer</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a><span class="sd">    :type nodata_value: float</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a><span class="sd">    """</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>    <span class="n">input_result_path</span><span class="p">,</span> <span class="n">reference_result_path</span> <span class="o">=</span> <span class="n">align_rasters</span><span class="p">(</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>        <span class="n">input_path</span><span class="p">,</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>        <span class="n">reference_path</span><span class="p">,</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>        <span class="n">extent</span><span class="p">,</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>        <span class="n">directory</span><span class="p">,</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>        <span class="n">rescale_values</span><span class="p">,</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>        <span class="n">resampling_method</span><span class="p">,</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>    <span class="p">)</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>    <span class="k">if</span> <span class="n">input_result_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>        <span class="n">result_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_result_path</span><span class="p">)</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">result_path</span><span class="o">.</span><span class="n">parent</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">result_path</span><span class="o">.</span><span class="n">stem</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_final.tif"</span><span class="p">)</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">replace_nodata</span><span class="p">(</span><span class="n">input_result_path</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">nodata_value</span><span class="p">)</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>    <span class="k">return</span> <span class="n">output_path</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.update_progress" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_progress</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.update_progress" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">update_progress</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Sets the value of the task progress</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>value</code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to be set on the progress bar</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="k">def</span> <span class="nf">update_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="sd">"""Sets the value of the task progress</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    :param value: Value to be set on the progress bar</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    :type value: float</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">    """</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_custom_progress</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span> <span class="o">=</span> <span class="n">QgsProcessingContext</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.cplus_plugin.tasks.ScenarioAnalysisTask.validate_vector_layer" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_vector_layer</span>


<a href="#src.cplus_plugin.tasks.ScenarioAnalysisTask.validate_vector_layer" class="headerlink" title="Permanent link">¶</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">validate_vector_layer</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

      <p>Create a valid representation of a given vector layer without losing any of the input vertices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>source_path</code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to vector layer. The native:fixgeometries requires the layer in EPSG:4326</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str | bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the validated vector layer else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/cplus_plugin/tasks.py</code></summary>
              <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="k">def</span> <span class="nf">validate_vector_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>    <span class="sd">"""Create a valid representation of a given vector layer without losing any of the input vertices.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">    :param source_path: Path to vector layer. The native:fixgeometries requires the layer in EPSG:4326</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a><span class="sd">    :type source_path: str</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">    :returns: Path to the validated vector layer else False.</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">    :rtype: str | bool</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">    """</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Validating the vector layer </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>    <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">source_path</span><span class="p">,</span> <span class="s2">"input_layer"</span><span class="p">)</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">layer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>        <span class="n">validated_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">QgsProcessingFeedback</span><span class="p">()</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">progressChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_progress</span><span class="p">)</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_cancelled</span><span class="p">:</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>            <span class="n">validated_directory</span><span class="p">,</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>            <span class="sa">f</span><span class="s2">"validated_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">.shp"</span><span class="p">,</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="p">)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>        <span class="n">alg_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"INPUT"</span><span class="p">:</span> <span class="n">source_path</span><span class="p">,</span> <span class="s2">"METHOD"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"OUTPUT"</span><span class="p">:</span> <span class="n">output_file</span><span class="p">}</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>            <span class="sa">f</span><span class="s2">"Used parameters for validating the vector: </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2"> "</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>            <span class="sa">f</span><span class="s2">" </span><span class="si">{</span><span class="n">alg_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="p">)</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="s2">"native:fixgeometries"</span><span class="p">,</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="n">alg_params</span><span class="p">,</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">processing_context</span><span class="p">,</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>            <span class="n">feedback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">,</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>        <span class="p">)</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"OUTPUT"</span><span class="p">)</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Problem validating the vector, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_task</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
</td></tr></table>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 3, 2026</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../api_conf/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Configuration" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Configuration
            </div>
          </div>
        </a>
      
      
        
        <a href="../api_settings/" class="md-footer__link md-footer__link--next" aria-label="Next: Settings" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Settings
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.instant", "navigation.tabs.sticky", "navigation.tracking", "toc.integrate", "toc.follow", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.tabs.link", "content.code.annotation", "content.code.copy", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.748e2769.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>